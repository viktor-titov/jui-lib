import _extends from "@babel/runtime/helpers/extends";
// Copyright (c) 2017 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { createSelector, createStructuredSelector } from 'reselect';
import TreeNode from '../utils/TreeNode';
import { formatMillisecondTime, formatSecondTime, ONE_SECOND } from '../utils/date';
import { numberSortComparator } from '../utils/sort';
import { getProcessServiceName } from './process';
import { getSpanId, getSpanName, getSpanServiceName, getSpanTimestamp, getSpanDuration, getSpanProcessId } from './span';
export var getTraceId = function getTraceId(trace) {
  return trace.traceID;
};
export var getTraceSpans = function getTraceSpans(trace) {
  return trace.spans;
};
var getTraceProcesses = function getTraceProcesses(trace) {
  return trace.processes;
};
var getSpanWithProcess = createSelector(function (state) {
  return state.span;
}, function (state) {
  return state.processes;
}, function (span, processes) {
  return _extends({}, span, {
    process: processes[getSpanProcessId(span)]
  });
});
export var getTraceSpansAsMap = createSelector(getTraceSpans, function (spans) {
  return spans.reduce(function (map, span) {
    return map.set(getSpanId(span), span);
  }, new Map());
});
export var TREE_ROOT_ID = '__root__';

/**
 * Build a tree of { value: spanID, children } items derived from the
 * `span.references` information. The tree represents the grouping of parent /
 * child relationships. The root-most node is nominal in that
 * `.value === TREE_ROOT_ID`. This is done because a root span (the main trace
 * span) is not always included with the trace data. Thus, there can be
 * multiple top-level spans, and the root node acts as their common parent.
 *
 * The children are sorted by `span.startTime` after the tree is built.
 *
 * @param  {Trace} trace The trace to build the tree of spanIDs.
 * @return {TreeNode}    A tree of spanIDs derived from the relationships
 *                       between spans in the trace.
 */
export function getTraceSpanIdsAsTree(trace) {
  var nodesById = new Map(trace.spans.map(function (span) {
    return [span.spanID, new TreeNode(span.spanID)];
  }));
  var spansById = new Map(trace.spans.map(function (span) {
    return [span.spanID, span];
  }));
  var root = new TreeNode(TREE_ROOT_ID);
  trace.spans.forEach(function (span) {
    var node = nodesById.get(span.spanID);
    if (Array.isArray(span.references) && span.references.length) {
      var _span$references$ = span.references[0],
        refType = _span$references$.refType,
        parentID = _span$references$.spanID;
      if (refType === 'CHILD_OF' || refType === 'FOLLOWS_FROM') {
        var _parent$children;
        var parent = nodesById.get(parentID) || root;
        (_parent$children = parent.children) == null || _parent$children.push(node);
      } else {
        throw new Error("Unrecognized ref type: " + refType);
      }
    } else {
      root.children.push(node);
    }
  });
  var comparator = function comparator(nodeA, nodeB) {
    var a = nodeA != null && nodeA.value ? spansById.get(nodeA.value.toString()) : undefined;
    var b = nodeB != null && nodeB.value ? spansById.get(nodeB.value.toString()) : undefined;
    return +((a == null ? void 0 : a.startTime) > (b == null ? void 0 : b.startTime)) || +((a == null ? void 0 : a.startTime) === (b == null ? void 0 : b.startTime)) - 1;
  };
  trace.spans.forEach(function (span) {
    var node = nodesById.get(span.spanID);
    if (node.children.length > 1) {
      node == null || node.children.sort(comparator);
    }
  });
  root.children.sort(comparator);
  return root;
}

// attach "process" as an object to each span.
export var hydrateSpansWithProcesses = function hydrateSpansWithProcesses(trace) {
  var spans = getTraceSpans(trace);
  var processes = getTraceProcesses(trace);
  return _extends({}, trace, {
    spans: spans.map(function (span) {
      return getSpanWithProcess({
        span: span,
        processes: processes
      });
    })
  });
};
export var getTraceSpanCount = createSelector(getTraceSpans, function (spans) {
  return spans.length;
});
export var getTraceTimestamp = createSelector(getTraceSpans, function (spans) {
  return spans.reduce(function (prevTimestamp, span) {
    return prevTimestamp ? Math.min(prevTimestamp, getSpanTimestamp(span)) : getSpanTimestamp(span);
  }, 0);
});
export var getTraceDuration = createSelector(getTraceSpans, getTraceTimestamp, function (spans, timestamp) {
  return spans.reduce(function (prevDuration, span) {
    return prevDuration ? Math.max(getSpanTimestamp(span) - timestamp + getSpanDuration(span), prevDuration) : getSpanDuration(span);
  }, 0);
});
export var getTraceEndTimestamp = createSelector(getTraceTimestamp, getTraceDuration, function (timestamp, duration) {
  return timestamp + duration;
});
export var getParentSpan = createSelector(getTraceSpanIdsAsTree, getTraceSpansAsMap, function (tree, spanMap) {
  return tree.children.map(function (node) {
    return spanMap.get(node.value);
  }).sort(function (spanA, spanB) {
    return numberSortComparator(getSpanTimestamp(spanA), getSpanTimestamp(spanB));
  })[0];
});
export var getTraceDepth = createSelector(getTraceSpanIdsAsTree, function (spanTree) {
  return spanTree.depth - 1;
});
export var getSpanDepthForTrace = createSelector(createSelector(function (state) {
  return state.trace;
}, getTraceSpanIdsAsTree), createSelector(function (state) {
  return state.span;
}, getSpanId), function (node, spanID) {
  return node.getPath(spanID).length - 1;
});
export var getTraceServices = createSelector(getTraceProcesses, function (processes) {
  return Object.keys(processes).reduce(function (services, processID) {
    return services.add(getProcessServiceName(processes[processID]));
  }, new Set());
});
export var getTraceServiceCount = createSelector(getTraceServices, function (services) {
  return services.size;
});

// establish constants to determine how math should be handled
// for nanosecond-to-millisecond conversions.
export var DURATION_FORMATTERS = {
  ms: formatMillisecondTime,
  s: formatSecondTime
};
var getDurationFormatterForTrace = createSelector(getTraceDuration, function (totalDuration) {
  return totalDuration >= ONE_SECOND ? DURATION_FORMATTERS.s : DURATION_FORMATTERS.ms;
});
export var formatDurationForUnit = createSelector(function (_ref) {
  var duration = _ref.duration;
  return duration;
}, function (_ref2) {
  var unit = _ref2.unit;
  return DURATION_FORMATTERS[unit];
}, function (duration, formatter) {
  return formatter(duration);
});
export var formatDurationForTrace = createSelector(function (_ref3) {
  var duration = _ref3.duration;
  return duration;
}, createSelector(function (_ref4) {
  var trace = _ref4.trace;
  return trace;
}, getDurationFormatterForTrace), function (duration, formatter) {
  return formatter(duration);
});
export var getSortedSpans = createSelector(function (_ref5) {
  var trace = _ref5.trace;
  return trace;
}, function (_ref6) {
  var spans = _ref6.spans;
  return spans;
}, function (_ref7) {
  var sort = _ref7.sort;
  return sort;
}, function (trace, spans, _ref8) {
  var dir = _ref8.dir,
    comparator = _ref8.comparator,
    selector = _ref8.selector;
  return [].concat(spans).sort(function (spanA, spanB) {
    return dir * comparator(selector(spanA, trace), selector(spanB, trace));
  });
});
var getTraceSpansByHierarchyPosition = createSelector(getTraceSpanIdsAsTree, function (tree) {
  var hierarchyPositionMap = new Map();
  var i = 0;
  tree.walk(function (spanID) {
    return hierarchyPositionMap.set(spanID, i++);
  });
  return hierarchyPositionMap;
});
export var getTreeSizeForTraceSpan = createSelector(createSelector(function (state) {
  return state.trace;
}, getTraceSpanIdsAsTree), createSelector(function (state) {
  return state.span;
}, getSpanId), function (tree, spanID) {
  var node = tree.find(spanID);
  if (!node) {
    return -1;
  }
  return node.size - 1;
});
export var getSpanHierarchySortPositionForTrace = createSelector(createSelector(function (_ref9) {
  var trace = _ref9.trace;
  return trace;
}, getTraceSpansByHierarchyPosition), function (_ref10) {
  var span = _ref10.span;
  return span;
}, function (hierarchyPositionMap, span) {
  return hierarchyPositionMap.get(getSpanId(span));
});
export var getTraceName = createSelector(createSelector(createSelector(hydrateSpansWithProcesses, getParentSpan), createStructuredSelector({
  name: getSpanName,
  serviceName: getSpanServiceName
})), function (_ref11) {
  var name = _ref11.name,
    serviceName = _ref11.serviceName;
  return serviceName + ": " + name;
});
export var omitCollapsedSpans = createSelector(function (_ref12) {
  var spans = _ref12.spans;
  return spans;
}, createSelector(function (_ref13) {
  var trace = _ref13.trace;
  return trace;
}, getTraceSpanIdsAsTree), function (_ref14) {
  var collapsed = _ref14.collapsed;
  return collapsed;
}, function (spans, tree, collapse) {
  var hiddenSpanIds = collapse.reduce(function (result, collapsedSpanId) {
    tree.find(collapsedSpanId).walk(function (id) {
      return id !== collapsedSpanId && result.add(id);
    });
    return result;
  }, new Set());
  return hiddenSpanIds.size > 0 ? spans.filter(function (span) {
    return !hiddenSpanIds.has(getSpanId(span));
  }) : spans;
});
export var DEFAULT_TICK_INTERVAL = 4;
export var DEFAULT_TICK_WIDTH = 3;
export var getTicksForTrace = createSelector(function (_ref15) {
  var trace = _ref15.trace;
  return trace;
}, function (_ref16) {
  var _ref16$interval = _ref16.interval,
    interval = _ref16$interval === void 0 ? DEFAULT_TICK_INTERVAL : _ref16$interval;
  return interval;
}, function (_ref17) {
  var _ref17$width = _ref17.width,
    width = _ref17$width === void 0 ? DEFAULT_TICK_WIDTH : _ref17$width;
  return width;
}, function (trace, interval, width) {
  return [].concat(Array(interval + 1).keys()).map(function (num) {
    return {
      timestamp: getTraceTimestamp(trace) + getTraceDuration(trace) * (num / interval),
      width: width
    };
  });
});

// TODO: delete this when the backend can ensure uniqueness
/* istanbul ignore next */
export var enforceUniqueSpanIds = createSelector( /* istanbul ignore next */function (trace) {
  return trace;
}, getTraceSpans, /* istanbul ignore next */function (trace, spans) {
  var map = new Map();
  var spanArray = [];
  return _extends({}, trace, {
    spans: spans.reduce(function (result, span) {
      var spanID = map.has(getSpanId(span)) ? getSpanId(span) + "_" + map.get(getSpanId(span)) : getSpanId(span);
      var updatedSpan = _extends({}, span, {
        spanID: spanID
      });
      if (spanID !== getSpanId(span)) {
        // eslint-disable-next-line no-console
        console.warn('duplicate spanID in trace replaced', getSpanId(span), 'new:', spanID);
      }

      // set the presence of the span in the map or increment the number
      map.set(getSpanId(span), (map.get(getSpanId(span)) || 0) + 1);
      return result.concat([updatedSpan]);
    }, spanArray)
  });
});

// TODO: delete this when the backend can ensure uniqueness
export var dropEmptyStartTimeSpans = createSelector( /* istanbul ignore next */function (trace) {
  return trace;
}, getTraceSpans, /* istanbul ignore next */function (trace, spans) {
  return _extends({}, trace, {
    spans: spans.filter(function (span) {
      return !!getSpanTimestamp(span);
    })
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVTZWxlY3RvciIsImNyZWF0ZVN0cnVjdHVyZWRTZWxlY3RvciIsIlRyZWVOb2RlIiwiZm9ybWF0TWlsbGlzZWNvbmRUaW1lIiwiZm9ybWF0U2Vjb25kVGltZSIsIk9ORV9TRUNPTkQiLCJudW1iZXJTb3J0Q29tcGFyYXRvciIsImdldFByb2Nlc3NTZXJ2aWNlTmFtZSIsImdldFNwYW5JZCIsImdldFNwYW5OYW1lIiwiZ2V0U3BhblNlcnZpY2VOYW1lIiwiZ2V0U3BhblRpbWVzdGFtcCIsImdldFNwYW5EdXJhdGlvbiIsImdldFNwYW5Qcm9jZXNzSWQiLCJnZXRUcmFjZUlkIiwidHJhY2UiLCJ0cmFjZUlEIiwiZ2V0VHJhY2VTcGFucyIsInNwYW5zIiwiZ2V0VHJhY2VQcm9jZXNzZXMiLCJwcm9jZXNzZXMiLCJnZXRTcGFuV2l0aFByb2Nlc3MiLCJzdGF0ZSIsInNwYW4iLCJfZXh0ZW5kcyIsInByb2Nlc3MiLCJnZXRUcmFjZVNwYW5zQXNNYXAiLCJyZWR1Y2UiLCJtYXAiLCJzZXQiLCJNYXAiLCJUUkVFX1JPT1RfSUQiLCJnZXRUcmFjZVNwYW5JZHNBc1RyZWUiLCJub2Rlc0J5SWQiLCJzcGFuSUQiLCJzcGFuc0J5SWQiLCJyb290IiwiZm9yRWFjaCIsIm5vZGUiLCJnZXQiLCJBcnJheSIsImlzQXJyYXkiLCJyZWZlcmVuY2VzIiwibGVuZ3RoIiwiX3NwYW4kcmVmZXJlbmNlcyQiLCJyZWZUeXBlIiwicGFyZW50SUQiLCJfcGFyZW50JGNoaWxkcmVuIiwicGFyZW50IiwiY2hpbGRyZW4iLCJwdXNoIiwiRXJyb3IiLCJjb21wYXJhdG9yIiwibm9kZUEiLCJub2RlQiIsImEiLCJ2YWx1ZSIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwiYiIsInN0YXJ0VGltZSIsInNvcnQiLCJoeWRyYXRlU3BhbnNXaXRoUHJvY2Vzc2VzIiwiZ2V0VHJhY2VTcGFuQ291bnQiLCJnZXRUcmFjZVRpbWVzdGFtcCIsInByZXZUaW1lc3RhbXAiLCJNYXRoIiwibWluIiwiZ2V0VHJhY2VEdXJhdGlvbiIsInRpbWVzdGFtcCIsInByZXZEdXJhdGlvbiIsIm1heCIsImdldFRyYWNlRW5kVGltZXN0YW1wIiwiZHVyYXRpb24iLCJnZXRQYXJlbnRTcGFuIiwidHJlZSIsInNwYW5NYXAiLCJzcGFuQSIsInNwYW5CIiwiZ2V0VHJhY2VEZXB0aCIsInNwYW5UcmVlIiwiZGVwdGgiLCJnZXRTcGFuRGVwdGhGb3JUcmFjZSIsImdldFBhdGgiLCJnZXRUcmFjZVNlcnZpY2VzIiwiT2JqZWN0Iiwia2V5cyIsInNlcnZpY2VzIiwicHJvY2Vzc0lEIiwiYWRkIiwiU2V0IiwiZ2V0VHJhY2VTZXJ2aWNlQ291bnQiLCJzaXplIiwiRFVSQVRJT05fRk9STUFUVEVSUyIsIm1zIiwicyIsImdldER1cmF0aW9uRm9ybWF0dGVyRm9yVHJhY2UiLCJ0b3RhbER1cmF0aW9uIiwiZm9ybWF0RHVyYXRpb25Gb3JVbml0IiwiX3JlZiIsIl9yZWYyIiwidW5pdCIsImZvcm1hdHRlciIsImZvcm1hdER1cmF0aW9uRm9yVHJhY2UiLCJfcmVmMyIsIl9yZWY0IiwiZ2V0U29ydGVkU3BhbnMiLCJfcmVmNSIsIl9yZWY2IiwiX3JlZjciLCJfcmVmOCIsImRpciIsInNlbGVjdG9yIiwiY29uY2F0IiwiZ2V0VHJhY2VTcGFuc0J5SGllcmFyY2h5UG9zaXRpb24iLCJoaWVyYXJjaHlQb3NpdGlvbk1hcCIsImkiLCJ3YWxrIiwiZ2V0VHJlZVNpemVGb3JUcmFjZVNwYW4iLCJmaW5kIiwiZ2V0U3BhbkhpZXJhcmNoeVNvcnRQb3NpdGlvbkZvclRyYWNlIiwiX3JlZjkiLCJfcmVmMTAiLCJnZXRUcmFjZU5hbWUiLCJuYW1lIiwic2VydmljZU5hbWUiLCJfcmVmMTEiLCJvbWl0Q29sbGFwc2VkU3BhbnMiLCJfcmVmMTIiLCJfcmVmMTMiLCJfcmVmMTQiLCJjb2xsYXBzZWQiLCJjb2xsYXBzZSIsImhpZGRlblNwYW5JZHMiLCJyZXN1bHQiLCJjb2xsYXBzZWRTcGFuSWQiLCJpZCIsImZpbHRlciIsImhhcyIsIkRFRkFVTFRfVElDS19JTlRFUlZBTCIsIkRFRkFVTFRfVElDS19XSURUSCIsImdldFRpY2tzRm9yVHJhY2UiLCJfcmVmMTUiLCJfcmVmMTYiLCJfcmVmMTYkaW50ZXJ2YWwiLCJpbnRlcnZhbCIsIl9yZWYxNyIsIl9yZWYxNyR3aWR0aCIsIndpZHRoIiwibnVtIiwiZW5mb3JjZVVuaXF1ZVNwYW5JZHMiLCJzcGFuQXJyYXkiLCJ1cGRhdGVkU3BhbiIsImNvbnNvbGUiLCJ3YXJuIiwiZHJvcEVtcHR5U3RhcnRUaW1lU3BhbnMiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VsZWN0b3JzL3RyYWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxNyBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBjcmVhdGVTZWxlY3RvciwgY3JlYXRlU3RydWN0dXJlZFNlbGVjdG9yIH0gZnJvbSAncmVzZWxlY3QnO1xuXG5pbXBvcnQgeyBUcmFjZSwgVHJhY2VEYXRhLCBUcmFjZVByb2Nlc3MsIFRyYWNlUmVzcG9uc2UsIFRyYWNlU3BhbiwgVHJhY2VTcGFuRGF0YSB9IGZyb20gJy4uL3R5cGVzL3RyYWNlJztcbmltcG9ydCBUcmVlTm9kZSBmcm9tICcuLi91dGlscy9UcmVlTm9kZSc7XG5pbXBvcnQgeyBmb3JtYXRNaWxsaXNlY29uZFRpbWUsIGZvcm1hdFNlY29uZFRpbWUsIE9ORV9TRUNPTkQgfSBmcm9tICcuLi91dGlscy9kYXRlJztcbmltcG9ydCB7IG51bWJlclNvcnRDb21wYXJhdG9yIH0gZnJvbSAnLi4vdXRpbHMvc29ydCc7XG5cbmltcG9ydCB7IGdldFByb2Nlc3NTZXJ2aWNlTmFtZSB9IGZyb20gJy4vcHJvY2Vzcyc7XG5pbXBvcnQge1xuICBnZXRTcGFuSWQsXG4gIGdldFNwYW5OYW1lLFxuICBnZXRTcGFuU2VydmljZU5hbWUsXG4gIGdldFNwYW5UaW1lc3RhbXAsXG4gIGdldFNwYW5EdXJhdGlvbixcbiAgZ2V0U3BhblByb2Nlc3NJZCxcbn0gZnJvbSAnLi9zcGFuJztcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlSWQgPSAodHJhY2U6IFRyYWNlRGF0YSkgPT4gdHJhY2UudHJhY2VJRDtcbmV4cG9ydCBjb25zdCBnZXRUcmFjZVNwYW5zID0gKHRyYWNlOiBUcmFjZVJlc3BvbnNlKSA9PiB0cmFjZS5zcGFucztcbmNvbnN0IGdldFRyYWNlUHJvY2Vzc2VzID0gKHRyYWNlOiBUcmFjZURhdGEgfCBUcmFjZSkgPT4gdHJhY2UucHJvY2Vzc2VzO1xuXG5jb25zdCBnZXRTcGFuV2l0aFByb2Nlc3MgPSBjcmVhdGVTZWxlY3RvcihcbiAgKHN0YXRlOiB7IHNwYW46IFRyYWNlU3BhbkRhdGE7IHByb2Nlc3NlczogUmVjb3JkPHN0cmluZywgVHJhY2VQcm9jZXNzPiB9KSA9PiBzdGF0ZS5zcGFuLFxuICAoc3RhdGU6IHsgc3BhbjogVHJhY2VTcGFuRGF0YTsgcHJvY2Vzc2VzOiBSZWNvcmQ8c3RyaW5nLCBUcmFjZVByb2Nlc3M+IH0pID0+IHN0YXRlLnByb2Nlc3NlcyxcbiAgKHNwYW4sIHByb2Nlc3NlcykgPT4gKHtcbiAgICAuLi5zcGFuLFxuICAgIHByb2Nlc3M6IHByb2Nlc3Nlc1tnZXRTcGFuUHJvY2Vzc0lkKHNwYW4pXSxcbiAgfSlcbik7XG5cbmV4cG9ydCBjb25zdCBnZXRUcmFjZVNwYW5zQXNNYXAgPSBjcmVhdGVTZWxlY3RvcihnZXRUcmFjZVNwYW5zLCAoc3BhbnMpID0+XG4gIHNwYW5zLnJlZHVjZSgobWFwLCBzcGFuOiBUcmFjZVNwYW5EYXRhKSA9PiBtYXAuc2V0KGdldFNwYW5JZChzcGFuKSwgc3BhbiksIG5ldyBNYXAoKSlcbik7XG5cbmV4cG9ydCBjb25zdCBUUkVFX1JPT1RfSUQgPSAnX19yb290X18nO1xuXG4vKipcbiAqIEJ1aWxkIGEgdHJlZSBvZiB7IHZhbHVlOiBzcGFuSUQsIGNoaWxkcmVuIH0gaXRlbXMgZGVyaXZlZCBmcm9tIHRoZVxuICogYHNwYW4ucmVmZXJlbmNlc2AgaW5mb3JtYXRpb24uIFRoZSB0cmVlIHJlcHJlc2VudHMgdGhlIGdyb3VwaW5nIG9mIHBhcmVudCAvXG4gKiBjaGlsZCByZWxhdGlvbnNoaXBzLiBUaGUgcm9vdC1tb3N0IG5vZGUgaXMgbm9taW5hbCBpbiB0aGF0XG4gKiBgLnZhbHVlID09PSBUUkVFX1JPT1RfSURgLiBUaGlzIGlzIGRvbmUgYmVjYXVzZSBhIHJvb3Qgc3BhbiAodGhlIG1haW4gdHJhY2VcbiAqIHNwYW4pIGlzIG5vdCBhbHdheXMgaW5jbHVkZWQgd2l0aCB0aGUgdHJhY2UgZGF0YS4gVGh1cywgdGhlcmUgY2FuIGJlXG4gKiBtdWx0aXBsZSB0b3AtbGV2ZWwgc3BhbnMsIGFuZCB0aGUgcm9vdCBub2RlIGFjdHMgYXMgdGhlaXIgY29tbW9uIHBhcmVudC5cbiAqXG4gKiBUaGUgY2hpbGRyZW4gYXJlIHNvcnRlZCBieSBgc3Bhbi5zdGFydFRpbWVgIGFmdGVyIHRoZSB0cmVlIGlzIGJ1aWx0LlxuICpcbiAqIEBwYXJhbSAge1RyYWNlfSB0cmFjZSBUaGUgdHJhY2UgdG8gYnVpbGQgdGhlIHRyZWUgb2Ygc3BhbklEcy5cbiAqIEByZXR1cm4ge1RyZWVOb2RlfSAgICBBIHRyZWUgb2Ygc3BhbklEcyBkZXJpdmVkIGZyb20gdGhlIHJlbGF0aW9uc2hpcHNcbiAqICAgICAgICAgICAgICAgICAgICAgICBiZXR3ZWVuIHNwYW5zIGluIHRoZSB0cmFjZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFRyYWNlU3Bhbklkc0FzVHJlZSh0cmFjZTogVHJhY2VSZXNwb25zZSkge1xuICBjb25zdCBub2Rlc0J5SWQgPSBuZXcgTWFwKHRyYWNlLnNwYW5zLm1hcCgoc3BhbjogVHJhY2VTcGFuRGF0YSkgPT4gW3NwYW4uc3BhbklELCBuZXcgVHJlZU5vZGUoc3Bhbi5zcGFuSUQpXSkpO1xuICBjb25zdCBzcGFuc0J5SWQgPSBuZXcgTWFwKHRyYWNlLnNwYW5zLm1hcCgoc3BhbjogVHJhY2VTcGFuRGF0YSkgPT4gW3NwYW4uc3BhbklELCBzcGFuXSkpO1xuICBjb25zdCByb290ID0gbmV3IFRyZWVOb2RlKFRSRUVfUk9PVF9JRCk7XG4gIHRyYWNlLnNwYW5zLmZvckVhY2goKHNwYW46IFRyYWNlU3BhbkRhdGEpID0+IHtcbiAgICBjb25zdCBub2RlID0gbm9kZXNCeUlkLmdldChzcGFuLnNwYW5JRCkhO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHNwYW4ucmVmZXJlbmNlcykgJiYgc3Bhbi5yZWZlcmVuY2VzLmxlbmd0aCkge1xuICAgICAgY29uc3QgeyByZWZUeXBlLCBzcGFuSUQ6IHBhcmVudElEIH0gPSBzcGFuLnJlZmVyZW5jZXNbMF07XG4gICAgICBpZiAocmVmVHlwZSA9PT0gJ0NISUxEX09GJyB8fCByZWZUeXBlID09PSAnRk9MTE9XU19GUk9NJykge1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBub2Rlc0J5SWQuZ2V0KHBhcmVudElEKSB8fCByb290O1xuICAgICAgICBwYXJlbnQuY2hpbGRyZW4/LnB1c2gobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVucmVjb2duaXplZCByZWYgdHlwZTogJHtyZWZUeXBlfWApO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByb290LmNoaWxkcmVuLnB1c2gobm9kZSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgY29tcGFyYXRvciA9IChub2RlQTogVHJlZU5vZGUgfCB1bmRlZmluZWQsIG5vZGVCOiBUcmVlTm9kZSB8IHVuZGVmaW5lZCkgPT4ge1xuICAgIGNvbnN0IGE6IFRyYWNlU3BhbkRhdGEgfCB1bmRlZmluZWQgPSBub2RlQT8udmFsdWUgPyBzcGFuc0J5SWQuZ2V0KG5vZGVBLnZhbHVlLnRvU3RyaW5nKCkpIDogdW5kZWZpbmVkO1xuICAgIGNvbnN0IGI6IFRyYWNlU3BhbkRhdGEgfCB1bmRlZmluZWQgPSBub2RlQj8udmFsdWUgPyBzcGFuc0J5SWQuZ2V0KG5vZGVCLnZhbHVlLnRvU3RyaW5nKCkpIDogdW5kZWZpbmVkO1xuICAgIHJldHVybiArKGE/LnN0YXJ0VGltZSEgPiBiPy5zdGFydFRpbWUhKSB8fCArKGE/LnN0YXJ0VGltZSA9PT0gYj8uc3RhcnRUaW1lKSAtIDE7XG4gIH07XG4gIHRyYWNlLnNwYW5zLmZvckVhY2goKHNwYW46IFRyYWNlU3BhbkRhdGEpID0+IHtcbiAgICBjb25zdCBub2RlOiBUcmVlTm9kZSB8IHVuZGVmaW5lZCA9IG5vZGVzQnlJZC5nZXQoc3Bhbi5zcGFuSUQpO1xuICAgIGlmIChub2RlIS5jaGlsZHJlbi5sZW5ndGggPiAxKSB7XG4gICAgICBub2RlPy5jaGlsZHJlbi5zb3J0KGNvbXBhcmF0b3IpO1xuICAgIH1cbiAgfSk7XG4gIHJvb3QuY2hpbGRyZW4uc29ydChjb21wYXJhdG9yKTtcbiAgcmV0dXJuIHJvb3Q7XG59XG5cbi8vIGF0dGFjaCBcInByb2Nlc3NcIiBhcyBhbiBvYmplY3QgdG8gZWFjaCBzcGFuLlxuZXhwb3J0IGNvbnN0IGh5ZHJhdGVTcGFuc1dpdGhQcm9jZXNzZXMgPSAodHJhY2U6IFRyYWNlUmVzcG9uc2UpID0+IHtcbiAgY29uc3Qgc3BhbnMgPSBnZXRUcmFjZVNwYW5zKHRyYWNlKTtcbiAgY29uc3QgcHJvY2Vzc2VzID0gZ2V0VHJhY2VQcm9jZXNzZXModHJhY2UpO1xuXG4gIHJldHVybiB7XG4gICAgLi4udHJhY2UsXG4gICAgc3BhbnM6IHNwYW5zLm1hcCgoc3BhbjogVHJhY2VTcGFuRGF0YSkgPT4gZ2V0U3BhbldpdGhQcm9jZXNzKHsgc3BhbiwgcHJvY2Vzc2VzIH0pKSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRUcmFjZVNwYW5Db3VudCA9IGNyZWF0ZVNlbGVjdG9yKGdldFRyYWNlU3BhbnMsIChzcGFucykgPT4gc3BhbnMubGVuZ3RoKTtcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlVGltZXN0YW1wID0gY3JlYXRlU2VsZWN0b3IoZ2V0VHJhY2VTcGFucywgKHNwYW5zKSA9PlxuICBzcGFucy5yZWR1Y2UoXG4gICAgKHByZXZUaW1lc3RhbXA6IG51bWJlciwgc3BhbjogVHJhY2VTcGFuRGF0YSkgPT5cbiAgICAgIHByZXZUaW1lc3RhbXAgPyBNYXRoLm1pbihwcmV2VGltZXN0YW1wLCBnZXRTcGFuVGltZXN0YW1wKHNwYW4pKSA6IGdldFNwYW5UaW1lc3RhbXAoc3BhbiksXG4gICAgMFxuICApXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0VHJhY2VEdXJhdGlvbiA9IGNyZWF0ZVNlbGVjdG9yKGdldFRyYWNlU3BhbnMsIGdldFRyYWNlVGltZXN0YW1wLCAoc3BhbnMsIHRpbWVzdGFtcCkgPT5cbiAgc3BhbnMucmVkdWNlKFxuICAgIChwcmV2RHVyYXRpb246IG51bWJlciwgc3BhbjogVHJhY2VTcGFuRGF0YSkgPT5cbiAgICAgIHByZXZEdXJhdGlvblxuICAgICAgICA/IE1hdGgubWF4KGdldFNwYW5UaW1lc3RhbXAoc3BhbikgLSB0aW1lc3RhbXAhICsgZ2V0U3BhbkR1cmF0aW9uKHNwYW4pLCBwcmV2RHVyYXRpb24pXG4gICAgICAgIDogZ2V0U3BhbkR1cmF0aW9uKHNwYW4pLFxuICAgIDBcbiAgKVxuKTtcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlRW5kVGltZXN0YW1wID0gY3JlYXRlU2VsZWN0b3IoXG4gIGdldFRyYWNlVGltZXN0YW1wLFxuICBnZXRUcmFjZUR1cmF0aW9uLFxuICAodGltZXN0YW1wOiBudW1iZXIsIGR1cmF0aW9uOiBudW1iZXIpID0+IHRpbWVzdGFtcCEgKyBkdXJhdGlvblxuKTtcblxuZXhwb3J0IGNvbnN0IGdldFBhcmVudFNwYW4gPSBjcmVhdGVTZWxlY3RvcihcbiAgZ2V0VHJhY2VTcGFuSWRzQXNUcmVlLFxuICBnZXRUcmFjZVNwYW5zQXNNYXAsXG4gICh0cmVlLCBzcGFuTWFwKSA9PlxuICAgIHRyZWUuY2hpbGRyZW5cbiAgICAgIC5tYXAoKG5vZGU6IFRyZWVOb2RlKSA9PiBzcGFuTWFwLmdldChub2RlLnZhbHVlKSlcbiAgICAgIC5zb3J0KChzcGFuQTogVHJhY2VTcGFuRGF0YSwgc3BhbkI6IFRyYWNlU3BhbkRhdGEpID0+XG4gICAgICAgIG51bWJlclNvcnRDb21wYXJhdG9yKGdldFNwYW5UaW1lc3RhbXAoc3BhbkEpLCBnZXRTcGFuVGltZXN0YW1wKHNwYW5CKSlcbiAgICAgIClbMF1cbik7XG5cbmV4cG9ydCBjb25zdCBnZXRUcmFjZURlcHRoID0gY3JlYXRlU2VsZWN0b3IoZ2V0VHJhY2VTcGFuSWRzQXNUcmVlLCAoc3BhblRyZWUpID0+IHNwYW5UcmVlLmRlcHRoIC0gMSk7XG5cbmV4cG9ydCBjb25zdCBnZXRTcGFuRGVwdGhGb3JUcmFjZSA9IGNyZWF0ZVNlbGVjdG9yKFxuICBjcmVhdGVTZWxlY3Rvcigoc3RhdGU6IHsgdHJhY2U6IFRyYWNlUmVzcG9uc2UgfSkgPT4gc3RhdGUudHJhY2UsIGdldFRyYWNlU3Bhbklkc0FzVHJlZSksXG4gIGNyZWF0ZVNlbGVjdG9yKChzdGF0ZTogeyBzcGFuOiBUcmFjZVNwYW5EYXRhIH0pID0+IHN0YXRlLnNwYW4sIGdldFNwYW5JZCksXG4gIChub2RlLCBzcGFuSUQpID0+IG5vZGUuZ2V0UGF0aChzcGFuSUQpIS5sZW5ndGggLSAxXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0VHJhY2VTZXJ2aWNlcyA9IGNyZWF0ZVNlbGVjdG9yKGdldFRyYWNlUHJvY2Vzc2VzLCAocHJvY2Vzc2VzKSA9PlxuICBPYmplY3Qua2V5cyhwcm9jZXNzZXMpLnJlZHVjZShcbiAgICAoc2VydmljZXMsIHByb2Nlc3NJRCkgPT4gc2VydmljZXMuYWRkKGdldFByb2Nlc3NTZXJ2aWNlTmFtZShwcm9jZXNzZXNbcHJvY2Vzc0lEXSkpLFxuICAgIG5ldyBTZXQoKVxuICApXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0VHJhY2VTZXJ2aWNlQ291bnQgPSBjcmVhdGVTZWxlY3RvcihnZXRUcmFjZVNlcnZpY2VzLCAoc2VydmljZXMpID0+IHNlcnZpY2VzLnNpemUpO1xuXG4vLyBlc3RhYmxpc2ggY29uc3RhbnRzIHRvIGRldGVybWluZSBob3cgbWF0aCBzaG91bGQgYmUgaGFuZGxlZFxuLy8gZm9yIG5hbm9zZWNvbmQtdG8tbWlsbGlzZWNvbmQgY29udmVyc2lvbnMuXG5leHBvcnQgY29uc3QgRFVSQVRJT05fRk9STUFUVEVSUyA9IHtcbiAgbXM6IGZvcm1hdE1pbGxpc2Vjb25kVGltZSxcbiAgczogZm9ybWF0U2Vjb25kVGltZSxcbn07XG5cbmNvbnN0IGdldER1cmF0aW9uRm9ybWF0dGVyRm9yVHJhY2UgPSBjcmVhdGVTZWxlY3RvcihnZXRUcmFjZUR1cmF0aW9uLCAodG90YWxEdXJhdGlvbjogbnVtYmVyKSA9PlxuICB0b3RhbER1cmF0aW9uID49IE9ORV9TRUNPTkQgPyBEVVJBVElPTl9GT1JNQVRURVJTLnMgOiBEVVJBVElPTl9GT1JNQVRURVJTLm1zXG4pO1xuXG5leHBvcnQgY29uc3QgZm9ybWF0RHVyYXRpb25Gb3JVbml0ID0gY3JlYXRlU2VsZWN0b3IoXG4gICh7IGR1cmF0aW9uIH06IHsgZHVyYXRpb246IG51bWJlciB9KSA9PiBkdXJhdGlvbixcbiAgKHsgdW5pdCB9OiB7IHVuaXQ6ICdtcycgfCAncycgfSkgPT4gRFVSQVRJT05fRk9STUFUVEVSU1t1bml0XSxcbiAgKGR1cmF0aW9uLCBmb3JtYXR0ZXIpID0+IGZvcm1hdHRlcihkdXJhdGlvbilcbik7XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREdXJhdGlvbkZvclRyYWNlID0gY3JlYXRlU2VsZWN0b3IoXG4gICh7IGR1cmF0aW9uIH06IHsgZHVyYXRpb246IG51bWJlciB9KSA9PiBkdXJhdGlvbixcbiAgY3JlYXRlU2VsZWN0b3IoKHsgdHJhY2UgfTogeyB0cmFjZTogVHJhY2VSZXNwb25zZSB9KSA9PiB0cmFjZSwgZ2V0RHVyYXRpb25Gb3JtYXR0ZXJGb3JUcmFjZSksXG4gIChkdXJhdGlvbiwgZm9ybWF0dGVyKSA9PiBmb3JtYXR0ZXIoZHVyYXRpb24pXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0U29ydGVkU3BhbnMgPSBjcmVhdGVTZWxlY3RvcihcbiAgKHsgdHJhY2UgfTogeyB0cmFjZTogVHJhY2VSZXNwb25zZSB9KSA9PiB0cmFjZSxcbiAgKHsgc3BhbnMgfTogeyBzcGFuczogVHJhY2VTcGFuRGF0YVtdIH0pID0+IHNwYW5zLFxuICAoe1xuICAgIHNvcnQsXG4gIH06IHtcbiAgICBzb3J0OiB7XG4gICAgICBkaXI6IG51bWJlcjtcbiAgICAgIGNvbXBhcmF0b3I6IChpdGVtQTogbnVtYmVyLCBpdGVtQjogbnVtYmVyKSA9PiBudW1iZXI7XG4gICAgICBzZWxlY3RvcjogKGl0ZW1BOiBUcmFjZVNwYW5EYXRhLCBpdGVtQjogVHJhY2VSZXNwb25zZSkgPT4gbnVtYmVyO1xuICAgIH07XG4gIH0pID0+IHNvcnQsXG4gICh0cmFjZSwgc3BhbnMsIHsgZGlyLCBjb21wYXJhdG9yLCBzZWxlY3RvciB9KSA9PlxuICAgIFsuLi5zcGFuc10uc29ydCgoc3BhbkEsIHNwYW5CKSA9PiBkaXIgKiBjb21wYXJhdG9yKHNlbGVjdG9yKHNwYW5BLCB0cmFjZSksIHNlbGVjdG9yKHNwYW5CLCB0cmFjZSkpKVxuKTtcblxuY29uc3QgZ2V0VHJhY2VTcGFuc0J5SGllcmFyY2h5UG9zaXRpb24gPSBjcmVhdGVTZWxlY3RvcihnZXRUcmFjZVNwYW5JZHNBc1RyZWUsICh0cmVlKSA9PiB7XG4gIGNvbnN0IGhpZXJhcmNoeVBvc2l0aW9uTWFwID0gbmV3IE1hcCgpO1xuICBsZXQgaSA9IDA7XG4gIHRyZWUud2Fsaygoc3BhbklEOiBzdHJpbmcgfCBudW1iZXIgfCB1bmRlZmluZWQpID0+IGhpZXJhcmNoeVBvc2l0aW9uTWFwLnNldChzcGFuSUQsIGkrKykpO1xuICByZXR1cm4gaGllcmFyY2h5UG9zaXRpb25NYXA7XG59KTtcblxuZXhwb3J0IGNvbnN0IGdldFRyZWVTaXplRm9yVHJhY2VTcGFuID0gY3JlYXRlU2VsZWN0b3IoXG4gIGNyZWF0ZVNlbGVjdG9yKChzdGF0ZTogeyB0cmFjZTogVHJhY2VSZXNwb25zZSB9KSA9PiBzdGF0ZS50cmFjZSwgZ2V0VHJhY2VTcGFuSWRzQXNUcmVlKSxcbiAgY3JlYXRlU2VsZWN0b3IoKHN0YXRlOiB7IHNwYW46IFRyYWNlU3BhbkRhdGEgfSkgPT4gc3RhdGUuc3BhbiwgZ2V0U3BhbklkKSxcbiAgKHRyZWUsIHNwYW5JRCkgPT4ge1xuICAgIGNvbnN0IG5vZGUgPSB0cmVlLmZpbmQoc3BhbklEKTtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgcmV0dXJuIG5vZGUuc2l6ZSAtIDE7XG4gIH1cbik7XG5cbmV4cG9ydCBjb25zdCBnZXRTcGFuSGllcmFyY2h5U29ydFBvc2l0aW9uRm9yVHJhY2UgPSBjcmVhdGVTZWxlY3RvcihcbiAgY3JlYXRlU2VsZWN0b3IoKHsgdHJhY2UgfTogeyB0cmFjZTogVHJhY2UgfSkgPT4gdHJhY2UsIGdldFRyYWNlU3BhbnNCeUhpZXJhcmNoeVBvc2l0aW9uKSxcbiAgKHsgc3BhbiB9OiB7IHNwYW46IFRyYWNlU3BhbiB9KSA9PiBzcGFuLFxuICAoaGllcmFyY2h5UG9zaXRpb25NYXAsIHNwYW4pID0+IGhpZXJhcmNoeVBvc2l0aW9uTWFwLmdldChnZXRTcGFuSWQoc3BhbikpXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0VHJhY2VOYW1lID0gY3JlYXRlU2VsZWN0b3IoXG4gIGNyZWF0ZVNlbGVjdG9yKFxuICAgIGNyZWF0ZVNlbGVjdG9yKGh5ZHJhdGVTcGFuc1dpdGhQcm9jZXNzZXMsIGdldFBhcmVudFNwYW4pLFxuICAgIGNyZWF0ZVN0cnVjdHVyZWRTZWxlY3Rvcih7XG4gICAgICBuYW1lOiBnZXRTcGFuTmFtZSxcbiAgICAgIHNlcnZpY2VOYW1lOiBnZXRTcGFuU2VydmljZU5hbWUsXG4gICAgfSlcbiAgKSxcbiAgKHsgbmFtZSwgc2VydmljZU5hbWUgfTogeyBuYW1lOiBzdHJpbmc7IHNlcnZpY2VOYW1lOiBzdHJpbmcgfSkgPT4gYCR7c2VydmljZU5hbWV9OiAke25hbWV9YFxuKTtcblxuZXhwb3J0IGNvbnN0IG9taXRDb2xsYXBzZWRTcGFucyA9IGNyZWF0ZVNlbGVjdG9yKFxuICAoeyBzcGFucyB9OiB7IHNwYW5zOiBUcmFjZVNwYW5EYXRhW10gfSkgPT4gc3BhbnMsXG4gIGNyZWF0ZVNlbGVjdG9yKCh7IHRyYWNlIH06IHsgdHJhY2U6IFRyYWNlUmVzcG9uc2UgfSkgPT4gdHJhY2UsIGdldFRyYWNlU3Bhbklkc0FzVHJlZSksXG4gICh7IGNvbGxhcHNlZCB9OiB7IGNvbGxhcHNlZDogc3RyaW5nW10gfSkgPT4gY29sbGFwc2VkLFxuICAoc3BhbnMsIHRyZWUsIGNvbGxhcHNlKSA9PiB7XG4gICAgY29uc3QgaGlkZGVuU3BhbklkcyA9IGNvbGxhcHNlLnJlZHVjZSgocmVzdWx0LCBjb2xsYXBzZWRTcGFuSWQpID0+IHtcbiAgICAgIHRyZWUuZmluZChjb2xsYXBzZWRTcGFuSWQpIS53YWxrKChpZDogc3RyaW5nIHwgbnVtYmVyIHwgdW5kZWZpbmVkKSA9PiBpZCAhPT0gY29sbGFwc2VkU3BhbklkICYmIHJlc3VsdC5hZGQoaWQpKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSwgbmV3IFNldCgpKTtcblxuICAgIHJldHVybiBoaWRkZW5TcGFuSWRzLnNpemUgPiAwID8gc3BhbnMuZmlsdGVyKChzcGFuKSA9PiAhaGlkZGVuU3Bhbklkcy5oYXMoZ2V0U3BhbklkKHNwYW4pKSkgOiBzcGFucztcbiAgfVxuKTtcblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfVElDS19JTlRFUlZBTCA9IDQ7XG5leHBvcnQgY29uc3QgREVGQVVMVF9USUNLX1dJRFRIID0gMztcbmV4cG9ydCBjb25zdCBnZXRUaWNrc0ZvclRyYWNlID0gY3JlYXRlU2VsZWN0b3IoXG4gICh7IHRyYWNlIH06IHsgdHJhY2U6IFRyYWNlUmVzcG9uc2UgfSkgPT4gdHJhY2UsXG4gICh7IGludGVydmFsID0gREVGQVVMVF9USUNLX0lOVEVSVkFMIH06IHsgaW50ZXJ2YWw/OiBudW1iZXIgfSkgPT4gaW50ZXJ2YWwsXG4gICh7IHdpZHRoID0gREVGQVVMVF9USUNLX1dJRFRIIH06IHsgd2lkdGg/OiBudW1iZXIgfSkgPT4gd2lkdGgsXG4gIChcbiAgICB0cmFjZSxcbiAgICBpbnRlcnZhbDogbnVtYmVyLFxuICAgIHdpZHRoOiBudW1iZXJcbiAgICAvLyB0aW1lc3RhbXBzIHdpbGwgYmUgc3BhY2VkIG92ZXIgdGhlIGludGVydmFsLCBzdGFydGluZyBmcm9tIHRoZSBpbml0aWFsIHRpbWVzdGFtcFxuICApID0+XG4gICAgWy4uLkFycmF5KGludGVydmFsICsgMSkua2V5cygpXS5tYXAoKG51bSkgPT4gKHtcbiAgICAgIHRpbWVzdGFtcDogZ2V0VHJhY2VUaW1lc3RhbXAodHJhY2UpICsgZ2V0VHJhY2VEdXJhdGlvbih0cmFjZSkgKiAobnVtIC8gaW50ZXJ2YWwpLFxuICAgICAgd2lkdGgsXG4gICAgfSkpXG4pO1xuXG4vLyBUT0RPOiBkZWxldGUgdGhpcyB3aGVuIHRoZSBiYWNrZW5kIGNhbiBlbnN1cmUgdW5pcXVlbmVzc1xuLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbmV4cG9ydCBjb25zdCBlbmZvcmNlVW5pcXVlU3BhbklkcyA9IGNyZWF0ZVNlbGVjdG9yKFxuICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyAodHJhY2U6IFRyYWNlKSA9PiB0cmFjZSxcbiAgZ2V0VHJhY2VTcGFucyxcbiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gKHRyYWNlLCBzcGFucykgPT4ge1xuICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTtcblxuICAgIGNvbnN0IHNwYW5BcnJheTogVHJhY2VTcGFuRGF0YVtdID0gW107XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4udHJhY2UsXG4gICAgICBzcGFuczogc3BhbnMucmVkdWNlKChyZXN1bHQ6IFRyYWNlU3BhbkRhdGFbXSwgc3BhbjogVHJhY2VTcGFuRGF0YSkgPT4ge1xuICAgICAgICBjb25zdCBzcGFuSUQgPSBtYXAuaGFzKGdldFNwYW5JZChzcGFuKSkgPyBgJHtnZXRTcGFuSWQoc3Bhbil9XyR7bWFwLmdldChnZXRTcGFuSWQoc3BhbikpfWAgOiBnZXRTcGFuSWQoc3Bhbik7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRTcGFuID0geyAuLi5zcGFuLCBzcGFuSUQgfTtcblxuICAgICAgICBpZiAoc3BhbklEICE9PSBnZXRTcGFuSWQoc3BhbikpIHtcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICAgIGNvbnNvbGUud2FybignZHVwbGljYXRlIHNwYW5JRCBpbiB0cmFjZSByZXBsYWNlZCcsIGdldFNwYW5JZChzcGFuKSwgJ25ldzonLCBzcGFuSUQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2V0IHRoZSBwcmVzZW5jZSBvZiB0aGUgc3BhbiBpbiB0aGUgbWFwIG9yIGluY3JlbWVudCB0aGUgbnVtYmVyXG4gICAgICAgIG1hcC5zZXQoZ2V0U3BhbklkKHNwYW4pLCAobWFwLmdldChnZXRTcGFuSWQoc3BhbikpIHx8IDApICsgMSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdC5jb25jYXQoW3VwZGF0ZWRTcGFuXSk7XG4gICAgICB9LCBzcGFuQXJyYXkpLFxuICAgIH07XG4gIH1cbik7XG5cbi8vIFRPRE86IGRlbGV0ZSB0aGlzIHdoZW4gdGhlIGJhY2tlbmQgY2FuIGVuc3VyZSB1bmlxdWVuZXNzXG5leHBvcnQgY29uc3QgZHJvcEVtcHR5U3RhcnRUaW1lU3BhbnMgPSBjcmVhdGVTZWxlY3RvcihcbiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gKHRyYWNlOiBUcmFjZSkgPT4gdHJhY2UsXG4gIGdldFRyYWNlU3BhbnMsXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovICh0cmFjZSwgc3BhbnMpID0+ICh7XG4gICAgLi4udHJhY2UsXG4gICAgc3BhbnM6IHNwYW5zLmZpbHRlcigoc3BhbjogVHJhY2VTcGFuRGF0YSkgPT4gISFnZXRTcGFuVGltZXN0YW1wKHNwYW4pKSxcbiAgfSlcbik7XG4iXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTQSxjQUFjLEVBQUVDLHdCQUF3QixRQUFRLFVBQVU7QUFHbkUsT0FBT0MsUUFBUSxNQUFNLG1CQUFtQjtBQUN4QyxTQUFTQyxxQkFBcUIsRUFBRUMsZ0JBQWdCLEVBQUVDLFVBQVUsUUFBUSxlQUFlO0FBQ25GLFNBQVNDLG9CQUFvQixRQUFRLGVBQWU7QUFFcEQsU0FBU0MscUJBQXFCLFFBQVEsV0FBVztBQUNqRCxTQUNFQyxTQUFTLEVBQ1RDLFdBQVcsRUFDWEMsa0JBQWtCLEVBQ2xCQyxnQkFBZ0IsRUFDaEJDLGVBQWUsRUFDZkMsZ0JBQWdCLFFBQ1gsUUFBUTtBQUVmLE9BQU8sSUFBTUMsVUFBVSxHQUFHLFNBQWJBLFVBQVVBLENBQUlDLEtBQWdCO0VBQUEsT0FBS0EsS0FBSyxDQUFDQyxPQUFPO0FBQUE7QUFDN0QsT0FBTyxJQUFNQyxhQUFhLEdBQUcsU0FBaEJBLGFBQWFBLENB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