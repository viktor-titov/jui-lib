import _taggedTemplateLiteralLoose from "@babel/runtime/helpers/taggedTemplateLiteralLoose";
var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6;
// Copyright (c) 2018 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { css } from '@emotion/css';
import cx from 'classnames';
import React, { memo } from 'react';
import { config, reportInteraction } from '@grafana/runtime';
import { Button, useStyles2 } from '@grafana/ui';
import UiFindInput from '../common/UiFindInput';
import { ubFlexAuto, ubJustifyEnd } from '../uberUtilityStyles';

// eslint-disable-next-line no-duplicate-imports
import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
export var getStyles = function getStyles(theme) {
  return {
    TracePageSearchBar: css(_templateObject || (_templateObject = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBar;\n      float: right;\n      position: absolute;\n      top: 0;\n      right: 0;\n      z-index: ", ";\n      background: ", ";\n      margin-bottom: -48px;\n      padding: 8px;\n      margin-right: 2px;\n      border-radius: 4px;\n      box-shadow: ", ";\n    "])), theme.zIndex.navbarFixed, theme.colors.background.primary, theme.shadows.z2),
    TracePageSearchBarBar: css(_templateObject2 || (_templateObject2 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarBar;\n      max-width: 20rem;\n      transition: max-width 0.5s;\n      &:focus-within {\n        max-width: 100%;\n      }\n    "]))),
    TracePageSearchBarSuffix: css(_templateObject3 || (_templateObject3 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarSuffix;\n      opacity: 0.6;\n    "]))),
    TracePageSearchBarBtn: css(_templateObject4 || (_templateObject4 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarBtn;\n      transition: 0.2s;\n      margin-left: 8px;\n    "]))),
    TracePageSearchBarBtnDisabled: css(_templateObject5 || (_templateObject5 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarBtnDisabled;\n      opacity: 0.5;\n    "]))),
    TracePageSearchBarLocateBtn: css(_templateObject6 || (_templateObject6 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarLocateBtn;\n      padding: 1px 8px 4px;\n    "])))
  };
};
export default /*#__PURE__*/memo(function TracePageSearchBar(props) {
  var _cx;
  var navigable = props.navigable,
    setSearch = props.setSearch,
    searchValue = props.searchValue,
    searchBarSuffix = props.searchBarSuffix,
    spanFindMatches = props.spanFindMatches,
    focusedSpanIdForSearch = props.focusedSpanIdForSearch,
    setSearchBarSuffix = props.setSearchBarSuffix,
    setFocusedSpanIdForSearch = props.setFocusedSpanIdForSearch,
    datasourceType = props.datasourceType;
  var styles = useStyles2(getStyles);
  var suffix = searchValue ? /*#__PURE__*/_jsx("span", {
    className: styles.TracePageSearchBarSuffix,
    "aria-label": "Search bar suffix",
    children: searchBarSuffix
  }) : null;
  var btnClass = cx(styles.TracePageSearchBarBtn, (_cx = {}, _cx[styles.TracePageSearchBarBtnDisabled] = !searchValue, _cx));
  var uiFindInputInputProps = {
    className: cx(styles.TracePageSearchBarBar, ubFlexAuto),
    name: 'search',
    suffix: suffix
  };
  var setTraceSearch = function setTraceSearch(value) {
    setFocusedSpanIdForSearch('');
    setSearchBarSuffix('');
    setSearch(value);
  };
  var nextResult = function nextResult() {
    reportInteraction('grafana_traces_trace_view_find_next_prev_clicked', {
      datasourceType: datasourceType,
      grafana_version: config.buildInfo.version,
      direction: 'next'
    });
    var spanMatches = Array.from(spanFindMatches);
    var prevMatchedIndex = spanMatches.indexOf(focusedSpanIdForSearch) ? spanMatches.indexOf(focusedSpanIdForSearch) : 0;

    // new query || at end, go to start
    if (prevMatchedIndex === -1 || prevMatchedIndex === spanMatches.length - 1) {
      setFocusedSpanIdForSearch(spanMatches[0]);
      setSearchBarSuffix(getSearchBarSuffix(1));
      return;
    }

    // get next
    setFocusedSpanIdForSearch(spanMatches[prevMatchedIndex + 1]);
    setSearchBarSuffix(getSearchBarSuffix(prevMatchedIndex + 2));
  };
  var prevResult = function prevResult() {
    reportInteraction('grafana_traces_trace_view_find_next_prev_clicked', {
      datasourceType: datasourceType,
      grafana_version: config.buildInfo.version,
      direction: 'prev'
    });
    var spanMatches = Array.from(spanFindMatches);
    var prevMatchedIndex = spanMatches.indexOf(focusedSpanIdForSearch) ? spanMatches.indexOf(focusedSpanIdForSearch) : 0;

    // new query || at start, go to end
    if (prevMatchedIndex === -1 || prevMatchedIndex === 0) {
      setFocusedSpanIdForSearch(spanMatches[spanMatches.length - 1]);
      setSearchBarSuffix(getSearchBarSuffix(spanMatches.length));
      return;
    }

    // get prev
    setFocusedSpanIdForSearch(spanMatches[prevMatchedIndex - 1]);
    setSearchBarSuffix(getSearchBarSuffix(prevMatchedIndex));
  };
  var getSearchBarSuffix = function getSearchBarSuffix(index) {
    if (spanFindMatches != null && spanFindMatches.size && (spanFindMatches == null ? void 0 : spanFindMatches.size) > 0) {
      return index + ' of ' + (spanFindMatches == null ? void 0 : spanFindMatches.size);
    }
    return '';
  };
  return /*#__PURE__*/_jsx("div", {
    className: styles.TracePageSearchBar,
    children: /*#__PURE__*/_jsxs("span", {
      className: ubJustifyEnd,
      style: {
        display: 'flex'
      },
      children: [/*#__PURE__*/_jsx(UiFindInput, {
        onChange: setTraceSearch,
        value: searchValue,
        inputProps: uiFindInputInputProps,
        allowClear: true
      }), /*#__PURE__*/_jsx(_Fragment, {
        children: navigable && /*#__PURE__*/_jsxs(_Fragment, {
          children: [/*#__PURE__*/_jsx(Button, {
            className: btnClass,
            variant: "secondary",
            disabled: !searchValue,
            type: "button",
            icon: "arrow-down",
            "aria-label": "Next results button",
            onClick: nextResult
          }), /*#__PURE__*/_jsx(Button, {
            className: btnClass,
            variant: "secondary",
            disabled: !searchValue,
            type: "button",
            icon: "arrow-up",
            "aria-label": "Prev results button",
            onClick: prevResult
          })]
        })
      })]
    })
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjc3MiLCJjeCIsIlJlYWN0IiwibWVtbyIsImNvbmZpZyIsInJlcG9ydEludGVyYWN0aW9uIiwiQnV0dG9uIiwidXNlU3R5bGVzMiIsIlVpRmluZElucHV0IiwidWJGbGV4QXV0byIsInViSnVzdGlmeUVuZCIsImpzeCIsIl9qc3giLCJGcmFnbWVudCIsIl9GcmFnbWVudCIsImpzeHMiLCJfanN4cyIsImdldFN0eWxlcyIsInRoZW1lIiwiVHJhY2VQYWdlU2VhcmNoQmFyIiwiX3RlbXBsYXRlT2JqZWN0IiwiX3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbExvb3NlIiwiekluZGV4IiwibmF2YmFyRml4ZWQiLCJjb2xvcnMiLCJiYWNrZ3JvdW5kIiwicHJpbWFyeSIsInNoYWRvd3MiLCJ6MiIsIlRyYWNlUGFnZVNlYXJjaEJhckJhciIsIl90ZW1wbGF0ZU9iamVjdDIiLCJUcmFjZVBhZ2VTZWFyY2hCYXJTdWZmaXgiLCJfdGVtcGxhdGVPYmplY3QzIiwiVHJhY2VQYWdlU2VhcmNoQmFyQnRuIiwiX3RlbXBsYXRlT2JqZWN0NCIsIlRyYWNlUGFnZVNlYXJjaEJhckJ0bkRpc2FibGVkIiwiX3RlbXBsYXRlT2JqZWN0NSIsIlRyYWNlUGFnZVNlYXJjaEJhckxvY2F0ZUJ0biIsIl90ZW1wbGF0ZU9iamVjdDYiLCJwcm9wcyIsIl9jeCIsIm5hdmlnYWJsZSIsInNldFNlYXJjaCIsInNlYXJjaFZhbHVlIiwic2VhcmNoQmFyU3VmZml4Iiwic3BhbkZpbmRNYXRjaGVzIiwiZm9jdXNlZFNwYW5JZEZvclNlYXJjaCIsInNldFNlYXJjaEJhclN1ZmZpeCIsInNldEZvY3VzZWRTcGFuSWRGb3JTZWFyY2giLCJkYXRhc291cmNlVHlwZSIsInN0eWxlcyIsInN1ZmZpeCIsImNsYXNzTmFtZSIsImNoaWxkcmVuIiwiYnRuQ2xhc3MiLCJ1aUZpbmRJbnB1dElucHV0UHJvcHMiLCJuYW1lIiwic2V0VHJhY2VTZWFyY2giLCJ2YWx1ZSIsIm5leHRSZXN1bHQiLCJncmFmYW5hX3ZlcnNpb24iLCJidWlsZEluZm8iLCJ2ZXJzaW9uIiwiZGlyZWN0aW9uIiwic3Bhbk1hdGNoZXMiLCJBcnJheSIsImZyb20iLCJwcmV2TWF0Y2hlZEluZGV4IiwiaW5kZXhPZiIsImxlbmd0aCIsImdldFNlYXJjaEJhclN1ZmZpeCIsInByZXZSZXN1bHQiLCJpbmRleCIsInNpemUiLCJzdHlsZSIsImRpc3BsYXkiLCJvbkNoYW5nZSIsImlucHV0UHJvcHMiLCJhbGxvd0NsZWFyIiwidmFyaWFudCIsImRpc2FibGVkIiwidHlwZSIsImljb24iLCJvbkNsaWNrIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL1RyYWNlUGFnZUhlYWRlci9UcmFjZVBhZ2VTZWFyY2hCYXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBjc3MgfSBmcm9tICdAZW1vdGlvbi9jc3MnO1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IFJlYWN0LCB7IG1lbW8sIERpc3BhdGNoLCBTZXRTdGF0ZUFjdGlvbiB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgR3JhZmFuYVRoZW1lMiB9IGZyb20gJ0BncmFmYW5hL2RhdGEnO1xuaW1wb3J0IHsgY29uZmlnLCByZXBvcnRJbnRlcmFjdGlvbiB9IGZyb20gJ0BncmFmYW5hL3J1bnRpbWUnO1xuaW1wb3J0IHsgQnV0dG9uLCB1c2VTdHlsZXMyIH0gZnJvbSAnQGdyYWZhbmEvdWknO1xuXG5pbXBvcnQgVWlGaW5kSW5wdXQgZnJvbSAnLi4vY29tbW9uL1VpRmluZElucHV0JztcbmltcG9ydCB7IHViRmxleEF1dG8sIHViSnVzdGlmeUVuZCB9IGZyb20gJy4uL3ViZXJVdGlsaXR5U3R5bGVzJztcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWR1cGxpY2F0ZS1pbXBvcnRzXG5cbmV4cG9ydCBjb25zdCBnZXRTdHlsZXMgPSAodGhlbWU6IEdyYWZhbmFUaGVtZTIpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBUcmFjZVBhZ2VTZWFyY2hCYXI6IGNzc2BcbiAgICAgIGxhYmVsOiBUcmFjZVBhZ2VTZWFyY2hCYXI7XG4gICAgICBmbG9hdDogcmlnaHQ7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICB0b3A6IDA7XG4gICAgICByaWdodDogMDtcbiAgICAgIHotaW5kZXg6ICR7dGhlbWUuekluZGV4Lm5hdmJhckZpeGVkfTtcbiAgICAgIGJhY2tncm91bmQ6ICR7dGhlbWUuY29sb3JzLmJhY2tncm91bmQucHJpbWFyeX07XG4gICAgICBtYXJnaW4tYm90dG9tOiAtNDhweDtcbiAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgIG1hcmdpbi1yaWdodDogMnB4O1xuICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgYm94LXNoYWRvdzogJHt0aGVtZS5zaGFkb3dzLnoyfTtcbiAgICBgLFxuICAgIFRyYWNlUGFnZVNlYXJjaEJhckJhcjogY3NzYFxuICAgICAgbGFiZWw6IFRyYWNlUGFnZVNlYXJjaEJhckJhcjtcbiAgICAgIG1heC13aWR0aDogMjByZW07XG4gICAgICB0cmFuc2l0aW9uOiBtYXgtd2lkdGggMC41cztcbiAgICAgICY6Zm9jdXMtd2l0aGluIHtcbiAgICAgICAgbWF4LXdpZHRoOiAxMDAlO1xuICAgICAgfVxuICAgIGAsXG4gICAgVHJhY2VQYWdlU2VhcmNoQmFyU3VmZml4OiBjc3NgXG4gICAgICBsYWJlbDogVHJhY2VQYWdlU2VhcmNoQmFyU3VmZml4O1xuICAgICAgb3BhY2l0eTogMC42O1xuICAgIGAsXG4gICAgVHJhY2VQYWdlU2VhcmNoQmFyQnRuOiBjc3NgXG4gICAgICBsYWJlbDogVHJhY2VQYWdlU2VhcmNoQmFyQnRuO1xuICAgICAgdHJhbnNpdGlvbjogMC4ycztcbiAgICAgIG1hcmdpbi1sZWZ0OiA4cHg7XG4gICAgYCxcbiAgICBUcmFjZVBhZ2VTZWFyY2hCYXJCdG5EaXNhYmxlZDogY3NzYFxuICAgICAgbGFiZWw6IFRyYWNlUGFnZVNlYXJjaEJhckJ0bkRpc2FibGVkO1xuICAgICAgb3BhY2l0eTogMC41O1xuICAgIGAsXG4gICAgVHJhY2VQYWdlU2VhcmNoQmFyTG9jYXRlQnRuOiBjc3NgXG4gICAgICBsYWJlbDogVHJhY2VQYWdlU2VhcmNoQmFyTG9jYXRlQnRuO1xuICAgICAgcGFkZGluZzogMXB4IDhweCA0cHg7XG4gICAgYCxcbiAgfTtcbn07XG5cbmV4cG9ydCB0eXBlIFRyYWNlUGFnZVNlYXJjaEJhclByb3BzID0ge1xuICBuYXZpZ2FibGU6IGJvb2xlYW47XG4gIHNlYXJjaFZhbHVlOiBzdHJpbmc7XG4gIHNldFNlYXJjaDogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHNlYXJjaEJhclN1ZmZpeDogc3RyaW5nO1xuICBzcGFuRmluZE1hdGNoZXM6IFNldDxzdHJpbmc+IHwgdW5kZWZpbmVkO1xuICBmb2N1c2VkU3BhbklkRm9yU2VhcmNoOiBzdHJpbmc7XG4gIHNldFNlYXJjaEJhclN1ZmZpeDogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248c3RyaW5nPj47XG4gIHNldEZvY3VzZWRTcGFuSWRGb3JTZWFyY2g6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPHN0cmluZz4+O1xuICBkYXRhc291cmNlVHlwZTogc3RyaW5nO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhmdW5jdGlvbiBUcmFjZVBhZ2VTZWFyY2hCYXIocHJvcHM6IFRyYWNlUGFnZVNlYXJjaEJhclByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBuYXZpZ2FibGUsXG4gICAgc2V0U2VhcmNoLFxuICAgIHNlYXJjaFZhbHVlLFxuICAgIHNlYXJjaEJhclN1ZmZpeCxcbiAgICBzcGFuRmluZE1hdGNoZXMsXG4gICAgZm9jdXNlZFNwYW5JZEZvclNlYXJjaCxcbiAgICBzZXRTZWFyY2hCYXJTdWZmaXgsXG4gICAgc2V0Rm9jdXNlZFNwYW5JZEZvclNlYXJjaCxcbiAgICBkYXRhc291cmNlVHlwZSxcbiAgfSA9IHByb3BzO1xuICBjb25zdCBzdHlsZXMgPSB1c2VTdHlsZXMyKGdldFN0eWxlcyk7XG5cbiAgY29uc3Qgc3VmZml4ID0gc2VhcmNoVmFsdWUgPyAoXG4gICAgPHNwYW4gY2xhc3NOYW1lPXtzdHlsZXMuVHJhY2VQYWdlU2VhcmNoQmFyU3VmZml4fSBhcmlhLWxhYmVsPVwiU2VhcmNoIGJhciBzdWZmaXhcIj5cbiAgICAgIHtzZWFyY2hCYXJTdWZmaXh9XG4gICAgPC9zcGFuPlxuICApIDogbnVsbDtcblxuICBjb25zdCBidG5DbGFzcyA9IGN4KHN0eWxlcy5UcmFjZVBhZ2VTZWFyY2hCYXJCdG4sIHsgW3N0eWxlcy5UcmFjZVBhZ2VTZWFyY2hCYXJCdG5EaXNhYmxlZF06ICFzZWFyY2hWYWx1ZSB9KTtcbiAgY29uc3QgdWlGaW5kSW5wdXRJbnB1dFByb3BzID0ge1xuICAgIGNsYXNzTmFtZTogY3goc3R5bGVzLlRyYWNlUGFnZVNlYXJjaEJhckJhciwgdWJGbGV4QXV0byksXG4gICAgbmFtZTogJ3NlYXJjaCcsXG4gICAgc3VmZml4LFxuICB9O1xuXG4gIGNvbnN0IHNldFRyYWNlU2VhcmNoID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICBzZXRGb2N1c2VkU3BhbklkRm9yU2VhcmNoKCcnKTtcbiAgICBzZXRTZWFyY2hCYXJTdWZmaXgoJycpO1xuICAgIHNldFNlYXJjaCh2YWx1ZSk7XG4gIH07XG5cbiAgY29uc3QgbmV4dFJlc3VsdCA9ICgpID0+IHtcbiAgICByZXBvcnRJbnRlcmFjdGlvbignZ3JhZmFuYV90cmFjZXNfdHJhY2Vfdmlld19maW5kX25leHRfcHJldl9jbGlja2VkJywge1xuICAgICAgZGF0YXNvdXJjZVR5cGU6IGRhdGFzb3VyY2VUeXBlLFxuICAgICAgZ3JhZmFuYV92ZXJzaW9uOiBjb25maWcuYnVpbGRJbmZvLnZlcnNpb24sXG4gICAgICBkaXJlY3Rpb246ICduZXh0JyxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNwYW5NYXRjaGVzID0gQXJyYXkuZnJvbShzcGFuRmluZE1hdGNoZXMhKTtcbiAgICBjb25zdCBwcmV2TWF0Y2hlZEluZGV4ID0gc3Bhbk1hdGNoZXMuaW5kZXhPZihmb2N1c2VkU3BhbklkRm9yU2VhcmNoKVxuICAgICAgPyBzcGFuTWF0Y2hlcy5pbmRleE9mKGZvY3VzZWRTcGFuSWRGb3JTZWFyY2gpXG4gICAgICA6IDA7XG5cbiAgICAvLyBuZXcgcXVlcnkgfHwgYXQgZW5kLCBnbyB0byBzdGFydFxuICAgIGlmIChwcmV2TWF0Y2hlZEluZGV4ID09PSAtMSB8fCBwcmV2TWF0Y2hlZEluZGV4ID09PSBzcGFuTWF0Y2hlcy5sZW5ndGggLSAxKSB7XG4gICAgICBzZXRGb2N1c2VkU3BhbklkRm9yU2VhcmNoKHNwYW5NYXRjaGVzWzBdKTtcbiAgICAgIHNldFNlYXJjaEJhclN1ZmZpeChnZXRTZWFyY2hCYXJTdWZmaXgoMSkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGdldCBuZXh0XG4gICAgc2V0Rm9jdXNlZFNwYW5JZEZvclNlYXJjaChzcGFuTWF0Y2hlc1twcmV2TWF0Y2hlZEluZGV4ICsgMV0pO1xuICAgIHNldFNlYXJjaEJhclN1ZmZpeChnZXRTZWFyY2hCYXJTdWZmaXgocHJldk1hdGNoZWRJbmRleCArIDIpKTtcbiAgfTtcblxuICBjb25zdCBwcmV2UmVzdWx0ID0gKCkgPT4ge1xuICAgIHJlcG9ydEludGVyYWN0aW9uKCdncmFmYW5hX3RyYWNlc190cmFjZV92aWV3X2ZpbmRfbmV4dF9wcmV2X2NsaWNrZWQnLCB7XG4gICAgICBkYXRhc291cmNlVHlwZTogZGF0YXNvdXJjZVR5cGUsXG4gICAgICBncmFmYW5hX3ZlcnNpb246IGNvbmZpZy5idWlsZEluZm8udmVyc2lvbixcbiAgICAgIGRpcmVjdGlvbjogJ3ByZXYnLFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc3Bhbk1hdGNoZXMgPSBBcnJheS5mcm9tKHNwYW5GaW5kTWF0Y2hlcyEpO1xuICAgIGNvbnN0IHByZXZNYXRjaGVkSW5kZXggPSBzcGFuTWF0Y2hlcy5pbmRleE9mKGZvY3VzZWRTcGFuSWRGb3JTZWFyY2gpXG4gICAgICA/IHNwYW5NYXRjaGVzLmluZGV4T2YoZm9jdXNlZFNwYW5JZEZvclNlYXJjaClcbiAgICAgIDogMDtcblxuICAgIC8vIG5ldyBxdWVyeSB8fCBhdCBzdGFydCwgZ28gdG8gZW5kXG4gICAgaWYgKHByZXZNYXRjaGVkSW5kZXggPT09IC0xIHx8IHByZXZNYXRjaGVkSW5kZXggPT09IDApIHtcbiAgICAgIHNldEZvY3VzZWRTcGFuSWRGb3JTZWFyY2goc3Bhbk1hdGNoZXNbc3Bhbk1hdGNoZXMubGVuZ3RoIC0gMV0pO1xuICAgICAgc2V0U2VhcmNoQmFyU3VmZml4KGdldFNlYXJjaEJhclN1ZmZpeChzcGFuTWF0Y2hlcy5sZW5ndGgpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBnZXQgcHJldlxuICAgIHNldEZvY3VzZWRTcGFuSWRGb3JTZWFyY2goc3Bhbk1hdGNoZXNbcHJldk1hdGNoZWRJbmRleCAtIDFdKTtcbiAgICBzZXRTZWFyY2hCYXJTdWZmaXgoZ2V0U2VhcmNoQmFyU3VmZml4KHByZXZNYXRjaGVkSW5kZXgpKTtcbiAgfTtcblxuICBjb25zdCBnZXRTZWFyY2hCYXJTdWZmaXggPSAoaW5kZXg6IG51bWJlcik6IHN0cmluZyA9PiB7XG4gICAgaWYgKHNwYW5GaW5kTWF0Y2hlcz8uc2l6ZSAmJiBzcGFuRmluZE1hdGNoZXM/LnNpemUgPiAwKSB7XG4gICAgICByZXR1cm4gaW5kZXggKyAnIG9mICcgKyBzcGFuRmluZE1hdGNoZXM/LnNpemU7XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMuVHJhY2VQYWdlU2VhcmNoQmFyfT5cbiAgICAgIDxzcGFuIGNsYXNzTmFtZT17dWJKdXN0aWZ5RW5kfSBzdHlsZT17eyBkaXNwbGF5OiAnZmxleCcgfX0+XG4gICAgICAgIDxVaUZpbmRJbnB1dFxuICAgICAgICAgIG9uQ2hhbmdlPXtzZXRUcmFjZVNlYXJjaH1cbiAgICAgICAgICB2YWx1ZT17c2VhcmNoVmFsdWV9XG4gICAgICAgICAgaW5wdXRQcm9wcz17dWlGaW5kSW5wdXRJbnB1dFByb3BzfVxuICAgICAgICAgIGFsbG93Q2xlYXI9e3RydWV9XG4gICAgICAgIC8+XG4gICAgICAgIDw+XG4gICAgICAgICAge25hdmlnYWJsZSAmJiAoXG4gICAgICAgICAgICA8PlxuICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtidG5DbGFzc31cbiAgICAgICAgICAgICAgICB2YXJpYW50PVwic2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17IXNlYXJjaFZhbHVlfVxuICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgIGljb249XCJhcnJvdy1kb3duXCJcbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPVwiTmV4dCByZXN1bHRzIGJ1dHRvblwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17bmV4dFJlc3VsdH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YnRuQ2xhc3N9XG4gICAgICAgICAgICAgICAgdmFyaWFudD1cInNlY29uZGFyeVwiXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9eyFzZWFyY2hWYWx1ZX1cbiAgICAgICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBpY29uPVwiYXJyb3ctdXBcIlxuICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJQcmV2IHJlc3VsdHMgYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXtwcmV2UmVzdWx0fVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC8+XG4gICAgICA8L3NwYW4+XG4gICAgPC9kaXY+XG4gICk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTQSxHQUFHLFFBQVEsY0FBYztBQUNsQyxPQUFPQyxFQUFFLE1BQU0sWUFBWTtBQUMzQixPQUFPQyxLQUFLLElBQUlDLElBQUksUUFBa0MsT0FBTztBQUc3RCxTQUFTQyxNQUFNLEVBQUVDLGlCQUFpQixRQUFRLGtCQUFrQjtBQUM1RCxTQUFTQyxNQUFNLEVBQUVDLFVBQVUsUUFBUSxhQUFhO0FBRWhELE9BQU9DLFdBQVcsTUFBTSx1QkFBdUI7QUFDL0MsU0FBU0MsVUFBVSxFQUFFQyxZQUFZLFFBQVEsc0JBQXNCOztBQUUvRDtBQUFBLFNBQUFDLEdBQUEsSUFBQUMsSUFBQSxFQUFB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