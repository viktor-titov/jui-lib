import _extends from "@babel/runtime/helpers/extends";
import _objectWithoutPropertiesLoose from "@babel/runtime/helpers/objectWithoutPropertiesLoose";
import _inheritsLoose from "@babel/runtime/helpers/inheritsLoose";
import _taggedTemplateLiteralLoose from "@babel/runtime/helpers/taggedTemplateLiteralLoose";
var _excluded = ["setSpanNameColumnWidth", "updateNextViewRangeTime", "updateViewRangeTime", "viewRange", "traceTimeline", "theme", "topOfViewRef", "focusedSpanIdForSearch"];
var _templateObject;
// Copyright (c) 2017 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { css } from '@emotion/css';
import React from 'react';
import { config, reportInteraction } from '@grafana/runtime';
import { stylesFactory, withTheme2 } from '@grafana/ui';
import { autoColor } from '../Theme';
import { merge as mergeShortcuts } from '../keyboard-shortcuts';
import TimelineHeaderRow from './TimelineHeaderRow';
import VirtualizedTraceView from './VirtualizedTraceView';
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
var getStyles = stylesFactory(function (theme) {
  return {
    TraceTimelineViewer: css(_templateObject || (_templateObject = _taggedTemplateLiteralLoose(["\n      label: TraceTimelineViewer;\n      border-bottom: 1px solid ", ";\n\n      & .json-markup {\n        line-height: 17px;\n        font-size: 13px;\n        font-family: monospace;\n        white-space: pre-wrap;\n      }\n\n      & .json-markup-key {\n        font-weight: bold;\n      }\n\n      & .json-markup-bool {\n        color: ", ";\n      }\n\n      & .json-markup-string {\n        color: ", ";\n      }\n\n      & .json-markup-null {\n        color: ", ";\n      }\n\n      & .json-markup-number {\n        color: ", ";\n      }\n    "])), autoColor(theme, '#bbb'), autoColor(theme, 'firebrick'), autoColor(theme, 'teal'), autoColor(theme, 'teal'), autoColor(theme, 'blue', 'black'))
  };
});
var NUM_TICKS = 5;

/**
 * `TraceTimelineViewer` now renders the header row because it is sensitive to
 * `props.viewRange.time.cursor`. If `VirtualizedTraceView` renders it, it will
 * re-render the ListView every time the cursor is moved on the trace minimap
 * or `TimelineHeaderRow`.
 */
export var UnthemedTraceTimelineViewer = /*#__PURE__*/function (_React$PureComponent) {
  function UnthemedTraceTimelineViewer(props) {
    var _this;
    _this = _React$PureComponent.call(this, props) || this;
    _this.collapseAll = function () {
      _this.props.collapseAll(_this.props.trace.spans);
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'collapseAll'
      });
    };
    _this.collapseOne = function () {
      _this.props.collapseOne(_this.props.trace.spans);
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'collapseOne'
      });
    };
    _this.expandAll = function () {
      _this.props.expandAll();
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'expandAll'
      });
    };
    _this.expandOne = function () {
      _this.props.expandOne(_this.props.trace.spans);
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'expandOne'
      });
    };
    _this.state = {
      height: 0
    };
    return _this;
  }
  _inheritsLoose(UnthemedTraceTimelineViewer, _React$PureComponent);
  var _proto = UnthemedTraceTimelineViewer.prototype;
  _proto.componentDidMount = function componentDidMount() {
    mergeShortcuts({
      collapseAll: this.collapseAll,
      expandAll: this.expandAll,
      collapseOne: this.collapseOne,
      expandOne: this.expandOne
    });
  };
  _proto.render = function render() {
    var _this2 = this;
    var _this$props = this.props,
      setSpanNameColumnWidth = _this$props.setSpanNameColumnWidth,
      updateNextViewRangeTime = _this$props.updateNextViewRangeTime,
      updateViewRangeTime = _this$props.updateViewRangeTime,
      viewRange = _this$props.viewRange,
      traceTimeline = _this$props.traceTimeline,
      theme = _this$props.theme,
      topOfViewRef = _this$props.topOfViewRef,
      focusedSpanIdForSearch = _this$props.focusedSpanIdForSearch,
      rest = _objectWithoutPropertiesLoose(_this$props, _excluded);
    var trace = rest.trace;
    var styles = getStyles(theme);
    return /*#__PURE__*/_jsxs("div", {
      className: styles.TraceTimelineViewer,
      ref: function ref(_ref) {
        return _ref && _this2.setState({
          height: _ref.getBoundingClientRect().height
        });
      },
      children: [/*#__PURE__*/_jsx(TimelineHeaderRow, {
        duration: trace.duration,
        nameColumnWidth: traceTimeline.spanNameColumnWidth,
        numTicks: NUM_TICKS,
        onCollapseAll: this.collapseAll,
        onCollapseOne: this.collapseOne,
        onColummWidthChange: setSpanNameColumnWidth,
        onExpandAll: this.expandAll,
        onExpandOne: this.expandOne,
        viewRangeTime: viewRange.time,
        updateNextViewRangeTime: updateNextViewRangeTime,
        updateViewRangeTime: updateViewRangeTime,
        columnResizeHandleHeight: this.state.height
      }), /*#__PURE__*/_jsx(VirtualizedTraceView, _extends({}, rest, traceTimeline, {
        setSpanNameColumnWidth: setSpanNameColumnWidth,
        currentViewRangeTime: viewRange.time.current,
        topOfViewRef: topOfViewRef,
        focusedSpanIdForSearch: focusedSpanIdForSearch,
        datasourceType: this.props.datasourceType
      }))]
    });
  };
  return UnthemedTraceTimelineViewer;
}(React.PureComponent);
export default withTheme2(UnthemedTraceTimelineViewer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjc3MiLCJSZWFjdCIsImNvbmZpZyIsInJlcG9ydEludGVyYWN0aW9uIiwic3R5bGVzRmFjdG9yeSIsIndpdGhUaGVtZTIiLCJhdXRvQ29sb3IiLCJtZXJnZSIsIm1lcmdlU2hvcnRjdXRzIiwiVGltZWxpbmVIZWFkZXJSb3ciLCJWaXJ0dWFsaXplZFRyYWNlVmlldyIsImpzeCIsIl9qc3giLCJqc3hzIiwiX2pzeHMiLCJnZXRTdHlsZXMiLCJ0aGVtZSIsIlRyYWNlVGltZWxpbmVWaWV3ZXIiLCJfdGVtcGxhdGVPYmplY3QiLCJfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsTG9vc2UiLCJOVU1fVElDS1MiLCJVbnRoZW1lZFRyYWNlVGltZWxpbmVWaWV3ZXIiLCJfUmVhY3QkUHVyZUNvbXBvbmVudCIsInByb3BzIiwiX3RoaXMiLCJjYWxsIiwiY29sbGFwc2VBbGwiLCJ0cmFjZSIsInNwYW5zIiwiZGF0YXNvdXJjZVR5cGUiLCJncmFmYW5hX3ZlcnNpb24iLCJidWlsZEluZm8iLCJ2ZXJzaW9uIiwidHlwZSIsImNvbGxhcHNlT25lIiwiZXhwYW5kQWxsIiwiZXhwYW5kT25lIiwic3RhdGUiLCJoZWlnaHQiLCJfaW5oZXJpdHNMb29zZSIsIl9wcm90byIsInByb3RvdHlwZSIsImNvbXBvbmVudERpZE1vdW50IiwicmVuZGVyIiwiX3RoaXMyIiwiX3RoaXMkcHJvcHMiLCJzZXRTcGFuTmFtZUNvbHVtbldpZHRoIiwidXBkYXRlTmV4dFZpZXdSYW5nZVRpbWUiLCJ1cGRhdGVWaWV3UmFuZ2VUaW1lIiwidmlld1JhbmdlIiwidHJhY2VUaW1lbGluZSIsInRvcE9mVmlld1JlZiIsImZvY3VzZWRTcGFuSWRGb3JTZWFyY2giLCJyZXN0IiwiX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UiLCJfZXhjbHVkZWQiLCJzdHlsZXMiLCJjbGFzc05hbWUiLCJyZWYiLCJzZXRTdGF0ZSIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImNoaWxkcmVuIiwiZHVyYXRpb24iLCJuYW1lQ29sdW1uV2lkdGgiLCJzcGFuTmFtZUNvbHVtbldpZHRoIiwibnVtVGlja3MiLCJvbkNvbGxhcHNlQWxsIiwib25Db2xsYXBzZU9uZSIsIm9uQ29sdW1tV2lkdGhDaGFuZ2UiLCJvbkV4cGFuZEFsbCIsIm9uRXhwYW5kT25lIiwidmlld1JhbmdlVGltZSIsInRpbWUiLCJjb2x1bW5SZXNpemVIYW5kbGVIZWlnaHQiLCJfZXh0ZW5kcyIsImN1cnJlbnRWaWV3UmFuZ2VUaW1lIiwiY3VycmVudCIsIlB1cmVDb21wb25lbnQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvVHJhY2VUaW1lbGluZVZpZXdlci9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDE3IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbi8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IGNzcyB9IGZyb20gJ0BlbW90aW9uL2Nzcyc7XG5pbXBvcnQgUmVhY3QsIHsgUmVmT2JqZWN0IH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBHcmFmYW5hVGhlbWUyLCBMaW5rTW9kZWwsIFRpbWVab25lIH0gZnJvbSAnQGdyYWZhbmEvZGF0YSc7XG5pbXBvcnQgeyBjb25maWcsIHJlcG9ydEludGVyYWN0aW9uIH0gZnJvbSAnQGdyYWZhbmEvcnVudGltZSc7XG5pbXBvcnQgeyBzdHlsZXNGYWN0b3J5LCB3aXRoVGhlbWUyIH0gZnJvbSAnQGdyYWZhbmEvdWknO1xuXG5pbXBvcnQgeyBBY2Nlc3NvcnMgfSBmcm9tICcuLi9TY3JvbGxNYW5hZ2VyJztcbmltcG9ydCB7IGF1dG9Db2xvciB9IGZyb20gJy4uL1RoZW1lJztcbmltcG9ydCB7IG1lcmdlIGFzIG1lcmdlU2hvcnRjdXRzIH0gZnJvbSAnLi4va2V5Ym9hcmQtc2hvcnRjdXRzJztcbmltcG9ydCB7IFNwYW5CYXJPcHRpb25zIH0gZnJvbSAnLi4vc2V0dGluZ3MvU3BhbkJhclNldHRpbmdzJztcbmltcG9ydCB7IFNwYW5MaW5rRnVuYywgVE5pbCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCBUVHJhY2VUaW1lbGluZSBmcm9tICcuLi90eXBlcy9UVHJhY2VUaW1lbGluZSc7XG5pbXBvcnQgeyBUcmFjZVNwYW4sIFRyYWNlLCBUcmFjZUxvZywgVHJhY2VLZXlWYWx1ZVBhaXIsIFRyYWNlTGluaywgVHJhY2VTcGFuUmVmZXJlbmNlIH0gZnJvbSAnLi4vdHlwZXMvdHJhY2UnO1xuXG5pbXBvcnQgVGltZWxpbmVIZWFkZXJSb3cgZnJvbSAnLi9UaW1lbGluZUhlYWRlclJvdyc7XG5pbXBvcnQgVmlydHVhbGl6ZWRUcmFjZVZpZXcsIHsgVG9wT2ZWaWV3UmVmVHlwZSB9IGZyb20gJy4vVmlydHVhbGl6ZWRUcmFjZVZpZXcnO1xuaW1wb3J0IHsgVFVwZGF0ZVZpZXdSYW5nZVRpbWVGdW5jdGlvbiwgVmlld1JhbmdlLCBWaWV3UmFuZ2VUaW1lVXBkYXRlIH0gZnJvbSAnLi90eXBlcyc7XG5cbnR5cGUgVEV4dHJhY3RVaUZpbmRGcm9tU3RhdGVSZXR1cm4gPSB7XG4gIHVpRmluZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xufTtcblxuY29uc3QgZ2V0U3R5bGVzID0gc3R5bGVzRmFjdG9yeSgodGhlbWU6IEdyYWZhbmFUaGVtZTIpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBUcmFjZVRpbWVsaW5lVmlld2VyOiBjc3NgXG4gICAgICBsYWJlbDogVHJhY2VUaW1lbGluZVZpZXdlcjtcbiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke2F1dG9Db2xvcih0aGVtZSwgJyNiYmInKX07XG5cbiAgICAgICYgLmpzb24tbWFya3VwIHtcbiAgICAgICAgbGluZS1oZWlnaHQ6IDE3cHg7XG4gICAgICAgIGZvbnQtc2l6ZTogMTNweDtcbiAgICAgICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbiAgICAgICAgd2hpdGUtc3BhY2U6IHByZS13cmFwO1xuICAgICAgfVxuXG4gICAgICAmIC5qc29uLW1hcmt1cC1rZXkge1xuICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICAgIH1cblxuICAgICAgJiAuanNvbi1tYXJrdXAtYm9vbCB7XG4gICAgICAgIGNvbG9yOiAke2F1dG9Db2xvcih0aGVtZSwgJ2ZpcmVicmljaycpfTtcbiAgICAgIH1cblxuICAgICAgJiAuanNvbi1tYXJrdXAtc3RyaW5nIHtcbiAgICAgICAgY29sb3I6ICR7YXV0b0NvbG9yKHRoZW1lLCAndGVhbCcpfTtcbiAgICAgIH1cblxuICAgICAgJiAuanNvbi1tYXJrdXAtbnVsbCB7XG4gICAgICAgIGNvbG9yOiAke2F1dG9Db2xvcih0aGVtZSwgJ3RlYWwnKX07XG4gICAgICB9XG5cbiAgICAgICYgLmpzb24tbWFya3VwLW51bWJlciB7XG4gICAgICAgIGNvbG9yOiAke2F1dG9Db2xvcih0aGVtZSwgJ2JsdWUnLCAnYmxhY2snKX07XG4gICAgICB9XG4gICAgYCxcbiAgfTtcbn0pO1xuXG5leHBvcnQgdHlwZSBUUHJvcHMgPSBURXh0cmFjdFVpRmluZEZyb21TdGF0ZVJldHVybiAmIHtcbiAgcmVnaXN0ZXJBY2Nlc3NvcnM6IChhY2Nlc3NvcnM6IEFjY2Vzc29ycykgPT4gdm9pZDtcbiAgZmluZE1hdGNoZXNJRHM6IFNldDxzdHJpbmc+IHwgVE5pbDtcbiAgc2Nyb2xsVG9GaXJzdFZpc2libGVTcGFuOiAoKSA9PiB2b2lkO1xuICB0cmFjZVRpbWVsaW5lOiBUVHJhY2VUaW1lbGluZTtcbiAgdHJhY2U6IFRyYWNlO1xuICBkYXRhc291cmNlVHlwZTogc3RyaW5nO1xuICBzcGFuQmFyT3B0aW9uczogU3BhbkJhck9wdGlvbnMgfCB1bmRlZmluZWQ7XG4gIHVwZGF0ZU5leHRWaWV3UmFuZ2VUaW1lOiAodXBkYXRlOiBWaWV3UmFuZ2VUaW1lVXBkYXRlKSA9PiB2b2lkO1xuICB1cGRhdGVWaWV3UmFuZ2VUaW1lOiBUVXBkYXRlVmlld1JhbmdlVGltZUZ1bmN0aW9uO1xuICB2aWV3UmFuZ2U6IFZpZXdSYW5nZTtcbiAgdGltZVpvbmU6IFRpbWVab25lO1xuXG4gIHNldFNwYW5OYW1lQ29sdW1uV2lkdGg6ICh3aWR0aDogbnVtYmVyKSA9PiB2b2lkO1xuICBjb2xsYXBzZUFsbDogKHNwYW5zOiBUcmFjZVNwYW5bXSkgPT4gdm9pZDtcbiAgY29sbGFwc2VPbmU6IChzcGFuczogVHJhY2VTcGFuW10pID0+IHZvaWQ7XG4gIGV4cGFuZEFsbDogKCkgPT4gdm9pZDtcbiAgZXhwYW5kT25lOiAoc3BhbnM6IFRyYWNlU3BhbltdKSA9PiB2b2lkO1xuXG4gIGNoaWxkcmVuVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIGNsZWFyU2hvdWxkU2Nyb2xsVG9GaXJzdFVpRmluZE1hdGNoOiAoKSA9PiB2b2lkO1xuICBkZXRhaWxMb2dJdGVtVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcsIGxvZzogVHJhY2VMb2cpID0+IHZvaWQ7XG4gIGRldGFpbExvZ3NUb2dnbGU6IChzcGFuSUQ6IHN0cmluZykgPT4gdm9pZDtcbiAgZGV0YWlsV2FybmluZ3NUb2dnbGU6IChzcGFuSUQ6IHN0cmluZykgPT4gdm9pZDtcbiAgZGV0YWlsU3RhY2tUcmFjZXNUb2dnbGU6IChzcGFuSUQ6IHN0cmluZykgPT4gdm9pZDtcbiAgZGV0YWlsUmVmZXJlbmNlc1RvZ2dsZTogKHNwYW5JRDogc3RyaW5nKSA9PiB2b2lkO1xuICBkZXRhaWxSZWZlcmVuY2VJdGVtVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcsIHJlZmVyZW5jZTogVHJhY2VTcGFuUmVmZXJlbmNlKSA9PiB2b2lkO1xuICBkZXRhaWxQcm9jZXNzVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIGRldGFpbFRhZ3NUb2dnbGU6IChzcGFuSUQ6IHN0cmluZykgPT4gdm9pZDtcbiAgZGV0YWlsVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHNldFRyYWNlOiAodHJhY2U6IFRyYWNlIHwgVE5pbCwgdWlGaW5kOiBzdHJpbmcgfCBUTmlsKSA9PiB2b2lkO1xuICBhZGRIb3ZlckluZGVudEd1aWRlSWQ6IChzcGFuSUQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcmVtb3ZlSG92ZXJJbmRlbnRHdWlkZUlkOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIGxpbmtzR2V0dGVyOiAoc3BhbjogVHJhY2VTcGFuLCBpdGVtczogVHJhY2VLZXlWYWx1ZVBhaXJbXSwgaXRlbUluZGV4OiBudW1iZXIpID0+IFRyYWNlTGlua1tdO1xuICB0aGVtZTogR3JhZmFuYVRoZW1lMjtcbiAgY3JlYXRlU3Bhbkxpbms/OiBTcGFuTGlua0Z1bmM7XG4gIHNjcm9sbEVsZW1lbnQ/OiBFbGVtZW50O1xuICBmb2N1c2VkU3BhbklkPzogc3RyaW5nO1xuICBmb2N1c2VkU3BhbklkRm9yU2VhcmNoOiBzdHJpbmc7XG4gIGNyZWF0ZUZvY3VzU3Bhbkxpbms6ICh0cmFjZUlkOiBzdHJpbmcsIHNwYW5JZDogc3RyaW5nKSA9PiBMaW5rTW9kZWw7XG4gIHRvcE9mVmlld1JlZj86IFJlZk9iamVjdDxIVE1MRGl2RWxlbWVudD47XG4gIHRvcE9mVmlld1JlZlR5cGU/OiBUb3BPZlZpZXdSZWZUeXBlO1xufTtcblxudHlwZSBTdGF0ZSA9IHtcbiAgLy8gV2lsbCBiZSBzZXQgdG8gcmVhbCBoZWlnaHQgb2YgdGhlIGNvbXBvbmVudCBzbyBpdCBjYW4gYmUgcGFzc2VkIGRvd24gdG8gc2l6ZSBzb21lIG90aGVyIGVsZW1lbnRzLlxuICBoZWlnaHQ6IG51bWJlcjtcbn07XG5cbmNvbnN0IE5VTV9USUNLUyA9IDU7XG5cbi8qKlxuICogYFRyYWNlVGltZWxpbmVWaWV3ZXJgIG5vdyByZW5kZXJzIHRoZSBoZWFkZXIgcm93IGJlY2F1c2UgaXQgaXMgc2Vuc2l0aXZlIHRvXG4gKiBgcHJvcHMudmlld1JhbmdlLnRpbWUuY3Vyc29yYC4gSWYgYFZpcnR1YWxpemVkVHJhY2VWaWV3YCByZW5kZXJzIGl0LCBpdCB3aWxsXG4gKiByZS1yZW5kZXIgdGhlIExpc3RWaWV3IGV2ZXJ5IHRpbWUgdGhlIGN1cnNvciBpcyBtb3ZlZCBvbiB0aGUgdHJhY2UgbWluaW1hcFxuICogb3IgYFRpbWVsaW5lSGVhZGVyUm93YC5cbiAqL1xuZXhwb3J0IGNsYXNzIFVudGhlbWVkVHJhY2VUaW1lbGluZVZpZXdlciBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8VFByb3BzLCBTdGF0ZT4ge1xuICBjb25zdHJ1Y3Rvcihwcm9wczogVFByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7IGhlaWdodDogMCB9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgbWVyZ2VTaG9ydGN1dHMoe1xuICAgICAgY29sbGFwc2VBbGw6IHRoaXMuY29sbGFwc2VBbGwsXG4gICAgICBleHBhbmRBbGw6IHRoaXMuZXhwYW5kQWxsLFxuICAgICAgY29sbGFwc2VPbmU6IHRoaXMuY29sbGFwc2VPbmUsXG4gICAgICBleHBhbmRPbmU6IHRoaXMuZXhwYW5kT25lLFxuICAgIH0pO1xuICB9XG5cbiAgY29sbGFwc2VBbGwgPSAoKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5jb2xsYXBzZUFsbCh0aGlzLnByb3BzLnRyYWNlLnNwYW5zKTtcbiAgICByZXBvcnRJbnRlcmFjdGlvbignZ3JhZmFuYV90cmFjZXNfdHJhY2VJRF9leHBhbmRfY29sbGFwc2VfY2xpY2tlZCcsIHtcbiAgICAgIGRhdGFzb3VyY2VUeXBlOiB0aGlzLnByb3BzLmRhdGFzb3VyY2VUeXBlLFxuICAgICAgZ3JhZmFuYV92ZXJzaW9uOiBjb25maWcuYnVpbGRJbmZvLnZlcnNpb24sXG4gICAgICB0eXBlOiAnY29sbGFwc2VBbGwnLFxuICAgIH0pO1xuICB9O1xuXG4gIGNvbGxhcHNlT25lID0gKCkgPT4ge1xuICAgIHRoaXMucHJvcHMuY29sbGFwc2VPbmUodGhpcy5wcm9wcy50cmFjZS5zcGFucyk7XG4gICAgcmVwb3J0SW50ZXJhY3Rpb24oJ2dyYWZhbmFfdHJhY2VzX3RyYWNlSURfZXhwYW5kX2NvbGxhcHNlX2NsaWNrZWQnLCB7XG4gICAgICBkYXRhc291cmNlVHlwZTogdGhpcy5wcm9wcy5kYXRhc291cmNlVHlwZSxcbiAgICAgIGdyYWZhbmFfdmVyc2lvbjogY29uZmlnLmJ1aWxkSW5mby52ZXJzaW9uLFxuICAgICAgdHlwZTogJ2NvbGxhcHNlT25lJyxcbiAgICB9KTtcbiAgfTtcblxuICBleHBhbmRBbGwgPSAoKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5leHBhbmRBbGwoKTtcbiAgICByZXBvcnRJbnRlcmFjdGlvbignZ3JhZmFuYV90cmFjZXNfdHJhY2VJRF9leHBhbmRfY29sbGFwc2VfY2xpY2tlZCcsIHtcbiAgICAgIGRhdGFzb3VyY2VUeXBlOiB0aGlzLnByb3BzLmRhdGFzb3VyY2VUeXBlLFxuICAgICAgZ3JhZmFuYV92ZXJzaW9uOiBjb25maWcuYnVpbGRJbmZvLnZlcnNpb24sXG4gICAgICB0eXBlOiAnZXhwYW5kQWxsJyxcbiAgICB9KTtcbiAgfTtcblxuICBleHBhbmRPbmUgPSAoKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5leHBhbmRPbmUodGhpcy5wcm9wcy50cmFjZS5zcGFucyk7XG4gICAgcmVwb3J0SW50ZXJhY3Rpb24oJ2dyYWZhbmFfdHJhY2VzX3RyYWNlSURfZXhwYW5kX2NvbGxhcHNlX2NsaWNrZWQnLCB7XG4gICAgICBkYXRhc291cmNlVHlwZTogdGhpcy5wcm9wcy5kYXRhc291cmNlVHlwZSxcbiAgICAgIGdyYWZhbmFfdmVyc2lvbjogY29uZmlnLmJ1aWxkSW5mby52ZXJzaW9uLFxuICAgICAgdHlwZTogJ2V4cGFuZE9uZScsXG4gICAgfSk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIHNldFNwYW5OYW1lQ29sdW1uV2lkdGgsXG4gICAgICB1cGRhdGVOZXh0Vmlld1JhbmdlVGltZSxcbiAgICAgIHVwZGF0ZVZpZXdSYW5nZVRpbWUsXG4gICAgICB2aWV3UmFuZ2UsXG4gICAgICB0cmFjZVRpbWVsaW5lLFxuICAgICAgdGhlbWUsXG4gICAgICB0b3BPZlZpZXdSZWYsXG4gICAgICBmb2N1c2VkU3BhbklkRm9yU2VhcmNoLFxuICAgICAgLi4ucmVzdFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdHJhY2UgfSA9IHJlc3Q7XG4gICAgY29uc3Qgc3R5bGVzID0gZ2V0U3R5bGVzKHRoZW1lKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLlRyYWNlVGltZWxpbmVWaWV3ZXJ9XG4gICAgICAgIHJlZj17KHJlZjogSFRNTERpdkVsZW1lbnQgfCBudWxsKSA9PiByZWYgJiYgdGhpcy5zZXRTdGF0ZSh7IGhlaWdodDogcmVmLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCB9KX1cbiAgICAgID5cbiAgICAgICAgPFRpbWVsaW5lSGVhZGVyUm93XG4gICAgICAgICAgZHVyYXRpb249e3RyYWNlLmR1cmF0aW9ufVxuICAgICAgICAgIG5hbWVDb2x1bW5XaWR0aD17dHJhY2VUaW1lbGluZS5zcGFuTmFtZUNvbHVtbldpZHRofVxuICAgICAgICAgIG51bVRpY2tzPXtOVU1fVElDS1N9XG4gICAgICAgICAgb25Db2xsYXBzZUFsbD17dGhpcy5jb2xsYXBzZUFsbH1cbiAgICAgICAgICBvbkNvbGxhcHNlT25lPXt0aGlzLmNvbGxhcHNlT25lfVxuICAgICAgICAgIG9uQ29sdW1tV2lkdGhDaGFuZ2U9e3NldFNwYW5OYW1lQ29sdW1uV2lkdGh9XG4gICAgICAgICAgb25FeHBhbmRBbGw9e3RoaXMuZXhwYW5kQWxsfVxuICAgICAgICAgIG9uRXhwYW5kT25lPXt0aGlzLmV4cGFuZE9uZX1cbiAgICAgICAgICB2aWV3UmFuZ2VUaW1lPXt2aWV3UmFuZ2UudGltZX1cbiAgICAgICAgICB1cGRhdGVOZXh0Vmlld1JhbmdlVGltZT17dXBkYXRlTmV4dFZpZXdSYW5nZVRpbWV9XG4gICAgICAgICAgdXBkYXRlVmlld1JhbmdlVGltZT17dXBkYXRlVmlld1JhbmdlVGltZX1cbiAgICAgICAgICBjb2x1bW5SZXNpemVIYW5kbGVIZWlnaHQ9e3RoaXMuc3RhdGUuaGVpZ2h0fVxuICAgICAgICAvPlxuICAgICAgICA8VmlydHVhbGl6ZWRUcmFjZVZpZXdcbiAgICAgICAgICB7Li4ucmVzdH1cbiAgICAgICAgICB7Li4udHJhY2VUaW1lbGluZX1cbiAgICAgICAgICBzZXRTcGFuTmFtZUNvbHVtbldpZHRoPXtzZXRTcGFuTmFtZUNvbHVtbldpZHRofVxuICAgICAgICAgIGN1cnJlbnRWaWV3UmFuZ2VUaW1lPXt2aWV3UmFuZ2UudGltZS5jdXJyZW50fVxuICAgICAgICAgIHRvcE9mVmlld1JlZj17dG9wT2ZWaWV3UmVmfVxuICAgICAgICAgIGZvY3VzZWRTcGFuSWRGb3JTZWFyY2g9e2ZvY3VzZWRTcGFuSWRGb3JTZWFyY2h9XG4gICAgICAgICAgZGF0YXNvdXJjZVR5cGU9e3RoaXMucHJvcHMuZGF0YXNvdXJjZVR5cGV9XG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHdpdGhUaGVtZTIoVW50aGVtZWRUcmFjZVRpbWVsaW5lVmlld2VyKTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsR0FBRyxRQUFRLGNBQWM7QUFDbEMsT0FBT0MsS0FBSyxNQUFxQixPQUFPO0FBR3hDLFNBQVNDLE1BQU0sRUFBRUMsaUJBQWlCLFFBQVEsa0JBQWtCO0FBQzVELFNBQVNDLGFBQWEsRUFBRUMsVUFBVSxRQUFRLGFBQWE7QUFHdkQsU0FBU0MsU0FBUyxRQUFRLFVBQVU7QUFDcEMsU0FBU0MsS0FBSyxJQUFJQyxjQUFjLFFBQVEsdUJBQXVCO0FBTS9ELE9BQU9DLGlCQUFpQixNQUFNLHFCQUFxQjtBQUNuRCxPQUFPQyxvQkFBb0IsTUFBNEIsd0JBQXdCO0FBQUMsU0FBQUMsR0FBQSxJQUFBQyxJQUFBLEVBQUFDLElBQUEsSUFBQUMsS0FBQTtBQU9oRixJQUFNQyxTQUFTLEdBQUdYLGFBQWEsQ0FBQyxVQUFDWSxLQUFvQixFQUFLO0VBQ3hELE9BQU87SUFDTEMsbUJBQW1CLEVBQUVqQixHQUFHLENBQUFrQixlQUFBLEtBQUFBLGVBQUEsR0FBQUMsMkJBQUEsaWpCQUVLYixTQUFTLENBQUNVLEtBQUssRUFBRSxNQUFNLENBQUMsRUFjeENWLFNBQVMsQ0FBQ1UsS0FBSyxFQUFFLFdBQVcsQ0FBQyxFQUk3QlYsU0FBUyxDQUFDVSxLQUFLLEVBQUUsTUFBTSxDQUFDLEVBSXhCVixTQUFTLENBQUNVLEtBQUssRUFBRSxNQUFNLENBQUMsRUFJeEJWLFNBQVMsQ0FBQ1UsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUM7RUFHaEQsQ0FBQztBQUNILENBQUMsQ0FBQztBQW1ERixJQUFNSSxTQUFTLEdBQUcsQ0FBQzs7QUFFbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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