import _extends from "@babel/runtime/helpers/extends";
// Copyright (c) 2019 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import PathElem from './PathElem';
import { simplePath } from './sample-paths.test.resources';
describe('PathElem', function () {
  var getPath = function getPath() {
    var path = {
      focalIdx: 2
    };
    var members = simplePath.map(function (_ref, i) {
      var operation = _ref.operation,
        service = _ref.service;
      return new PathElem({
        memberIdx: i,
        operation: {
          name: operation,
          service: {
            name: service
          }
        },
        path: path
      });
    });
    members[2].visibilityIdx = 0;
    members[3].visibilityIdx = 1;
    members[1].visibilityIdx = 2;
    members[4].visibilityIdx = 3;
    members[0].visibilityIdx = 4;
    path.members = members;
    return path;
  };
  var testMemberIdx = 3;
  var testOperation = {};
  var testPath = {
    focalIdx: 4,
    members: ['member0', 'member1', 'member2', 'member3', 'member4', 'member5']
  };
  var testVisibilityIdx = 105;
  var pathElem;
  beforeEach(function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testMemberIdx
    });
  });
  it('initializes instance properties', function () {
    expect(pathElem.memberIdx).toBe(testMemberIdx);
    expect(pathElem.memberOf).toBe(testPath);
    expect(pathElem.operation).toBe(testOperation);
  });
  it('calculates distance', function () {
    expect(pathElem.distance).toBe(-1);
  });
  it('sets visibilityIdx', function () {
    pathElem.visibilityIdx = testVisibilityIdx;
    expect(pathElem.visibilityIdx).toBe(testVisibilityIdx);
  });
  it('errors when trying to access unset visibilityIdx', function () {
    expect(function () {
      return pathElem.visibilityIdx;
    }).toThrowError();
  });
  it('errors when trying to override visibilityIdx', function () {
    pathElem.visibilityIdx = testVisibilityIdx;
    expect(function () {
      pathElem.visibilityIdx = testVisibilityIdx;
    }).toThrowError();
  });
  it('has externalSideNeighbor if distance is not 0 and it is not external', function () {
    expect(pathElem.externalSideNeighbor).toBe(testPath.members[testMemberIdx - 1]);
  });
  it('has a null externalSideNeighbor if distance is 0', function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testPath.focalIdx
    });
    expect(pathElem.externalSideNeighbor).toBe(null);
  });
  it('has an undefined externalSideNeighbor if is external', function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: 0
    });
    expect(pathElem.externalSideNeighbor).toBe(undefined);
  });
  it('has focalSideNeighbor if distance is not 0', function () {
    expect(pathElem.focalSideNeighbor).toBe(testPath.members[testMemberIdx + 1]);
  });
  it('has a null focalSideNeighbor if distance is 0', function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testPath.focalIdx
    });
    expect(pathElem.focalSideNeighbor).toBe(null);
  });
  it('is external if it is first or last PathElem in memberOf.path and not the focalElem', function () {
    expect(pathElem.isExternal).toBe(false);
    var firstElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: 0
    });
    expect(firstElem.isExternal).toBe(true);
    var lastElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testPath.members.length - 1
    });
    expect(lastElem.isExternal).toBe(true);
    var path = _extends({}, testPath, {
      focalIdx: testPath.members.length - 1
    });
    var focalElem = new PathElem({
      path: path,
      operation: testOperation,
      memberIdx: path.members.length - 1
    });
    expect(focalElem.isExternal).toBe(false);
  });
  describe('externalPath', function () {
    var path = getPath();
    it('returns array of itself if it is focal elem', function () {
      var targetPathElem = path.members[path.focalIdx];
      expect(targetPathElem.externalPath).toEqual([targetPathElem]);
    });
    it('returns path away from focal elem in correct order for upstream elem', function () {
      var idx = path.focalIdx - 1;
      var targetPathElem = path.members[idx];
      expect(targetPathElem.externalPath).toEqual(path.members.slice(0, idx + 1));
    });
    it('returns path away from focal elem in correct order for downstream elem', function () {
      var idx = path.focalIdx + 1;
      var targetPathElem = path.members[idx];
      expect(targetPathElem.externalPath).toEqual(path.members.slice(idx));
    });
  });
  describe('focalPath', function () {
    var path = getPath();
    it('returns array of itself if it is focal elem', function () {
      var targetPathElem = path.members[path.focalIdx];
      expect(targetPathElem.focalPath).toEqual([targetPathElem]);
    });
    it('returns path to focal elem in correct order for upstream elem', function () {
      var targetPathElem = path.members[0];
      expect(targetPathElem.focalPath).toEqual(path.members.slice(0, path.focalIdx + 1));
    });
    it('returns path to focal elem in correct order for downstream elem', function () {
      var idx = path.members.length - 1;
      var targetPathElem = path.members[idx];
      expect(targetPathElem.focalPath).toEqual(path.members.slice(path.focalIdx, idx + 1));
    });
  });
  describe('legibility', function () {
    var path = getPath();
    var targetPathElem = path.members[1];
    it('creates consumable JSON', function () {
      expect(targetPathElem.toJSON()).toMatchSnapshot();
    });
    it('creates consumable string', function () {
      expect(targetPathElem.toString()).toBe(JSON.stringify(targetPathElem.toJSON(), null, 2));
    });
    it('creates informative string tag', function () {
      expect(Object.prototype.toString.call(targetPathElem)).toEqual("[object PathElem " + targetPathElem.visibilityIdx + "]");
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQYXRoRWxlbSIsInNpbXBsZVBhdGgiLCJkZXNjcmliZSIsImdldFBhdGgiLCJwYXRoIiwiZm9jYWxJZHgiLCJtZW1iZXJzIiwibWFwIiwiX3JlZiIsImkiLCJvcGVyYXRpb24iLCJzZXJ2aWNlIiwibWVtYmVySWR4IiwibmFtZSIsInZpc2liaWxpdHlJZHgiLCJ0ZXN0TWVtYmVySWR4IiwidGVzdE9wZXJhdGlvbiIsInRlc3RQYXRoIiwidGVzdFZpc2liaWxpdHlJZHgiLCJwYXRoRWxlbSIsImJlZm9yZUVhY2giLCJpdCIsImV4cGVjdCIsInRvQmUiLCJtZW1iZXJPZiIsImRpc3RhbmNlIiwidG9UaHJvd0Vycm9yIiwiZXh0ZXJuYWxTaWRlTmVpZ2hib3IiLCJ1bmRlZmluZWQiLCJmb2NhbFNpZGVOZWlnaGJvciIsImlzRXh0ZXJuYWwiLCJmaXJzdEVsZW0iLCJsYXN0RWxlbSIsImxlbmd0aCIsIl9leHRlbmRzIiwiZm9jYWxFbGVtIiwidGFyZ2V0UGF0aEVsZW0iLCJleHRlcm5hbFBhdGgiLCJ0b0VxdWFsIiwiaWR4Iiwic2xpY2UiLCJmb2NhbFBhdGgiLCJ0b0pTT04iLCJ0b01hdGNoU25hcHNob3QiLCJ0b1N0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJjYWxsIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZGVsL2RkZy9QYXRoRWxlbS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxOSBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgUGF0aEVsZW0gZnJvbSAnLi9QYXRoRWxlbSc7XG5pbXBvcnQgeyBzaW1wbGVQYXRoIH0gZnJvbSAnLi9zYW1wbGUtcGF0aHMudGVzdC5yZXNvdXJjZXMnO1xuaW1wb3J0IHsgVERkZ09wZXJhdGlvbiwgVERkZ1BhdGgsIFREZGdTZXJ2aWNlIH0gZnJvbSAnLi90eXBlcyc7XG5cbmRlc2NyaWJlKCdQYXRoRWxlbScsICgpID0+IHtcbiAgY29uc3QgZ2V0UGF0aCA9ICgpID0+IHtcbiAgICBjb25zdCBwYXRoID0ge1xuICAgICAgZm9jYWxJZHg6IDIsXG4gICAgfSBhcyBURGRnUGF0aDtcbiAgICBjb25zdCBtZW1iZXJzID0gc2ltcGxlUGF0aC5tYXAoXG4gICAgICAoeyBvcGVyYXRpb24sIHNlcnZpY2UgfSwgaSkgPT5cbiAgICAgICAgbmV3IFBhdGhFbGVtKHtcbiAgICAgICAgICBtZW1iZXJJZHg6IGksXG4gICAgICAgICAgb3BlcmF0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiBvcGVyYXRpb24sXG4gICAgICAgICAgICBzZXJ2aWNlOiB7XG4gICAgICAgICAgICAgIG5hbWU6IHNlcnZpY2UsXG4gICAgICAgICAgICB9IGFzIFREZGdTZXJ2aWNlLFxuICAgICAgICAgIH0gYXMgVERkZ09wZXJhdGlvbixcbiAgICAgICAgICBwYXRoLFxuICAgICAgICB9KVxuICAgICk7XG4gICAgbWVtYmVyc1syXS52aXNpYmlsaXR5SWR4ID0gMDtcbiAgICBtZW1iZXJzWzNdLnZpc2liaWxpdHlJZHggPSAxO1xuICAgIG1lbWJlcnNbMV0udmlzaWJpbGl0eUlkeCA9IDI7XG4gICAgbWVtYmVyc1s0XS52aXNpYmlsaXR5SWR4ID0gMztcbiAgICBtZW1iZXJzWzBdLnZpc2liaWxpdHlJZHggPSA0O1xuICAgIHBhdGgubWVtYmVycyA9IG1lbWJlcnM7XG4gICAgcmV0dXJuIHBhdGg7XG4gIH07XG4gIGNvbnN0IHRlc3RNZW1iZXJJZHggPSAzO1xuICBjb25zdCB0ZXN0T3BlcmF0aW9uID0ge30gYXMgVERkZ09wZXJhdGlvbjtcbiAgY29uc3QgdGVzdFBhdGggPSB7XG4gICAgZm9jYWxJZHg6IDQsXG4gICAgbWVtYmVyczogWydtZW1iZXIwJywgJ21lbWJlcjEnLCAnbWVtYmVyMicsICdtZW1iZXIzJywgJ21lbWJlcjQnLCAnbWVtYmVyNSddLFxuICB9IGFzIHVua25vd24gYXMgVERkZ1BhdGg7XG4gIGNvbnN0IHRlc3RWaXNpYmlsaXR5SWR4ID0gMTA1O1xuICBsZXQgcGF0aEVsZW06IFBhdGhFbGVtO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHBhdGhFbGVtID0gbmV3IFBhdGhFbGVtKHsgcGF0aDogdGVzdFBhdGgsIG9wZXJhdGlvbjogdGVzdE9wZXJhdGlvbiwgbWVtYmVySWR4OiB0ZXN0TWVtYmVySWR4IH0pO1xuICB9KTtcblxuICBpdCgnaW5pdGlhbGl6ZXMgaW5zdGFuY2UgcHJvcGVydGllcycsICgpID0+IHtcbiAgICBleHBlY3QocGF0aEVsZW0ubWVtYmVySWR4KS50b0JlKHRlc3RNZW1iZXJJZHgpO1xuICAgIGV4cGVjdChwYXRoRWxlbS5tZW1iZXJPZikudG9CZSh0ZXN0UGF0aCk7XG4gICAgZXhwZWN0KHBhdGhFbGVtLm9wZXJhdGlvbikudG9CZSh0ZXN0T3BlcmF0aW9uKTtcbiAgfSk7XG5cbiAgaXQoJ2NhbGN1bGF0ZXMgZGlzdGFuY2UnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHBhdGhFbGVtLmRpc3RhbmNlKS50b0JlKC0xKTtcbiAgfSk7XG5cbiAgaXQoJ3NldHMgdmlzaWJpbGl0eUlkeCcsICgpID0+IHtcbiAgICBwYXRoRWxlbS52aXNpYmlsaXR5SWR4ID0gdGVzdFZpc2liaWxpdHlJZHg7XG4gICAgZXhwZWN0KHBhdGhFbGVtLnZpc2liaWxpdHlJZHgpLnRvQmUodGVzdFZpc2liaWxpdHlJZHgpO1xuICB9KTtcblxuICBpdCgnZXJyb3JzIHdoZW4gdHJ5aW5nIHRvIGFjY2VzcyB1bnNldCB2aXNpYmlsaXR5SWR4JywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBwYXRoRWxlbS52aXNpYmlsaXR5SWR4KS50b1Rocm93RXJyb3IoKTtcbiAgfSk7XG5cbiAgaXQoJ2Vycm9ycyB3aGVuIHRyeWluZyB0byBvdmVycmlkZSB2aXNpYmlsaXR5SWR4JywgKCkgPT4ge1xuICAgIHBhdGhFbGVtLnZpc2liaWxpdHlJZHggPSB0ZXN0VmlzaWJpbGl0eUlkeDtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgcGF0aEVsZW0udmlzaWJpbGl0eUlkeCA9IHRlc3RWaXNpYmlsaXR5SWR4O1xuICAgIH0pLnRvVGhyb3dFcnJvcigpO1xuICB9KTtcblxuICBpdCgnaGFzIGV4dGVybmFsU2lkZU5laWdoYm9yIGlmIGRpc3RhbmNlIGlzIG5vdCAwIGFuZCBpdCBpcyBub3QgZXh0ZXJuYWwnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHBhdGhFbGVtLmV4dGVybmFsU2lkZU5laWdoYm9yKS50b0JlKHRlc3RQYXRoLm1lbWJlcnNbdGVzdE1lbWJlcklkeCAtIDFdKTtcbiAgfSk7XG5cbiAgaXQoJ2hhcyBhIG51bGwgZXh0ZXJuYWxTaWRlTmVpZ2hib3IgaWYgZGlzdGFuY2UgaXMgMCcsICgpID0+IHtcbiAgICBwYXRoRWxlbSA9IG5ldyBQYXRoRWxlbSh7IHBhdGg6IHRlc3RQYXRoLCBvcGVyYXRpb246IHRlc3RPcGVyYXRpb24sIG1lbWJlcklkeDogdGVzdFBhdGguZm9jYWxJZHggfSk7XG4gICAgZXhwZWN0KHBhdGhFbGVtLmV4dGVybmFsU2lkZU5laWdoYm9yKS50b0JlKG51bGwpO1xuICB9KTtcblxuICBpdCgnaGFzIGFuIHVuZGVmaW5lZCBleHRlcm5hbFNpZGVOZWlnaGJvciBpZiBpcyBleHRlcm5hbCcsICgpID0+IHtcbiAgICBwYXRoRWxlbSA9IG5ldyBQYXRoRWxlbSh7IHBhdGg6IHRlc3RQYXRoLCBvcGVyYXRpb246IHRlc3RPcGVyYXRpb24sIG1lbWJlcklkeDogMCB9KTtcbiAgICBleHBlY3QocGF0aEVsZW0uZXh0ZXJuYWxTaWRlTmVpZ2hib3IpLnRvQmUodW5kZWZpbmVkKTtcbiAgfSk7XG5cbiAgaXQoJ2hhcyBmb2NhbFNpZGVOZWlnaGJvciBpZiBkaXN0YW5jZSBpcyBub3QgMCcsICgpID0+IHtcbiAgICBleHBlY3QocGF0aEVsZW0uZm9jYWxTaWRlTmVpZ2hib3IpLnRvQmUodGVzdFBhdGgubWVtYmVyc1t0ZXN0TWVtYmVySWR4ICsgMV0pO1xuICB9KTtcblxuICBpdCgnaGFzIGEgbnVsbCBmb2NhbFNpZGVOZWlnaGJvciBpZiBkaXN0YW5jZSBpcyAwJywgKCkgPT4ge1xuICAgIHBhdGhFbGVtID0gbmV3IFBhdGhFbGVtKHsgcGF0aDogdGVzdFBhdGgsIG9wZXJhdGlvbjogdGVzdE9wZXJhdGlvbiwgbWVtYmVySWR4OiB0ZXN0UGF0aC5mb2NhbElkeCB9KTtcbiAgICBleHBlY3QocGF0aEVsZW0uZm9jYWxTaWRlTmVpZ2hib3IpLnRvQmUobnVsbCk7XG4gIH0pO1xuXG4gIGl0KCdpcyBleHRlcm5hbCBpZiBpdCBpcyBmaXJzdCBvciBsYXN0IFBhdGhFbGVtIGluIG1lbWJlck9mLnBhdGggYW5kIG5vdCB0aGUgZm9jYWxFbGVtJywgKCkgPT4ge1xuICAgIGV4cGVjdChwYXRoRWxlbS5pc0V4dGVybmFsKS50b0JlKGZhbHNlKTtcblxuICAgIGNvbnN0IGZpcnN0RWxlbSA9IG5ldyBQYXRoRWxlbSh7IHBhdGg6IHRlc3RQYXRoLCBvcGVyYXRpb246IHRlc3RPcGVyYXRpb24sIG1lbWJlcklkeDogMCB9KTtcbiAgICBleHBlY3QoZmlyc3RFbGVtLmlzRXh0ZXJuYWwpLnRvQmUodHJ1ZSk7XG5cbiAgICBjb25zdCBsYXN0RWxlbSA9IG5ldyBQYXRoRWxlbSh7XG4gICAgICBwYXRoOiB0ZXN0UGF0aCxcbiAgICAgIG9wZXJhdGlvbjogdGVzdE9wZXJhdGlvbixcbiAgICAgIG1lbWJlcklkeDogdGVzdFBhdGgubWVtYmVycy5sZW5ndGggLSAxLFxuICAgIH0pO1xuICAgIGV4cGVjdChsYXN0RWxlbS5pc0V4dGVybmFsKS50b0JlKHRydWUpO1xuXG4gICAgY29uc3QgcGF0aCA9IHtcbiAgICAgIC4uLnRlc3RQYXRoLFxuICAgICAgZm9jYWxJZHg6IHRlc3RQYXRoLm1lbWJlcnMubGVuZ3RoIC0gMSxcbiAgICB9O1xuICAgIGNvbnN0IGZvY2FsRWxlbSA9IG5ldyBQYXRoRWxlbSh7IHBhdGgsIG9wZXJhdGlvbjogdGVzdE9wZXJhdGlvbiwgbWVtYmVySWR4OiBwYXRoLm1lbWJlcnMubGVuZ3RoIC0gMSB9KTtcbiAgICBleHBlY3QoZm9jYWxFbGVtLmlzRXh0ZXJuYWwpLnRvQmUoZmFsc2UpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXh0ZXJuYWxQYXRoJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhdGggPSBnZXRQYXRoKCk7XG5cbiAgICBpdCgncmV0dXJucyBhcnJheSBvZiBpdHNlbGYgaWYgaXQgaXMgZm9jYWwgZWxlbScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRhcmdldFBhdGhFbGVtID0gcGF0aC5tZW1iZXJzW3BhdGguZm9jYWxJZHhdO1xuICAgICAgZXhwZWN0KHRhcmdldFBhdGhFbGVtLmV4dGVybmFsUGF0aCkudG9FcXVhbChbdGFyZ2V0UGF0aEVsZW1dKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIHBhdGggYXdheSBmcm9tIGZvY2FsIGVsZW0gaW4gY29ycmVjdCBvcmRlciBmb3IgdXBzdHJlYW0gZWxlbScsICgpID0+IHtcbiAgICAgIGNvbnN0IGlkeCA9IHBhdGguZm9jYWxJZHggLSAxO1xuICAgICAgY29uc3QgdGFyZ2V0UGF0aEVsZW0gPSBwYXRoLm1lbWJlcnNbaWR4XTtcbiAgICAgIGV4cGVjdCh0YXJnZXRQYXRoRWxlbS5leHRlcm5hbFBhdGgpLnRvRXF1YWwocGF0aC5tZW1iZXJzLnNsaWNlKDAsIGlkeCArIDEpKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIHBhdGggYXdheSBmcm9tIGZvY2FsIGVsZW0gaW4gY29ycmVjdCBvcmRlciBmb3IgZG93bnN0cmVhbSBlbGVtJywgKCkgPT4ge1xuICAgICAgY29uc3QgaWR4ID0gcGF0aC5mb2NhbElkeCArIDE7XG4gICAgICBjb25zdCB0YXJnZXRQYXRoRWxlbSA9IHBhdGgubWVtYmVyc1tpZHhdO1xuICAgICAgZXhwZWN0KHRhcmdldFBhdGhFbGVtLmV4dGVybmFsUGF0aCkudG9FcXVhbChwYXRoLm1lbWJlcnMuc2xpY2UoaWR4KSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmb2NhbFBhdGgnLCAoKSA9PiB7XG4gICAgY29uc3QgcGF0aCA9IGdldFBhdGgoKTtcblxuICAgIGl0KCdyZXR1cm5zIGFycmF5IG9mIGl0c2VsZiBpZiBpdCBpcyBmb2NhbCBlbGVtJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGFyZ2V0UGF0aEVsZW0gPSBwYXRoLm1lbWJlcnNbcGF0aC5mb2NhbElkeF07XG4gICAgICBleHBlY3QodGFyZ2V0UGF0aEVsZW0uZm9jYWxQYXRoKS50b0VxdWFsKFt0YXJnZXRQYXRoRWxlbV0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgcGF0aCB0byBmb2NhbCBlbGVtIGluIGNvcnJlY3Qgb3JkZXIgZm9yIHVwc3RyZWFtIGVsZW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCB0YXJnZXRQYXRoRWxlbSA9IHBhdGgubWVtYmVyc1swXTtcbiAgICAgIGV4cGVjdCh0YXJnZXRQYXRoRWxlbS5mb2NhbFBhdGgpLnRvRXF1YWwocGF0aC5tZW1iZXJzLnNsaWNlKDAsIHBhdGguZm9jYWxJZHggKyAxKSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBwYXRoIHRvIGZvY2FsIGVsZW0gaW4gY29ycmVjdCBvcmRlciBmb3IgZG93bnN0cmVhbSBlbGVtJywgKCkgPT4ge1xuICAgICAgY29uc3QgaWR4ID0gcGF0aC5tZW1iZXJzLmxlbmd0aCAtIDE7XG4gICAgICBjb25zdCB0YXJnZXRQYXRoRWxlbSA9IHBhdGgubWVtYmVyc1tpZHhdO1xuICAgICAgZXhwZWN0KHRhcmdldFBhdGhFbGVtLmZvY2FsUGF0aCkudG9FcXVhbChwYXRoLm1lbWJlcnMuc2xpY2UocGF0aC5mb2NhbElkeCwgaWR4ICsgMSkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbGVnaWJpbGl0eScsICgpID0+IHtcbiAgICBjb25zdCBwYXRoID0gZ2V0UGF0aCgpO1xuICAgIGNvbnN0IHRhcmdldFBhdGhFbGVtID0gcGF0aC5tZW1iZXJzWzFdO1xuXG4gICAgaXQoJ2NyZWF0ZXMgY29uc3VtYWJsZSBKU09OJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRhcmdldFBhdGhFbGVtLnRvSlNPTigpKS50b01hdGNoU25hcHNob3QoKTtcbiAgICB9KTtcblxuICAgIGl0KCdjcmVhdGVzIGNvbnN1bWFibGUgc3RyaW5nJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRhcmdldFBhdGhFbGVtLnRvU3RyaW5nKCkpLnRvQmUoSlNPTi5zdHJpbmdpZnkodGFyZ2V0UGF0aEVsZW0udG9KU09OKCksIG51bGwsIDIpKTtcbiAgICB9KTtcblxuICAgIGl0KCdjcmVhdGVzIGluZm9ybWF0aXZlIHN0cmluZyB0YWcnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRhcmdldFBhdGhFbGVtKSkudG9FcXVhbChcbiAgICAgICAgYFtvYmplY3QgUGF0aEVsZW0gJHt0YXJnZXRQYXRoRWxlbS52aXNpYmlsaXR5SWR4fV1gXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLFlBQVk7QUFDakMsU0FBU0MsVUFBVSxRQUFRLCtCQUErQjtBQUcxREMsUUFBUSxDQUFDLFVBQVUsRUFBRSxZQUFNO0VBQ3pCLElBQU1DLE9BQU8sR0FBRyxTQUFWQSxPQUFPQSxDQUFBLEVBQVM7SUFDcEIsSUFBTUMsSUFBSSxHQUFHO01BQ1hDLFFBQVEsRUFBRTtJQUNaLENBQWE7SUFDYixJQUFNQyxPQUFPLEdBQUdMLFVBQVUsQ0FBQ00sR0FBRyxDQUM1QixVQUFBQyxJQUFBLEVBQXlCQyxDQUFDO01BQUEsSUFBdkJDLFNBQVMsR0FBQUYsSUFBQSxDQUFURSxTQUFTO1FBQUVDLE9BQU8sR0FBQUgsSUFBQSxDQUFQRyxPQUFPO01BQUEsT0FDbkIsSUFBSVgsUUFBUSxDQUFDO1FBQ1hZLFNBQVMsRUFBRUgsQ0FBQztRQUNaQyxTQUFTLEVBQUU7VUFDVEcsSUFBSSxFQUFFSCxTQUFTO1VBQ2ZDLE9BQU8sRUFBRTtZQUNQRSxJQUFJLEVBQUVGO1VBQ1I7UUFDRixDQUFrQjtRQUNsQlAsSUFBSSxFQUFKQTtNQUNGLENBQUMsQ0FBQztJQUFBLENBQ04sQ0FBQztJQUNERSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUNRLGFBQWEsR0FBRyxDQUFDO0lBQzVCUixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUNRLGFBQWEsR0FBRyxDQUFDO0lBQzVCUixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUNRLGFBQWEsR0FBRyxDQUFDO0lBQzVCUixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUNRLGFBQWEsR0FBRyxDQUFDO0lBQzVCUixPQUFPLENBQUMsQ0FBQyxD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