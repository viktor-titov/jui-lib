// Copyright (c) 2017 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { round as _round, dropWhile as _dropWhile } from 'lodash';
import moment from 'moment-timezone';
import { toFloatPrecision } from './number';
var TODAY = 'Today';
var YESTERDAY = 'Yesterday';
export var STANDARD_DATE_FORMAT = 'YYYY-MM-DD';
export var STANDARD_TIME_FORMAT = 'HH:mm';
export var STANDARD_DATETIME_FORMAT = 'MMMM D YYYY, HH:mm:ss.SSS';
export var ONE_MILLISECOND = 1000;
export var ONE_SECOND = 1000 * ONE_MILLISECOND;
export var ONE_MINUTE = 60 * ONE_SECOND;
export var ONE_HOUR = 60 * ONE_MINUTE;
export var ONE_DAY = 24 * ONE_HOUR;
export var DEFAULT_MS_PRECISION = Math.log10(ONE_MILLISECOND);
var UNIT_STEPS = [{
  unit: 'd',
  microseconds: ONE_DAY,
  ofPrevious: 24
}, {
  unit: 'h',
  microseconds: ONE_HOUR,
  ofPrevious: 60
}, {
  unit: 'm',
  microseconds: ONE_MINUTE,
  ofPrevious: 60
}, {
  unit: 's',
  microseconds: ONE_SECOND,
  ofPrevious: 1000
}, {
  unit: 'ms',
  microseconds: ONE_MILLISECOND,
  ofPrevious: 1000
}, {
  unit: 'μs',
  microseconds: 1,
  ofPrevious: 1000
}];

/**
 * @param {number} timestamp
 * @param {number} initialTimestamp
 * @param {number} totalDuration
 * @returns {number} 0-100 percentage
 */
export function getPercentageOfDuration(duration, totalDuration) {
  return duration / totalDuration * 100;
}
var quantizeDuration = function quantizeDuration(duration, floatPrecision, conversionFactor) {
  return toFloatPrecision(duration / conversionFactor, floatPrecision) * conversionFactor;
};

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatDate(duration) {
  return moment(duration / ONE_MILLISECOND).format(STANDARD_DATE_FORMAT);
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatTime(duration) {
  return moment(duration / ONE_MILLISECOND).format(STANDARD_TIME_FORMAT);
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatDatetime(duration) {
  return moment(duration / ONE_MILLISECOND).format(STANDARD_DATETIME_FORMAT);
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatMillisecondTime(duration) {
  var targetDuration = quantizeDuration(duration, DEFAULT_MS_PRECISION, ONE_MILLISECOND);
  return moment.duration(targetDuration / ONE_MILLISECOND).asMilliseconds() + "ms";
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in seconds
 */
export function formatSecondTime(duration) {
  var targetDuration = quantizeDuration(duration, DEFAULT_MS_PRECISION, ONE_SECOND);
  return moment.duration(targetDuration / ONE_MILLISECOND).asSeconds() + "s";
}

/**
 * Humanizes the duration for display.
 *
 * Example:
 * 5000ms => 5s
 * 1000μs => 1ms
 * 183840s => 2d 3h
 *
 * @param {number} duration (in microseconds)
 * @return {string} formatted duration
 */
export function formatDuration(duration) {
  // Drop all units that are too large except the last one
  var _dropWhile2 = _dropWhile(UNIT_STEPS, function (_ref, index) {
      var microseconds = _ref.microseconds;
      return index < UNIT_STEPS.length - 1 && microseconds > duration;
    }),
    primaryUnit = _dropWhile2[0],
    secondaryUnit = _dropWhile2[1];
  if (primaryUnit.ofPrevious === 1000) {
    // If the unit is decimal based, display as a decimal
    return "" + _round(duration / primaryUnit.microseconds, 2) + primaryUnit.unit;
  }
  var primaryValue = Math.floor(duration / primaryUnit.microseconds);
  var primaryUnitString = "" + primaryValue + primaryUnit.unit;
  var secondaryValue = Math.round(duration / secondaryUnit.microseconds % primaryUnit.ofPrevious);
  var secondaryUnitString = "" + secondaryValue + secondaryUnit.unit;
  return secondaryValue === 0 ? primaryUnitString : primaryUnitString + " " + secondaryUnitString;
}
export function formatRelativeDate(value, fullMonthName) {
  if (fullMonthName === void 0) {
    fullMonthName = false;
  }
  var m = moment.isMoment(value) ? value : moment(value);
  var monthFormat = fullMonthName ? 'MMMM' : 'MMM';
  var dt = new Date();
  if (dt.getFullYear() !== m.year()) {
    return m.format(monthFormat + " D, YYYY");
  }
  var mMonth = m.month();
  var mDate = m.date();
  var date = dt.getDate();
  if (mMonth === dt.getMonth() && mDate === date) {
    return TODAY;
  }
  dt.setDate(date - 1);
  if (mMonth === dt.getMonth() && mDate === dt.getDate()) {
    return YESTERDAY;
  }
  return m.format(monthFormat + " D");
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyb3VuZCIsIl9yb3VuZCIsImRyb3BXaGlsZSIsIl9kcm9wV2hpbGUiLCJtb21lbnQiLCJ0b0Zsb2F0UHJlY2lzaW9uIiwiVE9EQVkiLCJZRVNURVJEQVkiLCJTVEFOREFSRF9EQVRFX0ZPUk1BVCIsIlNUQU5EQVJEX1RJTUVfRk9STUFUIiwiU1RBTkRBUkRfREFURVRJTUVfRk9STUFUIiwiT05FX01JTExJU0VDT05EIiwiT05FX1NFQ09ORCIsIk9ORV9NSU5VVEUiLCJPTkVfSE9VUiIsIk9ORV9EQVkiLCJERUZBVUxUX01TX1BSRUNJU0lPTiIsIk1hdGgiLCJsb2cxMCIsIlVOSVRfU1RFUFMiLCJ1bml0IiwibWljcm9zZWNvbmRzIiwib2ZQcmV2aW91cyIsImdldFBlcmNlbnRhZ2VPZkR1cmF0aW9uIiwiZHVyYXRpb24iLCJ0b3RhbER1cmF0aW9uIiwicXVhbnRpemVEdXJhdGlvbiIsImZsb2F0UHJlY2lzaW9uIiwiY29udmVyc2lvbkZhY3RvciIsImZvcm1hdERhdGUiLCJmb3JtYXQiLCJmb3JtYXRUaW1lIiwiZm9ybWF0RGF0ZXRpbWUiLCJmb3JtYXRNaWxsaXNlY29uZFRpbWUiLCJ0YXJnZXREdXJhdGlvbiIsImFzTWlsbGlzZWNvbmRzIiwiZm9ybWF0U2Vjb25kVGltZSIsImFzU2Vjb25kcyIsImZvcm1hdER1cmF0aW9uIiwiX2Ryb3BXaGlsZTIiLCJfcmVmIiwiaW5kZXgiLCJsZW5ndGgiLCJwcmltYXJ5VW5pdCIsInNlY29uZGFyeVVuaXQiLCJwcmltYXJ5VmFsdWUiLCJmbG9vciIsInByaW1hcnlVbml0U3RyaW5nIiwic2Vjb25kYXJ5VmFsdWUiLCJzZWNvbmRhcnlVbml0U3RyaW5nIiwiZm9ybWF0UmVsYXRpdmVEYXRlIiwidmFsdWUiLCJmdWxsTW9udGhOYW1lIiwibSIsImlzTW9tZW50IiwibW9udGhGb3JtYXQiLCJkdCIsIkRhdGUiLCJnZXRGdWxsWWVhciIsInllYXIiLCJtTW9udGgiLCJtb250aCIsIm1EYXRlIiwiZGF0ZSIsImdldERhdGUiLCJnZXRNb250aCIsInNldERhdGUiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvZGF0ZS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDE3IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbi8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IHJvdW5kIGFzIF9yb3VuZCwgZHJvcFdoaWxlIGFzIF9kcm9wV2hpbGUgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQtdGltZXpvbmUnO1xuXG5pbXBvcnQgeyB0b0Zsb2F0UHJlY2lzaW9uIH0gZnJvbSAnLi9udW1iZXInO1xuXG5jb25zdCBUT0RBWSA9ICdUb2RheSc7XG5jb25zdCBZRVNURVJEQVkgPSAnWWVzdGVyZGF5JztcblxuZXhwb3J0IGNvbnN0IFNUQU5EQVJEX0RBVEVfRk9STUFUID0gJ1lZWVktTU0tREQnO1xuZXhwb3J0IGNvbnN0IFNUQU5EQVJEX1RJTUVfRk9STUFUID0gJ0hIOm1tJztcbmV4cG9ydCBjb25zdCBTVEFOREFSRF9EQVRFVElNRV9GT1JNQVQgPSAnTU1NTSBEIFlZWVksIEhIOm1tOnNzLlNTUyc7XG5leHBvcnQgY29uc3QgT05FX01JTExJU0VDT05EID0gMTAwMDtcbmV4cG9ydCBjb25zdCBPTkVfU0VDT05EID0gMTAwMCAqIE9ORV9NSUxMSVNFQ09ORDtcbmV4cG9ydCBjb25zdCBPTkVfTUlOVVRFID0gNjAgKiBPTkVfU0VDT05EO1xuZXhwb3J0IGNvbnN0IE9ORV9IT1VSID0gNjAgKiBPTkVfTUlOVVRFO1xuZXhwb3J0IGNvbnN0IE9ORV9EQVkgPSAyNCAqIE9ORV9IT1VSO1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfTVNfUFJFQ0lTSU9OID0gTWF0aC5sb2cxMChPTkVfTUlMTElTRUNPTkQpO1xuXG5jb25zdCBVTklUX1NURVBTOiBBcnJheTx7IHVuaXQ6IHN0cmluZzsgbWljcm9zZWNvbmRzOiBudW1iZXI7IG9mUHJldmlvdXM6IG51bWJlciB9PiA9IFtcbiAgeyB1bml0OiAnZCcsIG1pY3Jvc2Vjb25kczogT05FX0RBWSwgb2ZQcmV2aW91czogMjQgfSxcbiAgeyB1bml0OiAnaCcsIG1pY3Jvc2Vjb25kczogT05FX0hPVVIsIG9mUHJldmlvdXM6IDYwIH0sXG4gIHsgdW5pdDogJ20nLCBtaWNyb3NlY29uZHM6IE9ORV9NSU5VVEUsIG9mUHJldmlvdXM6IDYwIH0sXG4gIHsgdW5pdDogJ3MnLCBtaWNyb3NlY29uZHM6IE9ORV9TRUNPTkQsIG9mUHJldmlvdXM6IDEwMDAgfSxcbiAgeyB1bml0OiAnbXMnLCBtaWNyb3NlY29uZHM6IE9ORV9NSUxMSVNFQ09ORCwgb2ZQcmV2aW91czogMTAwMCB9LFxuICB7IHVuaXQ6ICfOvHMnLCBtaWNyb3NlY29uZHM6IDEsIG9mUHJldmlvdXM6IDEwMDAgfSxcbl07XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVzdGFtcFxuICogQHBhcmFtIHtudW1iZXJ9IGluaXRpYWxUaW1lc3RhbXBcbiAqIEBwYXJhbSB7bnVtYmVyfSB0b3RhbER1cmF0aW9uXG4gKiBAcmV0dXJucyB7bnVtYmVyfSAwLTEwMCBwZXJjZW50YWdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRQZXJjZW50YWdlT2ZEdXJhdGlvbihkdXJhdGlvbjogbnVtYmVyLCB0b3RhbER1cmF0aW9uOiBudW1iZXIpIHtcbiAgcmV0dXJuIChkdXJhdGlvbiAvIHRvdGFsRHVyYXRpb24pICogMTAwO1xufVxuXG5jb25zdCBxdWFudGl6ZUR1cmF0aW9uID0gKGR1cmF0aW9uOiBudW1iZXIsIGZsb2F0UHJlY2lzaW9uOiBudW1iZXIsIGNvbnZlcnNpb25GYWN0b3I6IG51bWJlcikgPT5cbiAgdG9GbG9hdFByZWNpc2lvbihkdXJhdGlvbiAvIGNvbnZlcnNpb25GYWN0b3IsIGZsb2F0UHJlY2lzaW9uKSAqIGNvbnZlcnNpb25GYWN0b3I7XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uIChpbiBtaWNyb3NlY29uZHMpXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBmb3JtYXR0ZWQsIHVuaXQtbGFiZWxsZWQgc3RyaW5nIHdpdGggdGltZSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERhdGUoZHVyYXRpb246IG51bWJlcikge1xuICByZXR1cm4gbW9tZW50KGR1cmF0aW9uIC8gT05FX01JTExJU0VDT05EKS5mb3JtYXQoU1RBTkRBUkRfREFURV9GT1JNQVQpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSBkdXJhdGlvbiAoaW4gbWljcm9zZWNvbmRzKVxuICogQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkLCB1bml0LWxhYmVsbGVkIHN0cmluZyB3aXRoIHRpbWUgaW4gbWlsbGlzZWNvbmRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRUaW1lKGR1cmF0aW9uOiBudW1iZXIpIHtcbiAgcmV0dXJuIG1vbWVudChkdXJhdGlvbiAvIE9ORV9NSUxMSVNFQ09ORCkuZm9ybWF0KFNUQU5EQVJEX1RJTUVfRk9STUFUKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge251bWJlcn0gZHVyYXRpb24gKGluIG1pY3Jvc2Vjb25kcylcbiAqIEByZXR1cm5zIHtzdHJpbmd9IGZvcm1hdHRlZCwgdW5pdC1sYWJlbGxlZCBzdHJpbmcgd2l0aCB0aW1lIGluIG1pbGxpc2Vjb25kc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGF0ZXRpbWUoZHVyYXRpb246IG51bWJlcikge1xuICByZXR1cm4gbW9tZW50KGR1cmF0aW9uIC8gT05FX01JTExJU0VDT05EKS5mb3JtYXQoU1RBTkRBUkRfREFURVRJTUVfRk9STUFUKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge251bWJlcn0gZHVyYXRpb24gKGluIG1pY3Jvc2Vjb25kcylcbiAqIEByZXR1cm5zIHtzdHJpbmd9IGZvcm1hdHRlZCwgdW5pdC1sYWJlbGxlZCBzdHJpbmcgd2l0aCB0aW1lIGluIG1pbGxpc2Vjb25kc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0TWlsbGlzZWNvbmRUaW1lKGR1cmF0aW9uOiBudW1iZXIpIHtcbiAgY29uc3QgdGFyZ2V0RHVyYXRpb24gPSBxdWFudGl6ZUR1cmF0aW9uKGR1cmF0aW9uLCBERUZBVUxUX01TX1BSRUNJU0lPTiwgT05FX01JTExJU0VDT05EKTtcbiAgcmV0dXJuIGAke21vbWVudC5kdXJhdGlvbih0YXJnZXREdXJhdGlvbiAvIE9ORV9NSUxMSVNFQ09ORCkuYXNNaWxsaXNlY29uZHMoKX1tc2A7XG59XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uIChpbiBtaWNyb3NlY29uZHMpXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBmb3JtYXR0ZWQsIHVuaXQtbGFiZWxsZWQgc3RyaW5nIHdpdGggdGltZSBpbiBzZWNvbmRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRTZWNvbmRUaW1lKGR1cmF0aW9uOiBudW1iZXIpIHtcbiAgY29uc3QgdGFyZ2V0RHVyYXRpb24gPSBxdWFudGl6ZUR1cmF0aW9uKGR1cmF0aW9uLCBERUZBVUxUX01TX1BSRUNJU0lPTiwgT05FX1NFQ09ORCk7XG4gIHJldHVybiBgJHttb21lbnQuZHVyYXRpb24odGFyZ2V0RHVyYXRpb24gLyBPTkVfTUlMTElTRUNPTkQpLmFzU2Vjb25kcygpfXNgO1xufVxuXG4vKipcbiAqIEh1bWFuaXplcyB0aGUgZHVyYXRpb24gZm9yIGRpc3BsYXkuXG4gKlxuICogRXhhbXBsZTpcbiAqIDUwMDBtcyA9PiA1c1xuICogMTAwMM68cyA9PiAxbXNcbiAqIDE4Mzg0MHMgPT4gMmQgM2hcbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gZHVyYXRpb24gKGluIG1pY3Jvc2Vjb25kcylcbiAqIEByZXR1cm4ge3N0cmluZ30gZm9ybWF0dGVkIGR1cmF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXREdXJhdGlvbihkdXJhdGlvbjogbnVtYmVyKTogc3RyaW5nIHtcbiAgLy8gRHJvcCBhbGwgdW5pdHMgdGhhdCBhcmUgdG9vIGxhcmdlIGV4Y2VwdCB0aGUgbGFzdCBvbmVcbiAgY29uc3QgW3ByaW1hcnlVbml0LCBzZWNvbmRhcnlVbml0XSA9IF9kcm9wV2hpbGUoXG4gICAgVU5JVF9TVEVQUyxcbiAgICAoeyBtaWNyb3NlY29uZHMgfSwgaW5kZXgpID0+IGluZGV4IDwgVU5JVF9TVEVQUy5sZW5ndGggLSAxICYmIG1pY3Jvc2Vjb25kcyA+IGR1cmF0aW9uXG4gICk7XG5cbiAgaWYgKHByaW1hcnlVbml0Lm9mUHJldmlvdXMgPT09IDEwMDApIHtcbiAgICAvLyBJZiB0aGUgdW5pdCBpcyBkZWNpbWFsIGJhc2VkLCBkaXNwbGF5IGFzIGEgZGVjaW1hbFxuICAgIHJldHVybiBgJHtfcm91bmQoZHVyYXRpb24gLyBwcmltYXJ5VW5pdC5taWNyb3NlY29uZHMsIDIpfSR7cHJpbWFyeVVuaXQudW5pdH1gO1xuICB9XG5cbiAgY29uc3QgcHJpbWFyeVZhbHVlID0gTWF0aC5mbG9vcihkdXJhdGlvbiAvIHByaW1hcnlVbml0Lm1pY3Jvc2Vjb25kcyk7XG4gIGNvbnN0IHByaW1hcnlVbml0U3RyaW5nID0gYCR7cHJpbWFyeVZhbHVlfSR7cHJpbWFyeVVuaXQudW5pdH1gO1xuICBjb25zdCBzZWNvbmRhcnlWYWx1ZSA9IE1hdGgucm91bmQoKGR1cmF0aW9uIC8gc2Vjb25kYXJ5VW5pdC5taWNyb3NlY29uZHMpICUgcHJpbWFyeVVuaXQub2ZQcmV2aW91cyk7XG4gIGNvbnN0IHNlY29uZGFyeVVuaXRTdHJpbmcgPSBgJHtzZWNvbmRhcnlWYWx1ZX0ke3NlY29uZGFyeVVuaXQudW5pdH1gO1xuICByZXR1cm4gc2Vjb25kYXJ5VmFsdWUgPT09IDAgPyBwcmltYXJ5VW5pdFN0cmluZyA6IGAke3ByaW1hcnlVbml0U3RyaW5nfSAke3NlY29uZGFyeVVuaXRTdHJpbmd9YDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFJlbGF0aXZlRGF0ZSh2YWx1ZTogYW55LCBmdWxsTW9udGhOYW1lID0gZmFsc2UpIHtcbiAgY29uc3QgbSA9IG1vbWVudC5pc01vbWVudCh2YWx1ZSkgPyB2YWx1ZSA6IG1vbWVudCh2YWx1ZSk7XG4gIGNvbnN0IG1vbnRoRm9ybWF0ID0gZnVsbE1vbnRoTmFtZSA/ICdNTU1NJyA6ICdNTU0nO1xuICBjb25zdCBkdCA9IG5ldyBEYXRlKCk7XG4gIGlmIChkdC5nZXRGdWxsWWVhcigpICE9PSBtLnllYXIoKSkge1xuICAgIHJldHVybiBtLmZvcm1hdChgJHttb250aEZvcm1hdH0gRCwgWVlZWWApO1xuICB9XG4gIGNvbnN0IG1Nb250aCA9IG0ubW9udGgoKTtcbiAgY29uc3QgbURhdGUgPSBtLmRhdGUoKTtcbiAgY29uc3QgZGF0ZSA9IGR0LmdldERhdGUoKTtcbiAgaWYgKG1Nb250aCA9PT0gZHQuZ2V0TW9udGgoKSAmJiBtRGF0ZSA9PT0gZGF0ZSkge1xuICAgIHJldHVybiBUT0RBWTtcbiAgfVxuICBkdC5zZXREYXRlKGRhdGUgLSAxKTtcbiAgaWYgKG1Nb250aCA9PT0gZHQuZ2V0TW9udGgoKSAmJiBtRGF0ZSA9PT0gZHQuZ2V0RGF0ZSgpKSB7XG4gICAgcmV0dXJuIFlFU1RFUkRBWTtcbiAgfVxuICByZXR1cm4gbS5mb3JtYXQoYCR7bW9udGhGb3JtYXR9IERgKTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsS0FBSyxJQUFJQyxNQUFNLEVBQUVDLFNBQVMsSUFBSUMsVUFBVSxRQUFRLFFBQVE7QUFDakUsT0FBT0MsTUFBTSxNQUFNLGlCQUFpQjtBQUVwQyxTQUFTQyxnQkFBZ0IsUUFBUSxVQUFVO0FBRTNDLElBQU1DLEtBQUssR0FBRyxPQUFPO0FBQ3JCLElBQU1DLFNBQVMsR0FBRyxXQUFXO0FBRTdCLE9BQU8sSUFBTUMsb0JBQW9CLEdBQUcsWUFBWTtBQUNoRCxPQUFPLElBQU1DLG9CQUFvQixHQUFHLE9BQU87QUFDM0MsT0FBTyxJQUFNQyx3QkFBd0IsR0FBRywyQkFBMkI7QUFDbkUsT0FBTyxJQUFNQyxlQUFlLEdBQUcsSUFBSTtBQUNuQyxPQUFPLElBQU1DLFVBQVUsR0FBRyxJQUFJLEdBQUdELGVBQWU7QUFDaEQsT0FBTyxJQUFNRSxVQUFVLEdBQUcsRUFBRSxHQUFHRCxVQUFVO0FBQ3pDLE9BQU8sSUFBTUUsUUFBUSxHQUFHLEVBQUUsR0FBR0QsVUFBVTtBQUN2QyxPQUFPLElBQU1FLE9BQU8sR0FBRyxFQUFFLEdBQUdELFFBQVE7QUFDcEMsT0FBTyxJQUFNRSxvQkFBb0IsR0FBR0MsSUFBSSxDQUFDQyxLQUFLLENBQUNQLGVBQWUsQ0FBQztBQUUvRCxJQUFNUSxVQUE2RSxHQUFHLENBQ3BGO0VBQUVDLElBQUksRUFBRSxHQUFHO0VBQUVDLFlBQVksRUFBRU4sT0FBTztFQUFFTyxVQUFVLEVBQUU7QUFBRyxDQUFDLEVBQ3BEO0VB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