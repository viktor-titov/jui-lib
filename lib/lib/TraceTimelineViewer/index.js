import _extends from "@babel/runtime/helpers/extends";
import _objectWithoutPropertiesLoose from "@babel/runtime/helpers/objectWithoutPropertiesLoose";
import _inheritsLoose from "@babel/runtime/helpers/inheritsLoose";
import _taggedTemplateLiteralLoose from "@babel/runtime/helpers/taggedTemplateLiteralLoose";
var _excluded = ["setSpanNameColumnWidth", "updateNextViewRangeTime", "updateViewRangeTime", "viewRange", "traceTimeline", "theme", "topOfViewRef", "focusedSpanIdForSearch"];
var _templateObject;
// Copyright (c) 2017 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { css } from '@emotion/css';
import React from 'react';
import { config, reportInteraction } from '@grafana/runtime';
import { stylesFactory, withTheme2 } from '@grafana/ui';
import { autoColor } from '../Theme';
import { merge as mergeShortcuts } from '../keyboard-shortcuts';
import TimelineHeaderRow from './TimelineHeaderRow';
import VirtualizedTraceView from './VirtualizedTraceView';
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
var getStyles = stylesFactory(function (theme) {
  return {
    TraceTimelineViewer: css(_templateObject || (_templateObject = _taggedTemplateLiteralLoose(["\n      label: TraceTimelineViewer;\n      border-bottom: 1px solid ", ";\n\n      & .json-markup {\n        line-height: 17px;\n        font-size: 13px;\n        font-family: monospace;\n        white-space: pre-wrap;\n      }\n\n      & .json-markup-key {\n        font-weight: bold;\n      }\n\n      & .json-markup-bool {\n        color: ", ";\n      }\n\n      & .json-markup-string {\n        color: ", ";\n      }\n\n      & .json-markup-null {\n        color: ", ";\n      }\n\n      & .json-markup-number {\n        color: ", ";\n      }\n    "])), autoColor(theme, '#bbb'), autoColor(theme, 'firebrick'), autoColor(theme, 'teal'), autoColor(theme, 'teal'), autoColor(theme, 'blue', 'black'))
  };
});
var NUM_TICKS = 5;

/**
 * `TraceTimelineViewer` now renders the header row because it is sensitive to
 * `props.viewRange.time.cursor`. If `VirtualizedTraceView` renders it, it will
 * re-render the ListView every time the cursor is moved on the trace minimap
 * or `TimelineHeaderRow`.
 */
export var UnthemedTraceTimelineViewer = /*#__PURE__*/function (_React$PureComponent) {
  function UnthemedTraceTimelineViewer(props) {
    var _this;
    _this = _React$PureComponent.call(this, props) || this;
    _this.collapseAll = function () {
      _this.props.collapseAll(_this.props.trace.spans);
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'collapseAll'
      });
    };
    _this.collapseOne = function () {
      _this.props.collapseOne(_this.props.trace.spans);
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'collapseOne'
      });
    };
    _this.expandAll = function () {
      _this.props.expandAll();
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'expandAll'
      });
    };
    _this.expandOne = function () {
      _this.props.expandOne(_this.props.trace.spans);
      reportInteraction('grafana_traces_traceID_expand_collapse_clicked', {
        datasourceType: _this.props.datasourceType,
        grafana_version: config.buildInfo.version,
        type: 'expandOne'
      });
    };
    _this.state = {
      height: 0
    };
    return _this;
  }
  _inheritsLoose(UnthemedTraceTimelineViewer, _React$PureComponent);
  var _proto = UnthemedTraceTimelineViewer.prototype;
  _proto.componentDidMount = function componentDidMount() {
    mergeShortcuts({
      collapseAll: this.collapseAll,
      expandAll: this.expandAll,
      collapseOne: this.collapseOne,
      expandOne: this.expandOne
    });
  };
  _proto.render = function render() {
    var _this2 = this;
    var _this$props = this.props,
      setSpanNameColumnWidth = _this$props.setSpanNameColumnWidth,
      updateNextViewRangeTime = _this$props.updateNextViewRangeTime,
      updateViewRangeTime = _this$props.updateViewRangeTime,
      viewRange = _this$props.viewRange,
      traceTimeline = _this$props.traceTimeline,
      theme = _this$props.theme,
      topOfViewRef = _this$props.topOfViewRef,
      focusedSpanIdForSearch = _this$props.focusedSpanIdForSearch,
      rest = _objectWithoutPropertiesLoose(_this$props, _excluded);
    var trace = rest.trace;
    var styles = getStyles(theme);
    return /*#__PURE__*/_jsxs("div", {
      className: styles.TraceTimelineViewer,
      ref: function ref(_ref) {
        return _ref && _this2.setState({
          height: _ref.getBoundingClientRect().height
        });
      },
      children: [/*#__PURE__*/_jsx(TimelineHeaderRow, {
        duration: trace.duration,
        nameColumnWidth: traceTimeline.spanNameColumnWidth,
        numTicks: NUM_TICKS,
        onCollapseAll: this.collapseAll,
        onCollapseOne: this.collapseOne,
        onColummWidthChange: setSpanNameColumnWidth,
        onExpandAll: this.expandAll,
        onExpandOne: this.expandOne,
        viewRangeTime: viewRange.time,
        updateNextViewRangeTime: updateNextViewRangeTime,
        updateViewRangeTime: updateViewRangeTime,
        columnResizeHandleHeight: this.state.height
      }), /*#__PURE__*/_jsx(VirtualizedTraceView, _extends({}, rest, traceTimeline, {
        setSpanNameColumnWidth: setSpanNameColumnWidth,
        currentViewRangeTime: viewRange.time.current,
        topOfViewRef: topOfViewRef,
        focusedSpanIdForSearch: focusedSpanIdForSearch,
        datasourceType: this.props.datasourceType
      }))]
    });
  };
  return UnthemedTraceTimelineViewer;
}(React.PureComponent);
export default withTheme2(UnthemedTraceTimelineViewer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjc3MiLCJSZWFjdCIsImNvbmZpZyIsInJlcG9ydEludGVyYWN0aW9uIiwic3R5bGVzRmFjdG9yeSIsIndpdGhUaGVtZTIiLCJhdXRvQ29sb3IiLCJtZXJnZSIsIm1lcmdlU2hvcnRjdXRzIiwiVGltZWxpbmVIZWFkZXJSb3ciLCJWaXJ0dWFsaXplZFRyYWNlVmlldyIsImpzeCIsIl9qc3giLCJqc3hzIiwiX2pzeHMiLCJnZXRTdHlsZXMiLCJ0aGVtZSIsIlRyYWNlVGltZWxpbmVWaWV3ZXIiLCJfdGVtcGxhdGVPYmplY3QiLCJfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsTG9vc2UiLCJOVU1fVElDS1MiLCJVbnRoZW1lZFRyYWNlVGltZWxpbmVWaWV3ZXIiLCJfUmVhY3QkUHVyZUNvbXBvbmVudCIsInByb3BzIiwiX3RoaXMiLCJjYWxsIiwiY29sbGFwc2VBbGwiLCJ0cmFjZSIsInNwYW5zIiwiZGF0YXNvdXJjZVR5cGUiLCJncmFmYW5hX3ZlcnNpb24iLCJidWlsZEluZm8iLCJ2ZXJzaW9uIiwidHlwZSIsImNvbGxhcHNlT25lIiwiZXhwYW5kQWxsIiwiZXhwYW5kT25lIiwic3RhdGUiLCJoZWlnaHQiLCJfaW5oZXJpdHNMb29zZSIsIl9wcm90byIsInByb3RvdHlwZSIsImNvbXBvbmVudERpZE1vdW50IiwicmVuZGVyIiwiX3RoaXMyIiwiX3RoaXMkcHJvcHMiLCJzZXRTcGFuTmFtZUNvbHVtbldpZHRoIiwidXBkYXRlTmV4dFZpZXdSYW5nZVRpbWUiLCJ1cGRhdGVWaWV3UmFuZ2VUaW1lIiwidmlld1JhbmdlIiwidHJhY2VUaW1lbGluZSIsInRvcE9mVmlld1JlZiIsImZvY3VzZWRTcGFuSWRGb3JTZWFyY2giLCJyZXN0IiwiX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UiLCJfZXhjbHVkZWQiLCJzdHlsZXMiLCJjbGFzc05hbWUiLCJyZWYiLCJzZXRTdGF0ZSIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImNoaWxkcmVuIiwiZHVyYXRpb24iLCJuYW1lQ29sdW1uV2lkdGgiLCJzcGFuTmFtZUNvbHVtbldpZHRoIiwibnVtVGlja3MiLCJvbkNvbGxhcHNlQWxsIiwib25Db2xsYXBzZU9uZSIsIm9uQ29sdW1tV2lkdGhDaGFuZ2UiLCJvbkV4cGFuZEFsbCIsIm9uRXhwYW5kT25lIiwidmlld1JhbmdlVGltZSIsInRpbWUiLCJjb2x1bW5SZXNpemVIYW5kbGVIZWlnaHQiLCJfZXh0ZW5kcyIsImN1cnJlbnRWaWV3UmFuZ2VUaW1lIiwiY3VycmVudCIsIlB1cmVDb21wb25lbnQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL1RyYWNlVGltZWxpbmVWaWV3ZXIvaW5kZXgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxNyBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBjc3MgfSBmcm9tICdAZW1vdGlvbi9jc3MnO1xuaW1wb3J0IFJlYWN0LCB7IFJlZk9iamVjdCB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgR3JhZmFuYVRoZW1lMiwgTGlua01vZGVsLCBUaW1lWm9uZSB9IGZyb20gJ0BncmFmYW5hL2RhdGEnO1xuaW1wb3J0IHsgY29uZmlnLCByZXBvcnRJbnRlcmFjdGlvbiB9IGZyb20gJ0BncmFmYW5hL3J1bnRpbWUnO1xuaW1wb3J0IHsgc3R5bGVzRmFjdG9yeSwgd2l0aFRoZW1lMiB9IGZyb20gJ0BncmFmYW5hL3VpJztcblxuaW1wb3J0IHsgQWNjZXNzb3JzIH0gZnJvbSAnLi4vU2Nyb2xsTWFuYWdlcic7XG5pbXBvcnQgeyBhdXRvQ29sb3IgfSBmcm9tICcuLi9UaGVtZSc7XG5pbXBvcnQgeyBtZXJnZSBhcyBtZXJnZVNob3J0Y3V0cyB9IGZyb20gJy4uL2tleWJvYXJkLXNob3J0Y3V0cyc7XG5pbXBvcnQgeyBTcGFuQmFyT3B0aW9ucyB9IGZyb20gJy4uL3NldHRpbmdzL1NwYW5CYXJTZXR0aW5ncyc7XG5pbXBvcnQgeyBTcGFuTGlua0Z1bmMsIFROaWwgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgVFRyYWNlVGltZWxpbmUgZnJvbSAnLi4vdHlwZXMvVFRyYWNlVGltZWxpbmUnO1xuaW1wb3J0IHsgVHJhY2VTcGFuLCBUcmFjZSwgVHJhY2VMb2csIFRyYWNlS2V5VmFsdWVQYWlyLCBUcmFjZUxpbmssIFRyYWNlU3BhblJlZmVyZW5jZSB9IGZyb20gJy4uL3R5cGVzL3RyYWNlJztcblxuaW1wb3J0IFRpbWVsaW5lSGVhZGVyUm93IGZyb20gJy4vVGltZWxpbmVIZWFkZXJSb3cnO1xuaW1wb3J0IFZpcnR1YWxpemVkVHJhY2VWaWV3LCB7IFRvcE9mVmlld1JlZlR5cGUgfSBmcm9tICcuL1ZpcnR1YWxpemVkVHJhY2VWaWV3JztcbmltcG9ydCB7IFRVcGRhdGVWaWV3UmFuZ2VUaW1lRnVuY3Rpb24sIFZpZXdSYW5nZSwgVmlld1JhbmdlVGltZVVwZGF0ZSB9IGZyb20gJy4vdHlwZXMnO1xuXG50eXBlIFRFeHRyYWN0VWlGaW5kRnJvbVN0YXRlUmV0dXJuID0ge1xuICB1aUZpbmQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbn07XG5cbmNvbnN0IGdldFN0eWxlcyA9IHN0eWxlc0ZhY3RvcnkoKHRoZW1lOiBHcmFmYW5hVGhlbWUyKSA9PiB7XG4gIHJldHVybiB7XG4gICAgVHJhY2VUaW1lbGluZVZpZXdlcjogY3NzYFxuICAgICAgbGFiZWw6IFRyYWNlVGltZWxpbmVWaWV3ZXI7XG4gICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgJHthdXRvQ29sb3IodGhlbWUsICcjYmJiJyl9O1xuXG4gICAgICAmIC5qc29uLW1hcmt1cCB7XG4gICAgICAgIGxpbmUtaGVpZ2h0OiAxN3B4O1xuICAgICAgICBmb250LXNpemU6IDEzcHg7XG4gICAgICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG4gICAgICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDtcbiAgICAgIH1cblxuICAgICAgJiAuanNvbi1tYXJrdXAta2V5IHtcbiAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICB9XG5cbiAgICAgICYgLmpzb24tbWFya3VwLWJvb2wge1xuICAgICAgICBjb2xvcjogJHthdXRvQ29sb3IodGhlbWUsICdmaXJlYnJpY2snKX07XG4gICAgICB9XG5cbiAgICAgICYgLmpzb24tbWFya3VwLXN0cmluZyB7XG4gICAgICAgIGNvbG9yOiAke2F1dG9Db2xvcih0aGVtZSwgJ3RlYWwnKX07XG4gICAgICB9XG5cbiAgICAgICYgLmpzb24tbWFya3VwLW51bGwge1xuICAgICAgICBjb2xvcjogJHthdXRvQ29sb3IodGhlbWUsICd0ZWFsJyl9O1xuICAgICAgfVxuXG4gICAgICAmIC5qc29uLW1hcmt1cC1udW1iZXIge1xuICAgICAgICBjb2xvcjogJHthdXRvQ29sb3IodGhlbWUsICdibHVlJywgJ2JsYWNrJyl9O1xuICAgICAgfVxuICAgIGAsXG4gIH07XG59KTtcblxuZXhwb3J0IHR5cGUgVFByb3BzID0gVEV4dHJhY3RVaUZpbmRGcm9tU3RhdGVSZXR1cm4gJiB7XG4gIHJlZ2lzdGVyQWNjZXNzb3JzOiAoYWNjZXNzb3JzOiBBY2Nlc3NvcnMpID0+IHZvaWQ7XG4gIGZpbmRNYXRjaGVzSURzOiBTZXQ8c3RyaW5nPiB8IFROaWw7XG4gIHNjcm9sbFRvRmlyc3RWaXNpYmxlU3BhbjogKCkgPT4gdm9pZDtcbiAgdHJhY2VUaW1lbGluZTogVFRyYWNlVGltZWxpbmU7XG4gIHRyYWNlOiBUcmFjZTtcbiAgZGF0YXNvdXJjZVR5cGU6IHN0cmluZztcbiAgc3BhbkJhck9wdGlvbnM6IFNwYW5CYXJPcHRpb25zIHwgdW5kZWZpbmVkO1xuICB1cGRhdGVOZXh0Vmlld1JhbmdlVGltZTogKHVwZGF0ZTogVmlld1JhbmdlVGltZVVwZGF0ZSkgPT4gdm9pZDtcbiAgdXBkYXRlVmlld1JhbmdlVGltZTogVFVwZGF0ZVZpZXdSYW5nZVRpbWVGdW5jdGlvbjtcbiAgdmlld1JhbmdlOiBWaWV3UmFuZ2U7XG4gIHRpbWVab25lOiBUaW1lWm9uZTtcblxuICBzZXRTcGFuTmFtZUNvbHVtbldpZHRoOiAod2lkdGg6IG51bWJlcikgPT4gdm9pZDtcbiAgY29sbGFwc2VBbGw6IChzcGFuczogVHJhY2VTcGFuW10pID0+IHZvaWQ7XG4gIGNvbGxhcHNlT25lOiAoc3BhbnM6IFRyYWNlU3BhbltdKSA9PiB2b2lkO1xuICBleHBhbmRBbGw6ICgpID0+IHZvaWQ7XG4gIGV4cGFuZE9uZTogKHNwYW5zOiBUcmFjZVNwYW5bXSkgPT4gdm9pZDtcblxuICBjaGlsZHJlblRvZ2dsZTogKHNwYW5JRDogc3RyaW5nKSA9PiB2b2lkO1xuICBjbGVhclNob3VsZFNjcm9sbFRvRmlyc3RVaUZpbmRNYXRjaDogKCkgPT4gdm9pZDtcbiAgZGV0YWlsTG9nSXRlbVRvZ2dsZTogKHNwYW5JRDogc3RyaW5nLCBsb2c6IFRyYWNlTG9nKSA9PiB2b2lkO1xuICBkZXRhaWxMb2dzVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIGRldGFpbFdhcm5pbmdzVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIGRldGFpbFN0YWNrVHJhY2VzVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIGRldGFpbFJlZmVyZW5jZXNUb2dnbGU6IChzcGFuSUQ6IHN0cmluZykgPT4gdm9pZDtcbiAgZGV0YWlsUmVmZXJlbmNlSXRlbVRvZ2dsZTogKHNwYW5JRDogc3RyaW5nLCByZWZlcmVuY2U6IFRyYWNlU3BhblJlZmVyZW5jZSkgPT4gdm9pZDtcbiAgZGV0YWlsUHJvY2Vzc1RvZ2dsZTogKHNwYW5JRDogc3RyaW5nKSA9PiB2b2lkO1xuICBkZXRhaWxUYWdzVG9nZ2xlOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIGRldGFpbFRvZ2dsZTogKHNwYW5JRDogc3RyaW5nKSA9PiB2b2lkO1xuICBzZXRUcmFjZTogKHRyYWNlOiBUcmFjZSB8IFROaWwsIHVpRmluZDogc3RyaW5nIHwgVE5pbCkgPT4gdm9pZDtcbiAgYWRkSG92ZXJJbmRlbnRHdWlkZUlkOiAoc3BhbklEOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHJlbW92ZUhvdmVySW5kZW50R3VpZGVJZDogKHNwYW5JRDogc3RyaW5nKSA9PiB2b2lkO1xuICBsaW5rc0dldHRlcjogKHNwYW46IFRyYWNlU3BhbiwgaXRlbXM6IFRyYWNlS2V5VmFsdWVQYWlyW10sIGl0ZW1JbmRleDogbnVtYmVyKSA9PiBUcmFjZUxpbmtbXTtcbiAgdGhlbWU6IEdyYWZhbmFUaGVtZTI7XG4gIGNyZWF0ZVNwYW5MaW5rPzogU3BhbkxpbmtGdW5jO1xuICBzY3JvbGxFbGVtZW50PzogRWxlbWVudDtcbiAgZm9jdXNlZFNwYW5JZD86IHN0cmluZztcbiAgZm9jdXNlZFNwYW5JZEZvclNlYXJjaDogc3RyaW5nO1xuICBjcmVhdGVGb2N1c1NwYW5MaW5rOiAodHJhY2VJZDogc3RyaW5nLCBzcGFuSWQ6IHN0cmluZykgPT4gTGlua01vZGVsO1xuICB0b3BPZlZpZXdSZWY/OiBSZWZPYmplY3Q8SFRNTERpdkVsZW1lbnQ+O1xuICB0b3BPZlZpZXdSZWZUeXBlPzogVG9wT2ZWaWV3UmVmVHlwZTtcbn07XG5cbnR5cGUgU3RhdGUgPSB7XG4gIC8vIFdpbGwgYmUgc2V0IHRvIHJlYWwgaGVpZ2h0IG9mIHRoZSBjb21wb25lbnQgc28gaXQgY2FuIGJlIHBhc3NlZCBkb3duIHRvIHNpemUgc29tZSBvdGhlciBlbGVtZW50cy5cbiAgaGVpZ2h0OiBudW1iZXI7XG59O1xuXG5jb25zdCBOVU1fVElDS1MgPSA1O1xuXG4vKipcbiAqIGBUcmFjZVRpbWVsaW5lVmlld2VyYCBub3cgcmVuZGVycyB0aGUgaGVhZGVyIHJvdyBiZWNhdXNlIGl0IGlzIHNlbnNpdGl2ZSB0b1xuICogYHByb3BzLnZpZXdSYW5nZS50aW1lLmN1cnNvcmAuIElmIGBWaXJ0dWFsaXplZFRyYWNlVmlld2AgcmVuZGVycyBpdCwgaXQgd2lsbFxuICogcmUtcmVuZGVyIHRoZSBMaXN0VmlldyBldmVyeSB0aW1lIHRoZSBjdXJzb3IgaXMgbW92ZWQgb24gdGhlIHRyYWNlIG1pbmltYXBcbiAqIG9yIGBUaW1lbGluZUhlYWRlclJvd2AuXG4gKi9cbmV4cG9ydCBjbGFzcyBVbnRoZW1lZFRyYWNlVGltZWxpbmVWaWV3ZXIgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PFRQcm9wcywgU3RhdGU+IHtcbiAgY29uc3RydWN0b3IocHJvcHM6IFRQcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICB0aGlzLnN0YXRlID0geyBoZWlnaHQ6IDAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIG1lcmdlU2hvcnRjdXRzKHtcbiAgICAgIGNvbGxhcHNlQWxsOiB0aGlzLmNvbGxhcHNlQWxsLFxuICAgICAgZXhwYW5kQWxsOiB0aGlzLmV4cGFuZEFsbCxcbiAgICAgIGNvbGxhcHNlT25lOiB0aGlzLmNvbGxhcHNlT25lLFxuICAgICAgZXhwYW5kT25lOiB0aGlzLmV4cGFuZE9uZSxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbGxhcHNlQWxsID0gKCkgPT4ge1xuICAgIHRoaXMucHJvcHMuY29sbGFwc2VBbGwodGhpcy5wcm9wcy50cmFjZS5zcGFucyk7XG4gICAgcmVwb3J0SW50ZXJhY3Rpb24oJ2dyYWZhbmFfdHJhY2VzX3RyYWNlSURfZXhwYW5kX2NvbGxhcHNlX2NsaWNrZWQnLCB7XG4gICAgICBkYXRhc291cmNlVHlwZTogdGhpcy5wcm9wcy5kYXRhc291cmNlVHlwZSxcbiAgICAgIGdyYWZhbmFfdmVyc2lvbjogY29uZmlnLmJ1aWxkSW5mby52ZXJzaW9uLFxuICAgICAgdHlwZTogJ2NvbGxhcHNlQWxsJyxcbiAgICB9KTtcbiAgfTtcblxuICBjb2xsYXBzZU9uZSA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLmNvbGxhcHNlT25lKHRoaXMucHJvcHMudHJhY2Uuc3BhbnMpO1xuICAgIHJlcG9ydEludGVyYWN0aW9uKCdncmFmYW5hX3RyYWNlc190cmFjZUlEX2V4cGFuZF9jb2xsYXBzZV9jbGlja2VkJywge1xuICAgICAgZGF0YXNvdXJjZVR5cGU6IHRoaXMucHJvcHMuZGF0YXNvdXJjZVR5cGUsXG4gICAgICBncmFmYW5hX3ZlcnNpb246IGNvbmZpZy5idWlsZEluZm8udmVyc2lvbixcbiAgICAgIHR5cGU6ICdjb2xsYXBzZU9uZScsXG4gICAgfSk7XG4gIH07XG5cbiAgZXhwYW5kQWxsID0gKCkgPT4ge1xuICAgIHRoaXMucHJvcHMuZXhwYW5kQWxsKCk7XG4gICAgcmVwb3J0SW50ZXJhY3Rpb24oJ2dyYWZhbmFfdHJhY2VzX3RyYWNlSURfZXhwYW5kX2NvbGxhcHNlX2NsaWNrZWQnLCB7XG4gICAgICBkYXRhc291cmNlVHlwZTogdGhpcy5wcm9wcy5kYXRhc291cmNlVHlwZSxcbiAgICAgIGdyYWZhbmFfdmVyc2lvbjogY29uZmlnLmJ1aWxkSW5mby52ZXJzaW9uLFxuICAgICAgdHlwZTogJ2V4cGFuZEFsbCcsXG4gICAgfSk7XG4gIH07XG5cbiAgZXhwYW5kT25lID0gKCkgPT4ge1xuICAgIHRoaXMucHJvcHMuZXhwYW5kT25lKHRoaXMucHJvcHMudHJhY2Uuc3BhbnMpO1xuICAgIHJlcG9ydEludGVyYWN0aW9uKCdncmFmYW5hX3RyYWNlc190cmFjZUlEX2V4cGFuZF9jb2xsYXBzZV9jbGlja2VkJywge1xuICAgICAgZGF0YXNvdXJjZVR5cGU6IHRoaXMucHJvcHMuZGF0YXNvdXJjZVR5cGUsXG4gICAgICBncmFmYW5hX3ZlcnNpb246IGNvbmZpZy5idWlsZEluZm8udmVyc2lvbixcbiAgICAgIHR5cGU6ICdleHBhbmRPbmUnLFxuICAgIH0pO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBzZXRTcGFuTmFtZUNvbHVtbldpZHRoLFxuICAgICAgdXBkYXRlTmV4dFZpZXdSYW5nZVRpbWUsXG4gICAgICB1cGRhdGVWaWV3UmFuZ2VUaW1lLFxuICAgICAgdmlld1JhbmdlLFxuICAgICAgdHJhY2VUaW1lbGluZSxcbiAgICAgIHRoZW1lLFxuICAgICAgdG9wT2ZWaWV3UmVmLFxuICAgICAgZm9jdXNlZFNwYW5JZEZvclNlYXJjaCxcbiAgICAgIC4uLnJlc3RcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IHRyYWNlIH0gPSByZXN0O1xuICAgIGNvbnN0IHN0eWxlcyA9IGdldFN0eWxlcyh0aGVtZSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9e3N0eWxlcy5UcmFjZVRpbWVsaW5lVmlld2VyfVxuICAgICAgICByZWY9eyhyZWY6IEhUTUxEaXZFbGVtZW50IHwgbnVsbCkgPT4gcmVmICYmIHRoaXMuc2V0U3RhdGUoeyBoZWlnaHQ6IHJlZi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgfSl9XG4gICAgICA+XG4gICAgICAgIDxUaW1lbGluZUhlYWRlclJvd1xuICAgICAgICAgIGR1cmF0aW9uPXt0cmFjZS5kdXJhdGlvbn1cbiAgICAgICAgICBuYW1lQ29sdW1uV2lkdGg9e3RyYWNlVGltZWxpbmUuc3Bhbk5hbWVDb2x1bW5XaWR0aH1cbiAgICAgICAgICBudW1UaWNrcz17TlVNX1RJQ0tTfVxuICAgICAgICAgIG9uQ29sbGFwc2VBbGw9e3RoaXMuY29sbGFwc2VBbGx9XG4gICAgICAgICAgb25Db2xsYXBzZU9uZT17dGhpcy5jb2xsYXBzZU9uZX1cbiAgICAgICAgICBvbkNvbHVtbVdpZHRoQ2hhbmdlPXtzZXRTcGFuTmFtZUNvbHVtbldpZHRofVxuICAgICAgICAgIG9uRXhwYW5kQWxsPXt0aGlzLmV4cGFuZEFsbH1cbiAgICAgICAgICBvbkV4cGFuZE9uZT17dGhpcy5leHBhbmRPbmV9XG4gICAgICAgICAgdmlld1JhbmdlVGltZT17dmlld1JhbmdlLnRpbWV9XG4gICAgICAgICAgdXBkYXRlTmV4dFZpZXdSYW5nZVRpbWU9e3VwZGF0ZU5leHRWaWV3UmFuZ2VUaW1lfVxuICAgICAgICAgIHVwZGF0ZVZpZXdSYW5nZVRpbWU9e3VwZGF0ZVZpZXdSYW5nZVRpbWV9XG4gICAgICAgICAgY29sdW1uUmVzaXplSGFuZGxlSGVpZ2h0PXt0aGlzLnN0YXRlLmhlaWdodH1cbiAgICAgICAgLz5cbiAgICAgICAgPFZpcnR1YWxpemVkVHJhY2VWaWV3XG4gICAgICAgICAgey4uLnJlc3R9XG4gICAgICAgICAgey4uLnRyYWNlVGltZWxpbmV9XG4gICAgICAgICAgc2V0U3Bhbk5hbWVDb2x1bW5XaWR0aD17c2V0U3Bhbk5hbWVDb2x1bW5XaWR0aH1cbiAgICAgICAgICBjdXJyZW50Vmlld1JhbmdlVGltZT17dmlld1JhbmdlLnRpbWUuY3VycmVudH1cbiAgICAgICAgICB0b3BPZlZpZXdSZWY9e3RvcE9mVmlld1JlZn1cbiAgICAgICAgICBmb2N1c2VkU3BhbklkRm9yU2VhcmNoPXtmb2N1c2VkU3BhbklkRm9yU2VhcmNofVxuICAgICAgICAgIGRhdGFzb3VyY2VUeXBlPXt0aGlzLnByb3BzLmRhdGFzb3VyY2VUeXBlfVxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB3aXRoVGhlbWUyKFVudGhlbWVkVHJhY2VUaW1lbGluZVZpZXdlcik7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVNBLEdBQUcsUUFBUSxjQUFjO0FBQ2xDLE9BQU9DLEtBQUssTUFBcUIsT0FBTztBQUd4QyxTQUFTQyxNQUFNLEVBQUVDLGlCQUFpQixRQUFRLGtCQUFrQjtBQUM1RCxTQUFTQyxhQUFhLEVBQUVDLFVBQVUsUUFBUSxhQUFhO0FBR3ZELFNBQVNDLFNBQVMsUUFBUSxVQUFVO0FBQ3BDLFNBQVNDLEtBQUssSUFBSUMsY0FBYyxRQUFRLHVCQUF1QjtBQU0vRCxPQUFPQyxpQkFBaUIsTUFBTSxxQkFBcUI7QUFDbkQsT0FBT0Msb0JBQW9CLE1BQTRCLHdCQUF3QjtBQUFDLFNBQUFDLEdBQUEsSUFBQUMsSUFBQSxFQUFBQyxJQUFBLElBQUFDLEtBQUE7QUFPaEYsSUFBTUMsU0FBUyxHQUFHWCxhQUFhLENBQUMsVUFBQ1ksS0FBb0IsRUFBSztFQUN4RCxPQUFPO0lBQ0xDLG1CQUFtQixFQUFFakIsR0FBRyxDQUFBa0IsZUFBQSxLQUFBQSxlQUFBLEdBQUFDLDJCQUFBLGlqQkFFS2IsU0FBUyxDQUFDVSxLQUFLLEVBQUUsTUFBTSxDQUFDLEVBY3hDVixTQUFTLENBQUNVLEtBQUssRUFBRSxXQUFXLENBQUMsRUFJN0JWLFNBQVMsQ0FBQ1UsS0FBSyxFQUFFLE1BQU0sQ0FBQyxFQUl4QlYsU0FBUyxDQUFDVSxLQUFLLEVBQUUsTUFBTSxDQUFDLEVBSXhCVixTQUFTLENBQUNVLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDO0VBR2hELENBQUM7QUFDSCxDQUFDLENBQUM7QUFtREYsSUFBTUksU0FBUyxHQUFHLENBQUM7O0FBRW5CO0FBQ0E7QUFDQTtBQUNB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