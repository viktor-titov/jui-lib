import _extends from "@babel/runtime/helpers/extends";
// Copyright (c) 2017 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { createSelector, createStructuredSelector } from 'reselect';
import TreeNode from '../utils/TreeNode';
import { formatMillisecondTime, formatSecondTime, ONE_SECOND } from '../utils/date';
import { numberSortComparator } from '../utils/sort';
import { getProcessServiceName } from './process';
import { getSpanId, getSpanName, getSpanServiceName, getSpanTimestamp, getSpanDuration, getSpanProcessId } from './span';
export var getTraceId = function getTraceId(trace) {
  return trace.traceID;
};
export var getTraceSpans = function getTraceSpans(trace) {
  return trace.spans;
};
var getTraceProcesses = function getTraceProcesses(trace) {
  return trace.processes;
};
var getSpanWithProcess = createSelector(function (state) {
  return state.span;
}, function (state) {
  return state.processes;
}, function (span, processes) {
  return _extends({}, span, {
    process: processes[getSpanProcessId(span)]
  });
});
export var getTraceSpansAsMap = createSelector(getTraceSpans, function (spans) {
  return spans.reduce(function (map, span) {
    return map.set(getSpanId(span), span);
  }, new Map());
});
export var TREE_ROOT_ID = '__root__';

/**
 * Build a tree of { value: spanID, children } items derived from the
 * `span.references` information. The tree represents the grouping of parent /
 * child relationships. The root-most node is nominal in that
 * `.value === TREE_ROOT_ID`. This is done because a root span (the main trace
 * span) is not always included with the trace data. Thus, there can be
 * multiple top-level spans, and the root node acts as their common parent.
 *
 * The children are sorted by `span.startTime` after the tree is built.
 *
 * @param  {Trace} trace The trace to build the tree of spanIDs.
 * @return {TreeNode}    A tree of spanIDs derived from the relationships
 *                       between spans in the trace.
 */
export function getTraceSpanIdsAsTree(trace) {
  var nodesById = new Map(trace.spans.map(function (span) {
    return [span.spanID, new TreeNode(span.spanID)];
  }));
  var spansById = new Map(trace.spans.map(function (span) {
    return [span.spanID, span];
  }));
  var root = new TreeNode(TREE_ROOT_ID);
  trace.spans.forEach(function (span) {
    var node = nodesById.get(span.spanID);
    if (Array.isArray(span.references) && span.references.length) {
      var _span$references$ = span.references[0],
        refType = _span$references$.refType,
        parentID = _span$references$.spanID;
      if (refType === 'CHILD_OF' || refType === 'FOLLOWS_FROM') {
        var _parent$children;
        var parent = nodesById.get(parentID) || root;
        (_parent$children = parent.children) == null || _parent$children.push(node);
      } else {
        throw new Error("Unrecognized ref type: " + refType);
      }
    } else {
      root.children.push(node);
    }
  });
  var comparator = function comparator(nodeA, nodeB) {
    var a = nodeA != null && nodeA.value ? spansById.get(nodeA.value.toString()) : undefined;
    var b = nodeB != null && nodeB.value ? spansById.get(nodeB.value.toString()) : undefined;
    return +((a == null ? void 0 : a.startTime) > (b == null ? void 0 : b.startTime)) || +((a == null ? void 0 : a.startTime) === (b == null ? void 0 : b.startTime)) - 1;
  };
  trace.spans.forEach(function (span) {
    var node = nodesById.get(span.spanID);
    if (node.children.length > 1) {
      node == null || node.children.sort(comparator);
    }
  });
  root.children.sort(comparator);
  return root;
}

// attach "process" as an object to each span.
export var hydrateSpansWithProcesses = function hydrateSpansWithProcesses(trace) {
  var spans = getTraceSpans(trace);
  var processes = getTraceProcesses(trace);
  return _extends({}, trace, {
    spans: spans.map(function (span) {
      return getSpanWithProcess({
        span: span,
        processes: processes
      });
    })
  });
};
export var getTraceSpanCount = createSelector(getTraceSpans, function (spans) {
  return spans.length;
});
export var getTraceTimestamp = createSelector(getTraceSpans, function (spans) {
  return spans.reduce(function (prevTimestamp, span) {
    return prevTimestamp ? Math.min(prevTimestamp, getSpanTimestamp(span)) : getSpanTimestamp(span);
  }, 0);
});
export var getTraceDuration = createSelector(getTraceSpans, getTraceTimestamp, function (spans, timestamp) {
  return spans.reduce(function (prevDuration, span) {
    return prevDuration ? Math.max(getSpanTimestamp(span) - timestamp + getSpanDuration(span), prevDuration) : getSpanDuration(span);
  }, 0);
});
export var getTraceEndTimestamp = createSelector(getTraceTimestamp, getTraceDuration, function (timestamp, duration) {
  return timestamp + duration;
});
export var getParentSpan = createSelector(getTraceSpanIdsAsTree, getTraceSpansAsMap, function (tree, spanMap) {
  return tree.children.map(function (node) {
    return spanMap.get(node.value);
  }).sort(function (spanA, spanB) {
    return numberSortComparator(getSpanTimestamp(spanA), getSpanTimestamp(spanB));
  })[0];
});
export var getTraceDepth = createSelector(getTraceSpanIdsAsTree, function (spanTree) {
  return spanTree.depth - 1;
});
export var getSpanDepthForTrace = createSelector(createSelector(function (state) {
  return state.trace;
}, getTraceSpanIdsAsTree), createSelector(function (state) {
  return state.span;
}, getSpanId), function (node, spanID) {
  return node.getPath(spanID).length - 1;
});
export var getTraceServices = createSelector(getTraceProcesses, function (processes) {
  return Object.keys(processes).reduce(function (services, processID) {
    return services.add(getProcessServiceName(processes[processID]));
  }, new Set());
});
export var getTraceServiceCount = createSelector(getTraceServices, function (services) {
  return services.size;
});

// establish constants to determine how math should be handled
// for nanosecond-to-millisecond conversions.
export var DURATION_FORMATTERS = {
  ms: formatMillisecondTime,
  s: formatSecondTime
};
var getDurationFormatterForTrace = createSelector(getTraceDuration, function (totalDuration) {
  return totalDuration >= ONE_SECOND ? DURATION_FORMATTERS.s : DURATION_FORMATTERS.ms;
});
export var formatDurationForUnit = createSelector(function (_ref) {
  var duration = _ref.duration;
  return duration;
}, function (_ref2) {
  var unit = _ref2.unit;
  return DURATION_FORMATTERS[unit];
}, function (duration, formatter) {
  return formatter(duration);
});
export var formatDurationForTrace = createSelector(function (_ref3) {
  var duration = _ref3.duration;
  return duration;
}, createSelector(function (_ref4) {
  var trace = _ref4.trace;
  return trace;
}, getDurationFormatterForTrace), function (duration, formatter) {
  return formatter(duration);
});
export var getSortedSpans = createSelector(function (_ref5) {
  var trace = _ref5.trace;
  return trace;
}, function (_ref6) {
  var spans = _ref6.spans;
  return spans;
}, function (_ref7) {
  var sort = _ref7.sort;
  return sort;
}, function (trace, spans, _ref8) {
  var dir = _ref8.dir,
    comparator = _ref8.comparator,
    selector = _ref8.selector;
  return [].concat(spans).sort(function (spanA, spanB) {
    return dir * comparator(selector(spanA, trace), selector(spanB, trace));
  });
});
var getTraceSpansByHierarchyPosition = createSelector(getTraceSpanIdsAsTree, function (tree) {
  var hierarchyPositionMap = new Map();
  var i = 0;
  tree.walk(function (spanID) {
    return hierarchyPositionMap.set(spanID, i++);
  });
  return hierarchyPositionMap;
});
export var getTreeSizeForTraceSpan = createSelector(createSelector(function (state) {
  return state.trace;
}, getTraceSpanIdsAsTree), createSelector(function (state) {
  return state.span;
}, getSpanId), function (tree, spanID) {
  var node = tree.find(spanID);
  if (!node) {
    return -1;
  }
  return node.size - 1;
});
export var getSpanHierarchySortPositionForTrace = createSelector(createSelector(function (_ref9) {
  var trace = _ref9.trace;
  return trace;
}, getTraceSpansByHierarchyPosition), function (_ref10) {
  var span = _ref10.span;
  return span;
}, function (hierarchyPositionMap, span) {
  return hierarchyPositionMap.get(getSpanId(span));
});
export var getTraceName = createSelector(createSelector(createSelector(hydrateSpansWithProcesses, getParentSpan), createStructuredSelector({
  name: getSpanName,
  serviceName: getSpanServiceName
})), function (_ref11) {
  var name = _ref11.name,
    serviceName = _ref11.serviceName;
  return serviceName + ": " + name;
});
export var omitCollapsedSpans = createSelector(function (_ref12) {
  var spans = _ref12.spans;
  return spans;
}, createSelector(function (_ref13) {
  var trace = _ref13.trace;
  return trace;
}, getTraceSpanIdsAsTree), function (_ref14) {
  var collapsed = _ref14.collapsed;
  return collapsed;
}, function (spans, tree, collapse) {
  var hiddenSpanIds = collapse.reduce(function (result, collapsedSpanId) {
    tree.find(collapsedSpanId).walk(function (id) {
      return id !== collapsedSpanId && result.add(id);
    });
    return result;
  }, new Set());
  return hiddenSpanIds.size > 0 ? spans.filter(function (span) {
    return !hiddenSpanIds.has(getSpanId(span));
  }) : spans;
});
export var DEFAULT_TICK_INTERVAL = 4;
export var DEFAULT_TICK_WIDTH = 3;
export var getTicksForTrace = createSelector(function (_ref15) {
  var trace = _ref15.trace;
  return trace;
}, function (_ref16) {
  var _ref16$interval = _ref16.interval,
    interval = _ref16$interval === void 0 ? DEFAULT_TICK_INTERVAL : _ref16$interval;
  return interval;
}, function (_ref17) {
  var _ref17$width = _ref17.width,
    width = _ref17$width === void 0 ? DEFAULT_TICK_WIDTH : _ref17$width;
  return width;
}, function (trace, interval, width) {
  return [].concat(Array(interval + 1).keys()).map(function (num) {
    return {
      timestamp: getTraceTimestamp(trace) + getTraceDuration(trace) * (num / interval),
      width: width
    };
  });
});

// TODO: delete this when the backend can ensure uniqueness
/* istanbul ignore next */
export var enforceUniqueSpanIds = createSelector( /* istanbul ignore next */function (trace) {
  return trace;
}, getTraceSpans, /* istanbul ignore next */function (trace, spans) {
  var map = new Map();
  var spanArray = [];
  return _extends({}, trace, {
    spans: spans.reduce(function (result, span) {
      var spanID = map.has(getSpanId(span)) ? getSpanId(span) + "_" + map.get(getSpanId(span)) : getSpanId(span);
      var updatedSpan = _extends({}, span, {
        spanID: spanID
      });
      if (spanID !== getSpanId(span)) {
        // eslint-disable-next-line no-console
        console.warn('duplicate spanID in trace replaced', getSpanId(span), 'new:', spanID);
      }

      // set the presence of the span in the map or increment the number
      map.set(getSpanId(span), (map.get(getSpanId(span)) || 0) + 1);
      return result.concat([updatedSpan]);
    }, spanArray)
  });
});

// TODO: delete this when the backend can ensure uniqueness
export var dropEmptyStartTimeSpans = createSelector( /* istanbul ignore next */function (trace) {
  return trace;
}, getTraceSpans, /* istanbul ignore next */function (trace, spans) {
  return _extends({}, trace, {
    spans: spans.filter(function (span) {
      return !!getSpanTimestamp(span);
    })
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVTZWxlY3RvciIsImNyZWF0ZVN0cnVjdHVyZWRTZWxlY3RvciIsIlRyZWVOb2RlIiwiZm9ybWF0TWlsbGlzZWNvbmRUaW1lIiwiZm9ybWF0U2Vjb25kVGltZSIsIk9ORV9TRUNPTkQiLCJudW1iZXJTb3J0Q29tcGFyYXRvciIsImdldFByb2Nlc3NTZXJ2aWNlTmFtZSIsImdldFNwYW5JZCIsImdldFNwYW5OYW1lIiwiZ2V0U3BhblNlcnZpY2VOYW1lIiwiZ2V0U3BhblRpbWVzdGFtcCIsImdldFNwYW5EdXJhdGlvbiIsImdldFNwYW5Qcm9jZXNzSWQiLCJnZXRUcmFjZUlkIiwidHJhY2UiLCJ0cmFjZUlEIiwiZ2V0VHJhY2VTcGFucyIsInNwYW5zIiwiZ2V0VHJhY2VQcm9jZXNzZXMiLCJwcm9jZXNzZXMiLCJnZXRTcGFuV2l0aFByb2Nlc3MiLCJzdGF0ZSIsInNwYW4iLCJfZXh0ZW5kcyIsInByb2Nlc3MiLCJnZXRUcmFjZVNwYW5zQXNNYXAiLCJyZWR1Y2UiLCJtYXAiLCJzZXQiLCJNYXAiLCJUUkVFX1JPT1RfSUQiLCJnZXRUcmFjZVNwYW5JZHNBc1RyZWUiLCJub2Rlc0J5SWQiLCJzcGFuSUQiLCJzcGFuc0J5SWQiLCJyb290IiwiZm9yRWFjaCIsIm5vZGUiLCJnZXQiLCJBcnJheSIsImlzQXJyYXkiLCJyZWZlcmVuY2VzIiwibGVuZ3RoIiwiX3NwYW4kcmVmZXJlbmNlcyQiLCJyZWZUeXBlIiwicGFyZW50SUQiLCJfcGFyZW50JGNoaWxkcmVuIiwicGFyZW50IiwiY2hpbGRyZW4iLCJwdXNoIiwiRXJyb3IiLCJjb21wYXJhdG9yIiwibm9kZUEiLCJub2RlQiIsImEiLCJ2YWx1ZSIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwiYiIsInN0YXJ0VGltZSIsInNvcnQiLCJoeWRyYXRlU3BhbnNXaXRoUHJvY2Vzc2VzIiwiZ2V0VHJhY2VTcGFuQ291bnQiLCJnZXRUcmFjZVRpbWVzdGFtcCIsInByZXZUaW1lc3RhbXAiLCJNYXRoIiwibWluIiwiZ2V0VHJhY2VEdXJhdGlvbiIsInRpbWVzdGFtcCIsInByZXZEdXJhdGlvbiIsIm1heCIsImdldFRyYWNlRW5kVGltZXN0YW1wIiwiZHVyYXRpb24iLCJnZXRQYXJlbnRTcGFuIiwidHJlZSIsInNwYW5NYXAiLCJzcGFuQSIsInNwYW5CIiwiZ2V0VHJhY2VEZXB0aCIsInNwYW5UcmVlIiwiZGVwdGgiLCJnZXRTcGFuRGVwdGhGb3JUcmFjZSIsImdldFBhdGgiLCJnZXRUcmFjZVNlcnZpY2VzIiwiT2JqZWN0Iiwia2V5cyIsInNlcnZpY2VzIiwicHJvY2Vzc0lEIiwiYWRkIiwiU2V0IiwiZ2V0VHJhY2VTZXJ2aWNlQ291bnQiLCJzaXplIiwiRFVSQVRJT05fRk9STUFUVEVSUyIsIm1zIiwicyIsImdldER1cmF0aW9uRm9ybWF0dGVyRm9yVHJhY2UiLCJ0b3RhbER1cmF0aW9uIiwiZm9ybWF0RHVyYXRpb25Gb3JVbml0IiwiX3JlZiIsIl9yZWYyIiwidW5pdCIsImZvcm1hdHRlciIsImZvcm1hdER1cmF0aW9uRm9yVHJhY2UiLCJfcmVmMyIsIl9yZWY0IiwiZ2V0U29ydGVkU3BhbnMiLCJfcmVmNSIsIl9yZWY2IiwiX3JlZjciLCJfcmVmOCIsImRpciIsInNlbGVjdG9yIiwiY29uY2F0IiwiZ2V0VHJhY2VTcGFuc0J5SGllcmFyY2h5UG9zaXRpb24iLCJoaWVyYXJjaHlQb3NpdGlvbk1hcCIsImkiLCJ3YWxrIiwiZ2V0VHJlZVNpemVGb3JUcmFjZVNwYW4iLCJmaW5kIiwiZ2V0U3BhbkhpZXJhcmNoeVNvcnRQb3NpdGlvbkZvclRyYWNlIiwiX3JlZjkiLCJfcmVmMTAiLCJnZXRUcmFjZU5hbWUiLCJuYW1lIiwic2VydmljZU5hbWUiLCJfcmVmMTEiLCJvbWl0Q29sbGFwc2VkU3BhbnMiLCJfcmVmMTIiLCJfcmVmMTMiLCJfcmVmMTQiLCJjb2xsYXBzZWQiLCJjb2xsYXBzZSIsImhpZGRlblNwYW5JZHMiLCJyZXN1bHQiLCJjb2xsYXBzZWRTcGFuSWQiLCJpZCIsImZpbHRlciIsImhhcyIsIkRFRkFVTFRfVElDS19JTlRFUlZBTCIsIkRFRkFVTFRfVElDS19XSURUSCIsImdldFRpY2tzRm9yVHJhY2UiLCJfcmVmMTUiLCJfcmVmMTYiLCJfcmVmMTYkaW50ZXJ2YWwiLCJpbnRlcnZhbCIsIl9yZWYxNyIsIl9yZWYxNyR3aWR0aCIsIndpZHRoIiwibnVtIiwiZW5mb3JjZVVuaXF1ZVNwYW5JZHMiLCJzcGFuQXJyYXkiLCJ1cGRhdGVkU3BhbiIsImNvbnNvbGUiLCJ3YXJuIiwiZHJvcEVtcHR5U3RhcnRUaW1lU3BhbnMiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL3NlbGVjdG9ycy90cmFjZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMTcgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4vLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgY3JlYXRlU2VsZWN0b3IsIGNyZWF0ZVN0cnVjdHVyZWRTZWxlY3RvciB9IGZyb20gJ3Jlc2VsZWN0JztcblxuaW1wb3J0IHsgVHJhY2UsIFRyYWNlRGF0YSwgVHJhY2VQcm9jZXNzLCBUcmFjZVJlc3BvbnNlLCBUcmFjZVNwYW4sIFRyYWNlU3BhbkRhdGEgfSBmcm9tICcuLi90eXBlcy90cmFjZSc7XG5pbXBvcnQgVHJlZU5vZGUgZnJvbSAnLi4vdXRpbHMvVHJlZU5vZGUnO1xuaW1wb3J0IHsgZm9ybWF0TWlsbGlzZWNvbmRUaW1lLCBmb3JtYXRTZWNvbmRUaW1lLCBPTkVfU0VDT05EIH0gZnJvbSAnLi4vdXRpbHMvZGF0ZSc7XG5pbXBvcnQgeyBudW1iZXJTb3J0Q29tcGFyYXRvciB9IGZyb20gJy4uL3V0aWxzL3NvcnQnO1xuXG5pbXBvcnQgeyBnZXRQcm9jZXNzU2VydmljZU5hbWUgfSBmcm9tICcuL3Byb2Nlc3MnO1xuaW1wb3J0IHtcbiAgZ2V0U3BhbklkLFxuICBnZXRTcGFuTmFtZSxcbiAgZ2V0U3BhblNlcnZpY2VOYW1lLFxuICBnZXRTcGFuVGltZXN0YW1wLFxuICBnZXRTcGFuRHVyYXRpb24sXG4gIGdldFNwYW5Qcm9jZXNzSWQsXG59IGZyb20gJy4vc3Bhbic7XG5cbmV4cG9ydCBjb25zdCBnZXRUcmFjZUlkID0gKHRyYWNlOiBUcmFjZURhdGEpID0+IHRyYWNlLnRyYWNlSUQ7XG5leHBvcnQgY29uc3QgZ2V0VHJhY2VTcGFucyA9ICh0cmFjZTogVHJhY2VSZXNwb25zZSkgPT4gdHJhY2Uuc3BhbnM7XG5jb25zdCBnZXRUcmFjZVByb2Nlc3NlcyA9ICh0cmFjZTogVHJhY2VEYXRhIHwgVHJhY2UpID0+IHRyYWNlLnByb2Nlc3NlcztcblxuY29uc3QgZ2V0U3BhbldpdGhQcm9jZXNzID0gY3JlYXRlU2VsZWN0b3IoXG4gIChzdGF0ZTogeyBzcGFuOiBUcmFjZVNwYW5EYXRhOyBwcm9jZXNzZXM6IFJlY29yZDxzdHJpbmcsIFRyYWNlUHJvY2Vzcz4gfSkgPT4gc3RhdGUuc3BhbixcbiAgKHN0YXRlOiB7IHNwYW46IFRyYWNlU3BhbkRhdGE7IHByb2Nlc3NlczogUmVjb3JkPHN0cmluZywgVHJhY2VQcm9jZXNzPiB9KSA9PiBzdGF0ZS5wcm9jZXNzZXMsXG4gIChzcGFuLCBwcm9jZXNzZXMpID0+ICh7XG4gICAgLi4uc3BhbixcbiAgICBwcm9jZXNzOiBwcm9jZXNzZXNbZ2V0U3BhblByb2Nlc3NJZChzcGFuKV0sXG4gIH0pXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0VHJhY2VTcGFuc0FzTWFwID0gY3JlYXRlU2VsZWN0b3IoZ2V0VHJhY2VTcGFucywgKHNwYW5zKSA9PlxuICBzcGFucy5yZWR1Y2UoKG1hcCwgc3BhbjogVHJhY2VTcGFuRGF0YSkgPT4gbWFwLnNldChnZXRTcGFuSWQoc3BhbiksIHNwYW4pLCBuZXcgTWFwKCkpXG4pO1xuXG5leHBvcnQgY29uc3QgVFJFRV9ST09UX0lEID0gJ19fcm9vdF9fJztcblxuLyoqXG4gKiBCdWlsZCBhIHRyZWUgb2YgeyB2YWx1ZTogc3BhbklELCBjaGlsZHJlbiB9IGl0ZW1zIGRlcml2ZWQgZnJvbSB0aGVcbiAqIGBzcGFuLnJlZmVyZW5jZXNgIGluZm9ybWF0aW9uLiBUaGUgdHJlZSByZXByZXNlbnRzIHRoZSBncm91cGluZyBvZiBwYXJlbnQgL1xuICogY2hpbGQgcmVsYXRpb25zaGlwcy4gVGhlIHJvb3QtbW9zdCBub2RlIGlzIG5vbWluYWwgaW4gdGhhdFxuICogYC52YWx1ZSA9PT0gVFJFRV9ST09UX0lEYC4gVGhpcyBpcyBkb25lIGJlY2F1c2UgYSByb290IHNwYW4gKHRoZSBtYWluIHRyYWNlXG4gKiBzcGFuKSBpcyBub3QgYWx3YXlzIGluY2x1ZGVkIHdpdGggdGhlIHRyYWNlIGRhdGEuIFRodXMsIHRoZXJlIGNhbiBiZVxuICogbXVsdGlwbGUgdG9wLWxldmVsIHNwYW5zLCBhbmQgdGhlIHJvb3Qgbm9kZSBhY3RzIGFzIHRoZWlyIGNvbW1vbiBwYXJlbnQuXG4gKlxuICogVGhlIGNoaWxkcmVuIGFyZSBzb3J0ZWQgYnkgYHNwYW4uc3RhcnRUaW1lYCBhZnRlciB0aGUgdHJlZSBpcyBidWlsdC5cbiAqXG4gKiBAcGFyYW0gIHtUcmFjZX0gdHJhY2UgVGhlIHRyYWNlIHRvIGJ1aWxkIHRoZSB0cmVlIG9mIHNwYW5JRHMuXG4gKiBAcmV0dXJuIHtUcmVlTm9kZX0gICAgQSB0cmVlIG9mIHNwYW5JRHMgZGVyaXZlZCBmcm9tIHRoZSByZWxhdGlvbnNoaXBzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgYmV0d2VlbiBzcGFucyBpbiB0aGUgdHJhY2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRUcmFjZVNwYW5JZHNBc1RyZWUodHJhY2U6IFRyYWNlUmVzcG9uc2UpIHtcbiAgY29uc3Qgbm9kZXNCeUlkID0gbmV3IE1hcCh0cmFjZS5zcGFucy5tYXAoKHNwYW46IFRyYWNlU3BhbkRhdGEpID0+IFtzcGFuLnNwYW5JRCwgbmV3IFRyZWVOb2RlKHNwYW4uc3BhbklEKV0pKTtcbiAgY29uc3Qgc3BhbnNCeUlkID0gbmV3IE1hcCh0cmFjZS5zcGFucy5tYXAoKHNwYW46IFRyYWNlU3BhbkRhdGEpID0+IFtzcGFuLnNwYW5JRCwgc3Bhbl0pKTtcbiAgY29uc3Qgcm9vdCA9IG5ldyBUcmVlTm9kZShUUkVFX1JPT1RfSUQpO1xuICB0cmFjZS5zcGFucy5mb3JFYWNoKChzcGFuOiBUcmFjZVNwYW5EYXRhKSA9PiB7XG4gICAgY29uc3Qgbm9kZSA9IG5vZGVzQnlJZC5nZXQoc3Bhbi5zcGFuSUQpITtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzcGFuLnJlZmVyZW5jZXMpICYmIHNwYW4ucmVmZXJlbmNlcy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHsgcmVmVHlwZSwgc3BhbklEOiBwYXJlbnRJRCB9ID0gc3Bhbi5yZWZlcmVuY2VzWzBdO1xuICAgICAgaWYgKHJlZlR5cGUgPT09ICdDSElMRF9PRicgfHwgcmVmVHlwZSA9PT0gJ0ZPTExPV1NfRlJPTScpIHtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gbm9kZXNCeUlkLmdldChwYXJlbnRJRCkgfHwgcm9vdDtcbiAgICAgICAgcGFyZW50LmNoaWxkcmVuPy5wdXNoKG5vZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnJlY29nbml6ZWQgcmVmIHR5cGU6ICR7cmVmVHlwZX1gKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcm9vdC5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IGNvbXBhcmF0b3IgPSAobm9kZUE6IFRyZWVOb2RlIHwgdW5kZWZpbmVkLCBub2RlQjogVHJlZU5vZGUgfCB1bmRlZmluZWQpID0+IHtcbiAgICBjb25zdCBhOiBUcmFjZVNwYW5EYXRhIHwgdW5kZWZpbmVkID0gbm9kZUE/LnZhbHVlID8gc3BhbnNCeUlkLmdldChub2RlQS52YWx1ZS50b1N0cmluZygpKSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBiOiBUcmFjZVNwYW5EYXRhIHwgdW5kZWZpbmVkID0gbm9kZUI/LnZhbHVlID8gc3BhbnNCeUlkLmdldChub2RlQi52YWx1ZS50b1N0cmluZygpKSA6IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gKyhhPy5zdGFydFRpbWUhID4gYj8uc3RhcnRUaW1lISkgfHwgKyhhPy5zdGFydFRpbWUgPT09IGI/LnN0YXJ0VGltZSkgLSAxO1xuICB9O1xuICB0cmFjZS5zcGFucy5mb3JFYWNoKChzcGFuOiBUcmFjZVNwYW5EYXRhKSA9PiB7XG4gICAgY29uc3Qgbm9kZTogVHJlZU5vZGUgfCB1bmRlZmluZWQgPSBub2Rlc0J5SWQuZ2V0KHNwYW4uc3BhbklEKTtcbiAgICBpZiAobm9kZSEuY2hpbGRyZW4ubGVuZ3RoID4gMSkge1xuICAgICAgbm9kZT8uY2hpbGRyZW4uc29ydChjb21wYXJhdG9yKTtcbiAgICB9XG4gIH0pO1xuICByb290LmNoaWxkcmVuLnNvcnQoY29tcGFyYXRvcik7XG4gIHJldHVybiByb290O1xufVxuXG4vLyBhdHRhY2ggXCJwcm9jZXNzXCIgYXMgYW4gb2JqZWN0IHRvIGVhY2ggc3Bhbi5cbmV4cG9ydCBjb25zdCBoeWRyYXRlU3BhbnNXaXRoUHJvY2Vzc2VzID0gKHRyYWNlOiBUcmFjZVJlc3BvbnNlKSA9PiB7XG4gIGNvbnN0IHNwYW5zID0gZ2V0VHJhY2VTcGFucyh0cmFjZSk7XG4gIGNvbnN0IHByb2Nlc3NlcyA9IGdldFRyYWNlUHJvY2Vzc2VzKHRyYWNlKTtcblxuICByZXR1cm4ge1xuICAgIC4uLnRyYWNlLFxuICAgIHNwYW5zOiBzcGFucy5tYXAoKHNwYW46IFRyYWNlU3BhbkRhdGEpID0+IGdldFNwYW5XaXRoUHJvY2Vzcyh7IHNwYW4sIHByb2Nlc3NlcyB9KSksXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0VHJhY2VTcGFuQ291bnQgPSBjcmVhdGVTZWxlY3RvcihnZXRUcmFjZVNwYW5zLCAoc3BhbnMpID0+IHNwYW5zLmxlbmd0aCk7XG5cbmV4cG9ydCBjb25zdCBnZXRUcmFjZVRpbWVzdGFtcCA9IGNyZWF0ZVNlbGVjdG9yKGdldFRyYWNlU3BhbnMsIChzcGFucykgPT5cbiAgc3BhbnMucmVkdWNlKFxuICAgIChwcmV2VGltZXN0YW1wOiBudW1iZXIsIHNwYW46IFRyYWNlU3BhbkRhdGEpID0+XG4gICAgICBwcmV2VGltZXN0YW1wID8gTWF0aC5taW4ocHJldlRpbWVzdGFtcCwgZ2V0U3BhblRpbWVzdGFtcChzcGFuKSkgOiBnZXRTcGFuVGltZXN0YW1wKHNwYW4pLFxuICAgIDBcbiAgKVxuKTtcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlRHVyYXRpb24gPSBjcmVhdGVTZWxlY3RvcihnZXRUcmFjZVNwYW5zLCBnZXRUcmFjZVRpbWVzdGFtcCwgKHNwYW5zLCB0aW1lc3RhbXApID0+XG4gIHNwYW5zLnJlZHVjZShcbiAgICAocHJldkR1cmF0aW9uOiBudW1iZXIsIHNwYW46IFRyYWNlU3BhbkRhdGEpID0+XG4gICAgICBwcmV2RHVyYXRpb25cbiAgICAgICAgPyBNYXRoLm1heChnZXRTcGFuVGltZXN0YW1wKHNwYW4pIC0gdGltZXN0YW1wISArIGdldFNwYW5EdXJhdGlvbihzcGFuKSwgcHJldkR1cmF0aW9uKVxuICAgICAgICA6IGdldFNwYW5EdXJhdGlvbihzcGFuKSxcbiAgICAwXG4gIClcbik7XG5cbmV4cG9ydCBjb25zdCBnZXRUcmFjZUVuZFRpbWVzdGFtcCA9IGNyZWF0ZVNlbGVjdG9yKFxuICBnZXRUcmFjZVRpbWVzdGFtcCxcbiAgZ2V0VHJhY2VEdXJhdGlvbixcbiAgKHRpbWVzdGFtcDogbnVtYmVyLCBkdXJhdGlvbjogbnVtYmVyKSA9PiB0aW1lc3RhbXAhICsgZHVyYXRpb25cbik7XG5cbmV4cG9ydCBjb25zdCBnZXRQYXJlbnRTcGFuID0gY3JlYXRlU2VsZWN0b3IoXG4gIGdldFRyYWNlU3Bhbklkc0FzVHJlZSxcbiAgZ2V0VHJhY2VTcGFuc0FzTWFwLFxuICAodHJlZSwgc3Bhbk1hcCkgPT5cbiAgICB0cmVlLmNoaWxkcmVuXG4gICAgICAubWFwKChub2RlOiBUcmVlTm9kZSkgPT4gc3Bhbk1hcC5nZXQobm9kZS52YWx1ZSkpXG4gICAgICAuc29ydCgoc3BhbkE6IFRyYWNlU3BhbkRhdGEsIHNwYW5COiBUcmFjZVNwYW5EYXRhKSA9PlxuICAgICAgICBudW1iZXJTb3J0Q29tcGFyYXRvcihnZXRTcGFuVGltZXN0YW1wKHNwYW5BKSwgZ2V0U3BhblRpbWVzdGFtcChzcGFuQikpXG4gICAgICApWzBdXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0VHJhY2VEZXB0aCA9IGNyZWF0ZVNlbGVjdG9yKGdldFRyYWNlU3Bhbklkc0FzVHJlZSwgKHNwYW5UcmVlKSA9PiBzcGFuVHJlZS5kZXB0aCAtIDEpO1xuXG5leHBvcnQgY29uc3QgZ2V0U3BhbkRlcHRoRm9yVHJhY2UgPSBjcmVhdGVTZWxlY3RvcihcbiAgY3JlYXRlU2VsZWN0b3IoKHN0YXRlOiB7IHRyYWNlOiBUcmFjZVJlc3BvbnNlIH0pID0+IHN0YXRlLnRyYWNlLCBnZXRUcmFjZVNwYW5JZHNBc1RyZWUpLFxuICBjcmVhdGVTZWxlY3Rvcigoc3RhdGU6IHsgc3BhbjogVHJhY2VTcGFuRGF0YSB9KSA9PiBzdGF0ZS5zcGFuLCBnZXRTcGFuSWQpLFxuICAobm9kZSwgc3BhbklEKSA9PiBub2RlLmdldFBhdGgoc3BhbklEKSEubGVuZ3RoIC0gMVxuKTtcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlU2VydmljZXMgPSBjcmVhdGVTZWxlY3RvcihnZXRUcmFjZVByb2Nlc3NlcywgKHByb2Nlc3NlcykgPT5cbiAgT2JqZWN0LmtleXMocHJvY2Vzc2VzKS5yZWR1Y2UoXG4gICAgKHNlcnZpY2VzLCBwcm9jZXNzSUQpID0+IHNlcnZpY2VzLmFkZChnZXRQcm9jZXNzU2VydmljZU5hbWUocHJvY2Vzc2VzW3Byb2Nlc3NJRF0pKSxcbiAgICBuZXcgU2V0KClcbiAgKVxuKTtcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlU2VydmljZUNvdW50ID0gY3JlYXRlU2VsZWN0b3IoZ2V0VHJhY2VTZXJ2aWNlcywgKHNlcnZpY2VzKSA9PiBzZXJ2aWNlcy5zaXplKTtcblxuLy8gZXN0YWJsaXNoIGNvbnN0YW50cyB0byBkZXRlcm1pbmUgaG93IG1hdGggc2hvdWxkIGJlIGhhbmRsZWRcbi8vIGZvciBuYW5vc2Vjb25kLXRvLW1pbGxpc2Vjb25kIGNvbnZlcnNpb25zLlxuZXhwb3J0IGNvbnN0IERVUkFUSU9OX0ZPUk1BVFRFUlMgPSB7XG4gIG1zOiBmb3JtYXRNaWxsaXNlY29uZFRpbWUsXG4gIHM6IGZvcm1hdFNlY29uZFRpbWUsXG59O1xuXG5jb25zdCBnZXREdXJhdGlvbkZvcm1hdHRlckZvclRyYWNlID0gY3JlYXRlU2VsZWN0b3IoZ2V0VHJhY2VEdXJhdGlvbiwgKHRvdGFsRHVyYXRpb246IG51bWJlcikgPT5cbiAgdG90YWxEdXJhdGlvbiA+PSBPTkVfU0VDT05EID8gRFVSQVRJT05fRk9STUFUVEVSUy5zIDogRFVSQVRJT05fRk9STUFUVEVSUy5tc1xuKTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdER1cmF0aW9uRm9yVW5pdCA9IGNyZWF0ZVNlbGVjdG9yKFxuICAoeyBkdXJhdGlvbiB9OiB7IGR1cmF0aW9uOiBudW1iZXIgfSkgPT4gZHVyYXRpb24sXG4gICh7IHVuaXQgfTogeyB1bml0OiAnbXMnIHwgJ3MnIH0pID0+IERVUkFUSU9OX0ZPUk1BVFRFUlNbdW5pdF0sXG4gIChkdXJhdGlvbiwgZm9ybWF0dGVyKSA9PiBmb3JtYXR0ZXIoZHVyYXRpb24pXG4pO1xuXG5leHBvcnQgY29uc3QgZm9ybWF0RHVyYXRpb25Gb3JUcmFjZSA9IGNyZWF0ZVNlbGVjdG9yKFxuICAoeyBkdXJhdGlvbiB9OiB7IGR1cmF0aW9uOiBudW1iZXIgfSkgPT4gZHVyYXRpb24sXG4gIGNyZWF0ZVNlbGVjdG9yKCh7IHRyYWNlIH06IHsgdHJhY2U6IFRyYWNlUmVzcG9uc2UgfSkgPT4gdHJhY2UsIGdldER1cmF0aW9uRm9ybWF0dGVyRm9yVHJhY2UpLFxuICAoZHVyYXRpb24sIGZvcm1hdHRlcikgPT4gZm9ybWF0dGVyKGR1cmF0aW9uKVxuKTtcblxuZXhwb3J0IGNvbnN0IGdldFNvcnRlZFNwYW5zID0gY3JlYXRlU2VsZWN0b3IoXG4gICh7IHRyYWNlIH06IHsgdHJhY2U6IFRyYWNlUmVzcG9uc2UgfSkgPT4gdHJhY2UsXG4gICh7IHNwYW5zIH06IHsgc3BhbnM6IFRyYWNlU3BhbkRhdGFbXSB9KSA9PiBzcGFucyxcbiAgKHtcbiAgICBzb3J0LFxuICB9OiB7XG4gICAgc29ydDoge1xuICAgICAgZGlyOiBudW1iZXI7XG4gICAgICBjb21wYXJhdG9yOiAoaXRlbUE6IG51bWJlciwgaXRlbUI6IG51bWJlcikgPT4gbnVtYmVyO1xuICAgICAgc2VsZWN0b3I6IChpdGVtQTogVHJhY2VTcGFuRGF0YSwgaXRlbUI6IFRyYWNlUmVzcG9uc2UpID0+IG51bWJlcjtcbiAgICB9O1xuICB9KSA9PiBzb3J0LFxuICAodHJhY2UsIHNwYW5zLCB7IGRpciwgY29tcGFyYXRvciwgc2VsZWN0b3IgfSkgPT5cbiAgICBbLi4uc3BhbnNdLnNvcnQoKHNwYW5BLCBzcGFuQikgPT4gZGlyICogY29tcGFyYXRvcihzZWxlY3RvcihzcGFuQSwgdHJhY2UpLCBzZWxlY3RvcihzcGFuQiwgdHJhY2UpKSlcbik7XG5cbmNvbnN0IGdldFRyYWNlU3BhbnNCeUhpZXJhcmNoeVBvc2l0aW9uID0gY3JlYXRlU2VsZWN0b3IoZ2V0VHJhY2VTcGFuSWRzQXNUcmVlLCAodHJlZSkgPT4ge1xuICBjb25zdCBoaWVyYXJjaHlQb3NpdGlvbk1hcCA9IG5ldyBNYXAoKTtcbiAgbGV0IGkgPSAwO1xuICB0cmVlLndhbGsoKHNwYW5JRDogc3RyaW5nIHwgbnVtYmVyIHwgdW5kZWZpbmVkKSA9PiBoaWVyYXJjaHlQb3NpdGlvbk1hcC5zZXQoc3BhbklELCBpKyspKTtcbiAgcmV0dXJuIGhpZXJhcmNoeVBvc2l0aW9uTWFwO1xufSk7XG5cbmV4cG9ydCBjb25zdCBnZXRUcmVlU2l6ZUZvclRyYWNlU3BhbiA9IGNyZWF0ZVNlbGVjdG9yKFxuICBjcmVhdGVTZWxlY3Rvcigoc3RhdGU6IHsgdHJhY2U6IFRyYWNlUmVzcG9uc2UgfSkgPT4gc3RhdGUudHJhY2UsIGdldFRyYWNlU3Bhbklkc0FzVHJlZSksXG4gIGNyZWF0ZVNlbGVjdG9yKChzdGF0ZTogeyBzcGFuOiBUcmFjZVNwYW5EYXRhIH0pID0+IHN0YXRlLnNwYW4sIGdldFNwYW5JZCksXG4gICh0cmVlLCBzcGFuSUQpID0+IHtcbiAgICBjb25zdCBub2RlID0gdHJlZS5maW5kKHNwYW5JRCk7XG4gICAgaWYgKCFub2RlKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIHJldHVybiBub2RlLnNpemUgLSAxO1xuICB9XG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0U3BhbkhpZXJhcmNoeVNvcnRQb3NpdGlvbkZvclRyYWNlID0gY3JlYXRlU2VsZWN0b3IoXG4gIGNyZWF0ZVNlbGVjdG9yKCh7IHRyYWNlIH06IHsgdHJhY2U6IFRyYWNlIH0pID0+IHRyYWNlLCBnZXRUcmFjZVNwYW5zQnlIaWVyYXJjaHlQb3NpdGlvbiksXG4gICh7IHNwYW4gfTogeyBzcGFuOiBUcmFjZVNwYW4gfSkgPT4gc3BhbixcbiAgKGhpZXJhcmNoeVBvc2l0aW9uTWFwLCBzcGFuKSA9PiBoaWVyYXJjaHlQb3NpdGlvbk1hcC5nZXQoZ2V0U3BhbklkKHNwYW4pKVxuKTtcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlTmFtZSA9IGNyZWF0ZVNlbGVjdG9yKFxuICBjcmVhdGVTZWxlY3RvcihcbiAgICBjcmVhdGVTZWxlY3RvcihoeWRyYXRlU3BhbnNXaXRoUHJvY2Vzc2VzLCBnZXRQYXJlbnRTcGFuKSxcbiAgICBjcmVhdGVTdHJ1Y3R1cmVkU2VsZWN0b3Ioe1xuICAgICAgbmFtZTogZ2V0U3Bhbk5hbWUsXG4gICAgICBzZXJ2aWNlTmFtZTogZ2V0U3BhblNlcnZpY2VOYW1lLFxuICAgIH0pXG4gICksXG4gICh7IG5hbWUsIHNlcnZpY2VOYW1lIH06IHsgbmFtZTogc3RyaW5nOyBzZXJ2aWNlTmFtZTogc3RyaW5nIH0pID0+IGAke3NlcnZpY2VOYW1lfTogJHtuYW1lfWBcbik7XG5cbmV4cG9ydCBjb25zdCBvbWl0Q29sbGFwc2VkU3BhbnMgPSBjcmVhdGVTZWxlY3RvcihcbiAgKHsgc3BhbnMgfTogeyBzcGFuczogVHJhY2VTcGFuRGF0YVtdIH0pID0+IHNwYW5zLFxuICBjcmVhdGVTZWxlY3RvcigoeyB0cmFjZSB9OiB7IHRyYWNlOiBUcmFjZVJlc3BvbnNlIH0pID0+IHRyYWNlLCBnZXRUcmFjZVNwYW5JZHNBc1RyZWUpLFxuICAoeyBjb2xsYXBzZWQgfTogeyBjb2xsYXBzZWQ6IHN0cmluZ1tdIH0pID0+IGNvbGxhcHNlZCxcbiAgKHNwYW5zLCB0cmVlLCBjb2xsYXBzZSkgPT4ge1xuICAgIGNvbnN0IGhpZGRlblNwYW5JZHMgPSBjb2xsYXBzZS5yZWR1Y2UoKHJlc3VsdCwgY29sbGFwc2VkU3BhbklkKSA9PiB7XG4gICAgICB0cmVlLmZpbmQoY29sbGFwc2VkU3BhbklkKSEud2FsaygoaWQ6IHN0cmluZyB8IG51bWJlciB8IHVuZGVmaW5lZCkgPT4gaWQgIT09IGNvbGxhcHNlZFNwYW5JZCAmJiByZXN1bHQuYWRkKGlkKSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sIG5ldyBTZXQoKSk7XG5cbiAgICByZXR1cm4gaGlkZGVuU3Bhbklkcy5zaXplID4gMCA/IHNwYW5zLmZpbHRlcigoc3BhbikgPT4gIWhpZGRlblNwYW5JZHMuaGFzKGdldFNwYW5JZChzcGFuKSkpIDogc3BhbnM7XG4gIH1cbik7XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1RJQ0tfSU5URVJWQUwgPSA0O1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfVElDS19XSURUSCA9IDM7XG5leHBvcnQgY29uc3QgZ2V0VGlja3NGb3JUcmFjZSA9IGNyZWF0ZVNlbGVjdG9yKFxuICAoeyB0cmFjZSB9OiB7IHRyYWNlOiBUcmFjZVJlc3BvbnNlIH0pID0+IHRyYWNlLFxuICAoeyBpbnRlcnZhbCA9IERFRkFVTFRfVElDS19JTlRFUlZBTCB9OiB7IGludGVydmFsPzogbnVtYmVyIH0pID0+IGludGVydmFsLFxuICAoeyB3aWR0aCA9IERFRkFVTFRfVElDS19XSURUSCB9OiB7IHdpZHRoPzogbnVtYmVyIH0pID0+IHdpZHRoLFxuICAoXG4gICAgdHJhY2UsXG4gICAgaW50ZXJ2YWw6IG51bWJlcixcbiAgICB3aWR0aDogbnVtYmVyXG4gICAgLy8gdGltZXN0YW1wcyB3aWxsIGJlIHNwYWNlZCBvdmVyIHRoZSBpbnRlcnZhbCwgc3RhcnRpbmcgZnJvbSB0aGUgaW5pdGlhbCB0aW1lc3RhbXBcbiAgKSA9PlxuICAgIFsuLi5BcnJheShpbnRlcnZhbCArIDEpLmtleXMoKV0ubWFwKChudW0pID0+ICh7XG4gICAgICB0aW1lc3RhbXA6IGdldFRyYWNlVGltZXN0YW1wKHRyYWNlKSArIGdldFRyYWNlRHVyYXRpb24odHJhY2UpICogKG51bSAvIGludGVydmFsKSxcbiAgICAgIHdpZHRoLFxuICAgIH0pKVxuKTtcblxuLy8gVE9ETzogZGVsZXRlIHRoaXMgd2hlbiB0aGUgYmFja2VuZCBjYW4gZW5zdXJlIHVuaXF1ZW5lc3Ncbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG5leHBvcnQgY29uc3QgZW5mb3JjZVVuaXF1ZVNwYW5JZHMgPSBjcmVhdGVTZWxlY3RvcihcbiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gKHRyYWNlOiBUcmFjZSkgPT4gdHJhY2UsXG4gIGdldFRyYWNlU3BhbnMsXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovICh0cmFjZSwgc3BhbnMpID0+IHtcbiAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7XG5cbiAgICBjb25zdCBzcGFuQXJyYXk6IFRyYWNlU3BhbkRhdGFbXSA9IFtdO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRyYWNlLFxuICAgICAgc3BhbnM6IHNwYW5zLnJlZHVjZSgocmVzdWx0OiBUcmFjZVNwYW5EYXRhW10sIHNwYW46IFRyYWNlU3BhbkRhdGEpID0+IHtcbiAgICAgICAgY29uc3Qgc3BhbklEID0gbWFwLmhhcyhnZXRTcGFuSWQoc3BhbikpID8gYCR7Z2V0U3BhbklkKHNwYW4pfV8ke21hcC5nZXQoZ2V0U3BhbklkKHNwYW4pKX1gIDogZ2V0U3BhbklkKHNwYW4pO1xuICAgICAgICBjb25zdCB1cGRhdGVkU3BhbiA9IHsgLi4uc3Bhbiwgc3BhbklEIH07XG5cbiAgICAgICAgaWYgKHNwYW5JRCAhPT0gZ2V0U3BhbklkKHNwYW4pKSB7XG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ2R1cGxpY2F0ZSBzcGFuSUQgaW4gdHJhY2UgcmVwbGFjZWQnLCBnZXRTcGFuSWQoc3BhbiksICduZXc6Jywgc3BhbklEKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNldCB0aGUgcHJlc2VuY2Ugb2YgdGhlIHNwYW4gaW4gdGhlIG1hcCBvciBpbmNyZW1lbnQgdGhlIG51bWJlclxuICAgICAgICBtYXAuc2V0KGdldFNwYW5JZChzcGFuKSwgKG1hcC5nZXQoZ2V0U3BhbklkKHNwYW4pKSB8fCAwKSArIDEpO1xuXG4gICAgICAgIHJldHVybiByZXN1bHQuY29uY2F0KFt1cGRhdGVkU3Bhbl0pO1xuICAgICAgfSwgc3BhbkFycmF5KSxcbiAgICB9O1xuICB9XG4pO1xuXG4vLyBUT0RPOiBkZWxldGUgdGhpcyB3aGVuIHRoZSBiYWNrZW5kIGNhbiBlbnN1cmUgdW5pcXVlbmVzc1xuZXhwb3J0IGNvbnN0IGRyb3BFbXB0eVN0YXJ0VGltZVNwYW5zID0gY3JlYXRlU2VsZWN0b3IoXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovICh0cmFjZTogVHJhY2UpID0+IHRyYWNlLFxuICBnZXRUcmFjZVNwYW5zLFxuICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyAodHJhY2UsIHNwYW5zKSA9PiAoe1xuICAgIC4uLnRyYWNlLFxuICAgIHNwYW5zOiBzcGFucy5maWx0ZXIoKHNwYW46IFRyYWNlU3BhbkRhdGEpID0+ICEhZ2V0U3BhblRpbWVzdGFtcChzcGFuKSksXG4gIH0pXG4pO1xuIl0sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsY0FBYyxFQUFFQyx3QkFBd0IsUUFBUSxVQUFVO0FBR25FLE9BQU9DLFFBQVEsTUFBTSxtQkFBbUI7QUFDeEMsU0FBU0MscUJBQXFCLEVBQUVDLGdCQUFnQixFQUFFQyxVQUFVLFFBQVEsZUFBZTtBQUNuRixTQUFTQyxvQkFBb0IsUUFBUSxlQUFlO0FBRXBELFNBQVNDLHFCQUFxQixRQUFRLFdBQVc7QUFDakQsU0FDRUMsU0FBUyxFQUNUQyxXQUFXLEVBQ1hDLGtCQUFrQixFQUNsQkMsZ0JBQWdCLEVBQ2hCQyxlQUFlLEVBQ2ZDLGdCQUFnQixRQUNYLFFBQVE7QUFFZixPQUFPLElBQU1DLFVBQVUsR0FBRyxTQUFiQSxVQUFVQSxDQUFJQyxLQUFnQjtFQUFBLE9BQUtBLEtBQUssQ0FBQ0MsT0FBTztBQUFBO0FBQzdELE9BQU8sSUFBTUMsYUFBYSxHQUFHLFNBQWhCQSxh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