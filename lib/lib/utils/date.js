// Copyright (c) 2017 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { round as _round, dropWhile as _dropWhile } from 'lodash';
import moment from 'moment-timezone';
import { toFloatPrecision } from './number';
var TODAY = 'Today';
var YESTERDAY = 'Yesterday';
export var STANDARD_DATE_FORMAT = 'YYYY-MM-DD';
export var STANDARD_TIME_FORMAT = 'HH:mm';
export var STANDARD_DATETIME_FORMAT = 'MMMM D YYYY, HH:mm:ss.SSS';
export var ONE_MILLISECOND = 1000;
export var ONE_SECOND = 1000 * ONE_MILLISECOND;
export var ONE_MINUTE = 60 * ONE_SECOND;
export var ONE_HOUR = 60 * ONE_MINUTE;
export var ONE_DAY = 24 * ONE_HOUR;
export var DEFAULT_MS_PRECISION = Math.log10(ONE_MILLISECOND);
var UNIT_STEPS = [{
  unit: 'd',
  microseconds: ONE_DAY,
  ofPrevious: 24
}, {
  unit: 'h',
  microseconds: ONE_HOUR,
  ofPrevious: 60
}, {
  unit: 'm',
  microseconds: ONE_MINUTE,
  ofPrevious: 60
}, {
  unit: 's',
  microseconds: ONE_SECOND,
  ofPrevious: 1000
}, {
  unit: 'ms',
  microseconds: ONE_MILLISECOND,
  ofPrevious: 1000
}, {
  unit: 'μs',
  microseconds: 1,
  ofPrevious: 1000
}];

/**
 * @param {number} timestamp
 * @param {number} initialTimestamp
 * @param {number} totalDuration
 * @returns {number} 0-100 percentage
 */
export function getPercentageOfDuration(duration, totalDuration) {
  return duration / totalDuration * 100;
}
var quantizeDuration = function quantizeDuration(duration, floatPrecision, conversionFactor) {
  return toFloatPrecision(duration / conversionFactor, floatPrecision) * conversionFactor;
};

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatDate(duration) {
  return moment(duration / ONE_MILLISECOND).format(STANDARD_DATE_FORMAT);
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatTime(duration) {
  return moment(duration / ONE_MILLISECOND).format(STANDARD_TIME_FORMAT);
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatDatetime(duration) {
  return moment(duration / ONE_MILLISECOND).format(STANDARD_DATETIME_FORMAT);
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in milliseconds
 */
export function formatMillisecondTime(duration) {
  var targetDuration = quantizeDuration(duration, DEFAULT_MS_PRECISION, ONE_MILLISECOND);
  return moment.duration(targetDuration / ONE_MILLISECOND).asMilliseconds() + "ms";
}

/**
 * @param {number} duration (in microseconds)
 * @returns {string} formatted, unit-labelled string with time in seconds
 */
export function formatSecondTime(duration) {
  var targetDuration = quantizeDuration(duration, DEFAULT_MS_PRECISION, ONE_SECOND);
  return moment.duration(targetDuration / ONE_MILLISECOND).asSeconds() + "s";
}

/**
 * Humanizes the duration for display.
 *
 * Example:
 * 5000ms => 5s
 * 1000μs => 1ms
 * 183840s => 2d 3h
 *
 * @param {number} duration (in microseconds)
 * @return {string} formatted duration
 */
export function formatDuration(duration) {
  // Drop all units that are too large except the last one
  var _dropWhile2 = _dropWhile(UNIT_STEPS, function (_ref, index) {
      var microseconds = _ref.microseconds;
      return index < UNIT_STEPS.length - 1 && microseconds > duration;
    }),
    primaryUnit = _dropWhile2[0],
    secondaryUnit = _dropWhile2[1];
  if (primaryUnit.ofPrevious === 1000) {
    // If the unit is decimal based, display as a decimal
    return "" + _round(duration / primaryUnit.microseconds, 2) + primaryUnit.unit;
  }
  var primaryValue = Math.floor(duration / primaryUnit.microseconds);
  var primaryUnitString = "" + primaryValue + primaryUnit.unit;
  var secondaryValue = Math.round(duration / secondaryUnit.microseconds % primaryUnit.ofPrevious);
  var secondaryUnitString = "" + secondaryValue + secondaryUnit.unit;
  return secondaryValue === 0 ? primaryUnitString : primaryUnitString + " " + secondaryUnitString;
}
export function formatRelativeDate(value, fullMonthName) {
  if (fullMonthName === void 0) {
    fullMonthName = false;
  }
  var m = moment.isMoment(value) ? value : moment(value);
  var monthFormat = fullMonthName ? 'MMMM' : 'MMM';
  var dt = new Date();
  if (dt.getFullYear() !== m.year()) {
    return m.format(monthFormat + " D, YYYY");
  }
  var mMonth = m.month();
  var mDate = m.date();
  var date = dt.getDate();
  if (mMonth === dt.getMonth() && mDate === date) {
    return TODAY;
  }
  dt.setDate(date - 1);
  if (mMonth === dt.getMonth() && mDate === dt.getDate()) {
    return YESTERDAY;
  }
  return m.format(monthFormat + " D");
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyb3VuZCIsIl9yb3VuZCIsImRyb3BXaGlsZSIsIl9kcm9wV2hpbGUiLCJtb21lbnQiLCJ0b0Zsb2F0UHJlY2lzaW9uIiwiVE9EQVkiLCJZRVNURVJEQVkiLCJTVEFOREFSRF9EQVRFX0ZPUk1BVCIsIlNUQU5EQVJEX1RJTUVfRk9STUFUIiwiU1RBTkRBUkRfREFURVRJTUVfRk9STUFUIiwiT05FX01JTExJU0VDT05EIiwiT05FX1NFQ09ORCIsIk9ORV9NSU5VVEUiLCJPTkVfSE9VUiIsIk9ORV9EQVkiLCJERUZBVUxUX01TX1BSRUNJU0lPTiIsIk1hdGgiLCJsb2cxMCIsIlVOSVRfU1RFUFMiLCJ1bml0IiwibWljcm9zZWNvbmRzIiwib2ZQcmV2aW91cyIsImdldFBlcmNlbnRhZ2VPZkR1cmF0aW9uIiwiZHVyYXRpb24iLCJ0b3RhbER1cmF0aW9uIiwicXVhbnRpemVEdXJhdGlvbiIsImZsb2F0UHJlY2lzaW9uIiwiY29udmVyc2lvbkZhY3RvciIsImZvcm1hdERhdGUiLCJmb3JtYXQiLCJmb3JtYXRUaW1lIiwiZm9ybWF0RGF0ZXRpbWUiLCJmb3JtYXRNaWxsaXNlY29uZFRpbWUiLCJ0YXJnZXREdXJhdGlvbiIsImFzTWlsbGlzZWNvbmRzIiwiZm9ybWF0U2Vjb25kVGltZSIsImFzU2Vjb25kcyIsImZvcm1hdER1cmF0aW9uIiwiX2Ryb3BXaGlsZTIiLCJfcmVmIiwiaW5kZXgiLCJsZW5ndGgiLCJwcmltYXJ5VW5pdCIsInNlY29uZGFyeVVuaXQiLCJwcmltYXJ5VmFsdWUiLCJmbG9vciIsInByaW1hcnlVbml0U3RyaW5nIiwic2Vjb25kYXJ5VmFsdWUiLCJzZWNvbmRhcnlVbml0U3RyaW5nIiwiZm9ybWF0UmVsYXRpdmVEYXRlIiwidmFsdWUiLCJmdWxsTW9udGhOYW1lIiwibSIsImlzTW9tZW50IiwibW9udGhGb3JtYXQiLCJkdCIsIkRhdGUiLCJnZXRGdWxsWWVhciIsInllYXIiLCJtTW9udGgiLCJtb250aCIsIm1EYXRlIiwiZGF0ZSIsImdldERhdGUiLCJnZXRNb250aCIsInNldERhdGUiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL3V0aWxzL2RhdGUudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxNyBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyByb3VuZCBhcyBfcm91bmQsIGRyb3BXaGlsZSBhcyBfZHJvcFdoaWxlIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcblxuaW1wb3J0IHsgdG9GbG9hdFByZWNpc2lvbiB9IGZyb20gJy4vbnVtYmVyJztcblxuY29uc3QgVE9EQVkgPSAnVG9kYXknO1xuY29uc3QgWUVTVEVSREFZID0gJ1llc3RlcmRheSc7XG5cbmV4cG9ydCBjb25zdCBTVEFOREFSRF9EQVRFX0ZPUk1BVCA9ICdZWVlZLU1NLUREJztcbmV4cG9ydCBjb25zdCBTVEFOREFSRF9USU1FX0ZPUk1BVCA9ICdISDptbSc7XG5leHBvcnQgY29uc3QgU1RBTkRBUkRfREFURVRJTUVfRk9STUFUID0gJ01NTU0gRCBZWVlZLCBISDptbTpzcy5TU1MnO1xuZXhwb3J0IGNvbnN0IE9ORV9NSUxMSVNFQ09ORCA9IDEwMDA7XG5leHBvcnQgY29uc3QgT05FX1NFQ09ORCA9IDEwMDAgKiBPTkVfTUlMTElTRUNPTkQ7XG5leHBvcnQgY29uc3QgT05FX01JTlVURSA9IDYwICogT05FX1NFQ09ORDtcbmV4cG9ydCBjb25zdCBPTkVfSE9VUiA9IDYwICogT05FX01JTlVURTtcbmV4cG9ydCBjb25zdCBPTkVfREFZID0gMjQgKiBPTkVfSE9VUjtcbmV4cG9ydCBjb25zdCBERUZBVUxUX01TX1BSRUNJU0lPTiA9IE1hdGgubG9nMTAoT05FX01JTExJU0VDT05EKTtcblxuY29uc3QgVU5JVF9TVEVQUzogQXJyYXk8eyB1bml0OiBzdHJpbmc7IG1pY3Jvc2Vjb25kczogbnVtYmVyOyBvZlByZXZpb3VzOiBudW1iZXIgfT4gPSBbXG4gIHsgdW5pdDogJ2QnLCBtaWNyb3NlY29uZHM6IE9ORV9EQVksIG9mUHJldmlvdXM6IDI0IH0sXG4gIHsgdW5pdDogJ2gnLCBtaWNyb3NlY29uZHM6IE9ORV9IT1VSLCBvZlByZXZpb3VzOiA2MCB9LFxuICB7IHVuaXQ6ICdtJywgbWljcm9zZWNvbmRzOiBPTkVfTUlOVVRFLCBvZlByZXZpb3VzOiA2MCB9LFxuICB7IHVuaXQ6ICdzJywgbWljcm9zZWNvbmRzOiBPTkVfU0VDT05ELCBvZlByZXZpb3VzOiAxMDAwIH0sXG4gIHsgdW5pdDogJ21zJywgbWljcm9zZWNvbmRzOiBPTkVfTUlMTElTRUNPTkQsIG9mUHJldmlvdXM6IDEwMDAgfSxcbiAgeyB1bml0OiAnzrxzJywgbWljcm9zZWNvbmRzOiAxLCBvZlByZXZpb3VzOiAxMDAwIH0sXG5dO1xuXG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lc3RhbXBcbiAqIEBwYXJhbSB7bnVtYmVyfSBpbml0aWFsVGltZXN0YW1wXG4gKiBAcGFyYW0ge251bWJlcn0gdG90YWxEdXJhdGlvblxuICogQHJldHVybnMge251bWJlcn0gMC0xMDAgcGVyY2VudGFnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGVyY2VudGFnZU9mRHVyYXRpb24oZHVyYXRpb246IG51bWJlciwgdG90YWxEdXJhdGlvbjogbnVtYmVyKSB7XG4gIHJldHVybiAoZHVyYXRpb24gLyB0b3RhbER1cmF0aW9uKSAqIDEwMDtcbn1cblxuY29uc3QgcXVhbnRpemVEdXJhdGlvbiA9IChkdXJhdGlvbjogbnVtYmVyLCBmbG9hdFByZWNpc2lvbjogbnVtYmVyLCBjb252ZXJzaW9uRmFjdG9yOiBudW1iZXIpID0+XG4gIHRvRmxvYXRQcmVjaXNpb24oZHVyYXRpb24gLyBjb252ZXJzaW9uRmFjdG9yLCBmbG9hdFByZWNpc2lvbikgKiBjb252ZXJzaW9uRmFjdG9yO1xuXG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSBkdXJhdGlvbiAoaW4gbWljcm9zZWNvbmRzKVxuICogQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkLCB1bml0LWxhYmVsbGVkIHN0cmluZyB3aXRoIHRpbWUgaW4gbWlsbGlzZWNvbmRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXREYXRlKGR1cmF0aW9uOiBudW1iZXIpIHtcbiAgcmV0dXJuIG1vbWVudChkdXJhdGlvbiAvIE9ORV9NSUxMSVNFQ09ORCkuZm9ybWF0KFNUQU5EQVJEX0RBVEVfRk9STUFUKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge251bWJlcn0gZHVyYXRpb24gKGluIG1pY3Jvc2Vjb25kcylcbiAqIEByZXR1cm5zIHtzdHJpbmd9IGZvcm1hdHRlZCwgdW5pdC1sYWJlbGxlZCBzdHJpbmcgd2l0aCB0aW1lIGluIG1pbGxpc2Vjb25kc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0VGltZShkdXJhdGlvbjogbnVtYmVyKSB7XG4gIHJldHVybiBtb21lbnQoZHVyYXRpb24gLyBPTkVfTUlMTElTRUNPTkQpLmZvcm1hdChTVEFOREFSRF9USU1FX0ZPUk1BVCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uIChpbiBtaWNyb3NlY29uZHMpXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBmb3JtYXR0ZWQsIHVuaXQtbGFiZWxsZWQgc3RyaW5nIHdpdGggdGltZSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERhdGV0aW1lKGR1cmF0aW9uOiBudW1iZXIpIHtcbiAgcmV0dXJuIG1vbWVudChkdXJhdGlvbiAvIE9ORV9NSUxMSVNFQ09ORCkuZm9ybWF0KFNUQU5EQVJEX0RBVEVUSU1FX0ZPUk1BVCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uIChpbiBtaWNyb3NlY29uZHMpXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBmb3JtYXR0ZWQsIHVuaXQtbGFiZWxsZWQgc3RyaW5nIHdpdGggdGltZSBpbiBtaWxsaXNlY29uZHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdE1pbGxpc2Vjb25kVGltZShkdXJhdGlvbjogbnVtYmVyKSB7XG4gIGNvbnN0IHRhcmdldER1cmF0aW9uID0gcXVhbnRpemVEdXJhdGlvbihkdXJhdGlvbiwgREVGQVVMVF9NU19QUkVDSVNJT04sIE9ORV9NSUxMSVNFQ09ORCk7XG4gIHJldHVybiBgJHttb21lbnQuZHVyYXRpb24odGFyZ2V0RHVyYXRpb24gLyBPTkVfTUlMTElTRUNPTkQpLmFzTWlsbGlzZWNvbmRzKCl9bXNgO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSBkdXJhdGlvbiAoaW4gbWljcm9zZWNvbmRzKVxuICogQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkLCB1bml0LWxhYmVsbGVkIHN0cmluZyB3aXRoIHRpbWUgaW4gc2Vjb25kc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0U2Vjb25kVGltZShkdXJhdGlvbjogbnVtYmVyKSB7XG4gIGNvbnN0IHRhcmdldER1cmF0aW9uID0gcXVhbnRpemVEdXJhdGlvbihkdXJhdGlvbiwgREVGQVVMVF9NU19QUkVDSVNJT04sIE9ORV9TRUNPTkQpO1xuICByZXR1cm4gYCR7bW9tZW50LmR1cmF0aW9uKHRhcmdldER1cmF0aW9uIC8gT05FX01JTExJU0VDT05EKS5hc1NlY29uZHMoKX1zYDtcbn1cblxuLyoqXG4gKiBIdW1hbml6ZXMgdGhlIGR1cmF0aW9uIGZvciBkaXNwbGF5LlxuICpcbiAqIEV4YW1wbGU6XG4gKiA1MDAwbXMgPT4gNXNcbiAqIDEwMDDOvHMgPT4gMW1zXG4gKiAxODM4NDBzID0+IDJkIDNoXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uIChpbiBtaWNyb3NlY29uZHMpXG4gKiBAcmV0dXJuIHtzdHJpbmd9IGZvcm1hdHRlZCBkdXJhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RHVyYXRpb24oZHVyYXRpb246IG51bWJlcik6IHN0cmluZyB7XG4gIC8vIERyb3AgYWxsIHVuaXRzIHRoYXQgYXJlIHRvbyBsYXJnZSBleGNlcHQgdGhlIGxhc3Qgb25lXG4gIGNvbnN0IFtwcmltYXJ5VW5pdCwgc2Vjb25kYXJ5VW5pdF0gPSBfZHJvcFdoaWxlKFxuICAgIFVOSVRfU1RFUFMsXG4gICAgKHsgbWljcm9zZWNvbmRzIH0sIGluZGV4KSA9PiBpbmRleCA8IFVOSVRfU1RFUFMubGVuZ3RoIC0gMSAmJiBtaWNyb3NlY29uZHMgPiBkdXJhdGlvblxuICApO1xuXG4gIGlmIChwcmltYXJ5VW5pdC5vZlByZXZpb3VzID09PSAxMDAwKSB7XG4gICAgLy8gSWYgdGhlIHVuaXQgaXMgZGVjaW1hbCBiYXNlZCwgZGlzcGxheSBhcyBhIGRlY2ltYWxcbiAgICByZXR1cm4gYCR7X3JvdW5kKGR1cmF0aW9uIC8gcHJpbWFyeVVuaXQubWljcm9zZWNvbmRzLCAyKX0ke3ByaW1hcnlVbml0LnVuaXR9YDtcbiAgfVxuXG4gIGNvbnN0IHByaW1hcnlWYWx1ZSA9IE1hdGguZmxvb3IoZHVyYXRpb24gLyBwcmltYXJ5VW5pdC5taWNyb3NlY29uZHMpO1xuICBjb25zdCBwcmltYXJ5VW5pdFN0cmluZyA9IGAke3ByaW1hcnlWYWx1ZX0ke3ByaW1hcnlVbml0LnVuaXR9YDtcbiAgY29uc3Qgc2Vjb25kYXJ5VmFsdWUgPSBNYXRoLnJvdW5kKChkdXJhdGlvbiAvIHNlY29uZGFyeVVuaXQubWljcm9zZWNvbmRzKSAlIHByaW1hcnlVbml0Lm9mUHJldmlvdXMpO1xuICBjb25zdCBzZWNvbmRhcnlVbml0U3RyaW5nID0gYCR7c2Vjb25kYXJ5VmFsdWV9JHtzZWNvbmRhcnlVbml0LnVuaXR9YDtcbiAgcmV0dXJuIHNlY29uZGFyeVZhbHVlID09PSAwID8gcHJpbWFyeVVuaXRTdHJpbmcgOiBgJHtwcmltYXJ5VW5pdFN0cmluZ30gJHtzZWNvbmRhcnlVbml0U3RyaW5nfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRSZWxhdGl2ZURhdGUodmFsdWU6IGFueSwgZnVsbE1vbnRoTmFtZSA9IGZhbHNlKSB7XG4gIGNvbnN0IG0gPSBtb21lbnQuaXNNb21lbnQodmFsdWUpID8gdmFsdWUgOiBtb21lbnQodmFsdWUpO1xuICBjb25zdCBtb250aEZvcm1hdCA9IGZ1bGxNb250aE5hbWUgPyAnTU1NTScgOiAnTU1NJztcbiAgY29uc3QgZHQgPSBuZXcgRGF0ZSgpO1xuICBpZiAoZHQuZ2V0RnVsbFllYXIoKSAhPT0gbS55ZWFyKCkpIHtcbiAgICByZXR1cm4gbS5mb3JtYXQoYCR7bW9udGhGb3JtYXR9IEQsIFlZWVlgKTtcbiAgfVxuICBjb25zdCBtTW9udGggPSBtLm1vbnRoKCk7XG4gIGNvbnN0IG1EYXRlID0gbS5kYXRlKCk7XG4gIGNvbnN0IGRhdGUgPSBkdC5nZXREYXRlKCk7XG4gIGlmIChtTW9udGggPT09IGR0LmdldE1vbnRoKCkgJiYgbURhdGUgPT09IGRhdGUpIHtcbiAgICByZXR1cm4gVE9EQVk7XG4gIH1cbiAgZHQuc2V0RGF0ZShkYXRlIC0gMSk7XG4gIGlmIChtTW9udGggPT09IGR0LmdldE1vbnRoKCkgJiYgbURhdGUgPT09IGR0LmdldERhdGUoKSkge1xuICAgIHJldHVybiBZRVNURVJEQVk7XG4gIH1cbiAgcmV0dXJuIG0uZm9ybWF0KGAke21vbnRoRm9ybWF0fSBEYCk7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVNBLEtBQUssSUFBSUMsTUFBTSxFQUFFQyxTQUFTLElBQUlDLFVBQVUsUUFBUSxRQUFRO0FBQ2pFLE9BQU9DLE1BQU0sTUFBTSxpQkFBaUI7QUFFcEMsU0FBU0MsZ0JBQWdCLFFBQVEsVUFBVTtBQUUzQyxJQUFNQyxLQUFLLEdBQUcsT0FBTztBQUNyQixJQUFNQyxTQUFTLEdBQUcsV0FBVztBQUU3QixPQUFPLElBQU1DLG9CQUFvQixHQUFHLFlBQVk7QUFDaEQsT0FBTyxJQUFNQyxvQkFBb0IsR0FBRyxPQUFPO0FBQzNDLE9BQU8sSUFBTUMsd0JBQXdCLEdBQUcsMkJBQTJCO0FBQ25FLE9BQU8sSUFBTUMsZUFBZSxHQUFHLElBQUk7QUFDbkMsT0FBTyxJQUFNQyxVQUFVLEdBQUcsSUFBSSxHQUFHRCxlQUFlO0FBQ2hELE9BQU8sSUFBTUUsVUFBVSxHQUFHLEVBQUUsR0FBR0QsVUFBVTtBQUN6QyxPQUFPLElBQU1FLFFBQVEsR0FBRyxFQUFFLEdBQUdELFVBQVU7QUFDdkMsT0FBTyxJQUFNRSxPQUFPLEdBQUcsRUFBRSxHQUFHRCxRQUFRO0FBQ3BDLE9BQU8sSUFBTUUsb0JBQW9CLEdBQUdDLElBQUksQ0FBQ0MsS0FBSyxDQUFDUCxlQUFlLENBQUM7QUFFL0QsSUFBTVEsVUFBNkUsR0FBRyxDQUNwRjtFQUFFQyxJQUFJLEVBQUUsR0FBRztFQUFFQyxZQUFZLEVBQUVOLE9BQU87RUFBRU8sVUFBVSxFQUFFO0FBQUcsQ0FBQyxF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