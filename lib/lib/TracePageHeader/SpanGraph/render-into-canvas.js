// Copyright (c) 2017 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// exported for tests
export var ITEM_ALPHA = 0.8;
export var MIN_ITEM_HEIGHT = 2;
export var MAX_TOTAL_HEIGHT = 200;
export var MIN_ITEM_WIDTH = 10;
export var MIN_TOTAL_HEIGHT = 60;
export var MAX_ITEM_HEIGHT = 6;
export default function renderIntoCanvas(canvas, items, totalValueWidth, getFillColor, bgColor) {
  var fillCache = new Map();
  var cHeight = items.length < MIN_TOTAL_HEIGHT ? MIN_TOTAL_HEIGHT : Math.min(items.length, MAX_TOTAL_HEIGHT);
  var cWidth = window.innerWidth * 2;
  // eslint-disable-next-line no-param-reassign
  canvas.width = cWidth;
  // eslint-disable-next-line no-param-reassign
  canvas.height = cHeight;
  var itemHeight = Math.min(MAX_ITEM_HEIGHT, Math.max(MIN_ITEM_HEIGHT, cHeight / items.length));
  var itemYChange = cHeight / items.length;
  var ctx = canvas.getContext('2d', {
    alpha: false
  });
  ctx.fillStyle = bgColor;
  ctx.fillRect(0, 0, cWidth, cHeight);
  for (var i = 0; i < items.length; i++) {
    var _items$i = items[i],
      valueWidth = _items$i.valueWidth,
      valueOffset = _items$i.valueOffset,
      serviceName = _items$i.serviceName;
    var x = valueOffset / totalValueWidth * cWidth;
    var width = valueWidth / totalValueWidth * cWidth;
    if (width < MIN_ITEM_WIDTH) {
      width = MIN_ITEM_WIDTH;
    }
    var fillStyle = fillCache.get(serviceName);
    if (!fillStyle) {
      fillStyle = "rgba(" + getFillColor(serviceName).concat(ITEM_ALPHA).join() + ")";
      fillCache.set(serviceName, fillStyle);
    }
    ctx.fillStyle = fillStyle;
    ctx.fillRect(x, i * itemYChange, width, itemHeight);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJVEVNX0FMUEhBIiwiTUlOX0lURU1fSEVJR0hUIiwiTUFYX1RPVEFMX0hFSUdIVCIsIk1JTl9JVEVNX1dJRFRIIiwiTUlOX1RPVEFMX0hFSUdIVCIsIk1BWF9JVEVNX0hFSUdIVCIsInJlbmRlckludG9DYW52YXMiLCJjYW52YXMiLCJpdGVtcyIsInRvdGFsVmFsdWVXaWR0aCIsImdldEZpbGxDb2xvciIsImJnQ29sb3IiLCJmaWxsQ2FjaGUiLCJNYXAiLCJjSGVpZ2h0IiwibGVuZ3RoIiwiTWF0aCIsIm1pbiIsImNXaWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJ3aWR0aCIsImhlaWdodCIsIml0ZW1IZWlnaHQiLCJtYXgiLCJpdGVtWUNoYW5nZSIsImN0eCIsImdldENvbnRleHQiLCJhbHBoYSIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwiaSIsIl9pdGVtcyRpIiwidmFsdWVXaWR0aCIsInZhbHVlT2Zmc2V0Iiwic2VydmljZU5hbWUiLCJ4IiwiZ2V0IiwiY29uY2F0Iiwiam9pbiIsInNldCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvVHJhY2VQYWdlSGVhZGVyL1NwYW5HcmFwaC9yZW5kZXItaW50by1jYW52YXMudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxNyBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBUTmlsIH0gZnJvbSAnLi4vLi4nO1xuXG4vLyBleHBvcnRlZCBmb3IgdGVzdHNcbmV4cG9ydCBjb25zdCBJVEVNX0FMUEhBID0gMC44O1xuZXhwb3J0IGNvbnN0IE1JTl9JVEVNX0hFSUdIVCA9IDI7XG5leHBvcnQgY29uc3QgTUFYX1RPVEFMX0hFSUdIVCA9IDIwMDtcbmV4cG9ydCBjb25zdCBNSU5fSVRFTV9XSURUSCA9IDEwO1xuZXhwb3J0IGNvbnN0IE1JTl9UT1RBTF9IRUlHSFQgPSA2MDtcbmV4cG9ydCBjb25zdCBNQVhfSVRFTV9IRUlHSFQgPSA2O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByZW5kZXJJbnRvQ2FudmFzKFxuICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LFxuICBpdGVtczogQXJyYXk8eyB2YWx1ZVdpZHRoOiBudW1iZXI7IHZhbHVlT2Zmc2V0OiBudW1iZXI7IHNlcnZpY2VOYW1lOiBzdHJpbmcgfT4sXG4gIHRvdGFsVmFsdWVXaWR0aDogbnVtYmVyLFxuICBnZXRGaWxsQ29sb3I6IChzZXJ2aWNlTmFtZTogc3RyaW5nKSA9PiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0sXG4gIGJnQ29sb3I6IHN0cmluZ1xuKSB7XG4gIGNvbnN0IGZpbGxDYWNoZTogTWFwPHN0cmluZywgc3RyaW5nIHwgVE5pbD4gPSBuZXcgTWFwKCk7XG4gIGNvbnN0IGNIZWlnaHQgPSBpdGVtcy5sZW5ndGggPCBNSU5fVE9UQUxfSEVJR0hUID8gTUlOX1RPVEFMX0hFSUdIVCA6IE1hdGgubWluKGl0ZW1zLmxlbmd0aCwgTUFYX1RPVEFMX0hFSUdIVCk7XG4gIGNvbnN0IGNXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoICogMjtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gIGNhbnZhcy53aWR0aCA9IGNXaWR0aDtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gIGNhbnZhcy5oZWlnaHQgPSBjSGVpZ2h0O1xuICBjb25zdCBpdGVtSGVpZ2h0ID0gTWF0aC5taW4oTUFYX0lURU1fSEVJR0hULCBNYXRoLm1heChNSU5fSVRFTV9IRUlHSFQsIGNIZWlnaHQgLyBpdGVtcy5sZW5ndGgpKTtcbiAgY29uc3QgaXRlbVlDaGFuZ2UgPSBjSGVpZ2h0IC8gaXRlbXMubGVuZ3RoO1xuXG4gIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcsIHsgYWxwaGE6IGZhbHNlIH0pIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcbiAgY3R4LmZpbGxTdHlsZSA9IGJnQ29sb3I7XG4gIGN0eC5maWxsUmVjdCgwLCAwLCBjV2lkdGgsIGNIZWlnaHQpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeyB2YWx1ZVdpZHRoLCB2YWx1ZU9mZnNldCwgc2VydmljZU5hbWUgfSA9IGl0ZW1zW2ldO1xuICAgIGNvbnN0IHggPSAodmFsdWVPZmZzZXQgLyB0b3RhbFZhbHVlV2lkdGgpICogY1dpZHRoO1xuICAgIGxldCB3aWR0aCA9ICh2YWx1ZVdpZHRoIC8gdG90YWxWYWx1ZVdpZHRoKSAqIGNXaWR0aDtcbiAgICBpZiAod2lkdGggPCBNSU5fSVRFTV9XSURUSCkge1xuICAgICAgd2lkdGggPSBNSU5fSVRFTV9XSURUSDtcbiAgICB9XG4gICAgbGV0IGZpbGxTdHlsZSA9IGZpbGxDYWNoZS5nZXQoc2VydmljZU5hbWUpO1xuICAgIGlmICghZmlsbFN0eWxlKSB7XG4gICAgICBmaWxsU3R5bGUgPSBgcmdiYSgke2dldEZpbGxDb2xvcihzZXJ2aWNlTmFtZSkuY29uY2F0KElURU1fQUxQSEEpLmpvaW4oKX0pYDtcbiAgICAgIGZpbGxDYWNoZS5zZXQoc2VydmljZU5hbWUsIGZpbGxTdHlsZSk7XG4gICAgfVxuICAgIGN0eC5maWxsU3R5bGUgPSBmaWxsU3R5bGU7XG4gICAgY3R4LmZpbGxSZWN0KHgsIGkgKiBpdGVtWUNoYW5nZSwgd2lkdGgsIGl0ZW1IZWlnaHQpO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUlBO0FBQ0EsT0FBTyxJQUFNQSxVQUFVLEdBQUcsR0FBRztBQUM3QixPQUFPLElBQU1DLGVBQWUsR0FBRyxDQUFDO0FBQ2hDLE9BQU8sSUFBTUMsZ0JBQWdCLEdBQUcsR0FBRztBQUNuQyxPQUFPLElBQU1DLGNBQWMsR0FBRyxFQUFFO0FBQ2hDLE9BQU8sSUFBTUMsZ0JBQWdCLEdBQUcsRUFBRTtBQUNsQyxPQUFPLElBQU1DLGVBQWUsR0FBRyxDQUFDO0FBRWhDLGVBQWUsU0FBU0MsZ0JBQWdCQSxDQUN0Q0MsTUFBeUIsRUFDekJDLEtBQThFLEVBQzlFQyxlQUF1QixFQUN2QkMsWUFBK0QsRUFDL0RDLE9BQWUsRUFDZjtFQUNBLElBQU1DLFNBQXFDLEdBQUcsSUFBSUMsR0FBRyxDQUFDLENBQUM7RUFDdkQsSUFBTUMsT0FBTyxHQUFHTixLQUFLLENBQUNPLE1BQU0sR0FBR1gsZ0JBQWdCLEdBQUdBLGdCQUFnQixHQUFHWSxJQUFJLENBQUNDLEdBQUcsQ0FBQ1QsS0FBSyxDQUFDTyxNQUFNLEVBQUViLGdCQUFnQixDQUFDO0VBQzdHLElBQU1nQixNQUFNLEdBQUdDLE1BQU0sQ0FBQ0MsVUFBVSxHQUFHLENBQUM7RUFDcEM7RUFDQWIsTUFBTSxDQUFDYyxLQUFLLEdBQUdILE1BQU07RUFDckI7RUFDQVgsTUFBTSxDQUFDZSxNQUFNLEdBQUdSLE9BQU87RUFDdkIsSUFBTVMsVUFBVSxHQUFHUCxJQUFJLENBQUNDLEdBQUcsQ0FBQ1osZUFBZSxFQUFFVyxJQUFJLENBQUNRLEdBQUcsQ0FBQ3ZCLGVBQWUsRUFBRWEsT0FBTyxHQUFHTixLQUFLLENBQUNPLE1BQU0sQ0FBQyxDQUFDO0VBQy9GLElBQU1VLFdBQVcsR0FBR1gsT0FBTyxHQUFHTixLQUFLLENBQUNPLE1BQU07RUFFMUMsSUFBTVcsR0FBRyxHQUFHbkIsTUFBTSxDQUFDb0IsVUFBVSxDQUFDLElBQUksRUFBRTtJQUFFQyxLQUFLLEVBQUU7RUFBTSxDQUFDLENBQTZCO0VBQ2pGRixHQUFHLENBQUNHLFNBQVMsR0FBR2xCLE9BQU87RUFDdkJlLEdBQUcsQ0FBQ0ksUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUVaLE1BQU0sRUFBRUosT0FBTyxDQUFDO0VBQ25DLEtBQUssSUFBSWlCLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR3ZCLEtBQUssQ0FBQ08sTUFBTSxFQUFFZ0IsQ0FBQyxFQUFFLEVBQUU7SUFDckMsSUFBQUMsUUFBQSxHQUFpRHhCLEtBQUssQ0FBQ3VCLENBQUMsQ0FBQztNQUFqREUsVUFBVSxHQUFBRCxRQUFBLENBQVZDLFVBQVU7TUFBRUMsV0FBVyxHQUFBRixRQUFBLENBQVhFLFdBQVc7TUFBRUMsV0FBVyxHQUFBSCxRQUFBLENBQVhHLFdBQVc7SUFDNUMsSUFBTUMsQ0FBQyxHQUFJRixXQUFXLEdBQUd6QixlQUFlLEdBQUlTLE1BQU07SUFDbEQsSUFBSUcsS0FBSyxHQUFJWSxVQUFVLEdBQUd4QixlQUFlLEdBQUlTLE1BQU07SUFDbkQsSUFBSUcsS0FBSyxHQUFHbEIsY0FBYyxFQUFFO01BQzFCa0IsS0FBSyxHQUFHbEIsY0FBYztJQUN4QjtJQUNBLElBQUkwQixTQUFTLEdBQUdqQixTQUFTLENBQUN5QixHQUFHLENBQUNGLFdBQVcsQ0FBQztJQUMxQyxJQUFJLENBQUNOLFNBQVMsRUFBRTtNQUNkQSxTQUFTLGFBQVduQixZQUFZLENBQUN5QixXQUFXLENBQUMsQ0FBQ0csTUFBTSxDQUFDdEMsVUFBVSxDQUFDLENBQUN1QyxJQUFJLENBQUMsQ0FBQyxNQUFHO01BQzFFM0IsU0FBUyxDQUFDNEIsR0FBRyxDQUFDTCxXQUFXLEVBQUVOLFNBQVMsQ0FBQztJQUN2QztJQUNBSCxHQUFHLENBQUNHLFNBQVMsR0FBR0EsU0FBUztJQUN6QkgsR0FBRyxDQUFDSSxRQUFRLENBQUNNLENBQUMsRUFBRUwsQ0FBQyxHQUFHTixXQUFXLEVBQUVKLEtBQUssRUFBRUUsVUFBVSxDQUFDO0VBQ3JEO0FBQ0YiLCJpZ25vcmVMaXN0IjpbXX0=