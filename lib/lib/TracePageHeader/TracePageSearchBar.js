import _taggedTemplateLiteralLoose from "@babel/runtime/helpers/taggedTemplateLiteralLoose";
var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6;
// Copyright (c) 2018 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { css } from '@emotion/css';
import cx from 'classnames';
import React, { memo } from 'react';
import { config, reportInteraction } from '@grafana/runtime';
import { Button, useStyles2 } from '@grafana/ui';
import UiFindInput from '../common/UiFindInput';
import { ubFlexAuto, ubJustifyEnd } from '../uberUtilityStyles';

// eslint-disable-next-line no-duplicate-imports
import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
export var getStyles = function getStyles(theme) {
  return {
    TracePageSearchBar: css(_templateObject || (_templateObject = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBar;\n      float: right;\n      position: absolute;\n      top: 0;\n      right: 0;\n      z-index: ", ";\n      background: ", ";\n      margin-bottom: -48px;\n      padding: 8px;\n      margin-right: 2px;\n      border-radius: 4px;\n      box-shadow: ", ";\n    "])), theme.zIndex.navbarFixed, theme.colors.background.primary, theme.shadows.z2),
    TracePageSearchBarBar: css(_templateObject2 || (_templateObject2 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarBar;\n      max-width: 20rem;\n      transition: max-width 0.5s;\n      &:focus-within {\n        max-width: 100%;\n      }\n    "]))),
    TracePageSearchBarSuffix: css(_templateObject3 || (_templateObject3 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarSuffix;\n      opacity: 0.6;\n    "]))),
    TracePageSearchBarBtn: css(_templateObject4 || (_templateObject4 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarBtn;\n      transition: 0.2s;\n      margin-left: 8px;\n    "]))),
    TracePageSearchBarBtnDisabled: css(_templateObject5 || (_templateObject5 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarBtnDisabled;\n      opacity: 0.5;\n    "]))),
    TracePageSearchBarLocateBtn: css(_templateObject6 || (_templateObject6 = _taggedTemplateLiteralLoose(["\n      label: TracePageSearchBarLocateBtn;\n      padding: 1px 8px 4px;\n    "])))
  };
};
export default /*#__PURE__*/memo(function TracePageSearchBar(props) {
  var _cx;
  var navigable = props.navigable,
    setSearch = props.setSearch,
    searchValue = props.searchValue,
    searchBarSuffix = props.searchBarSuffix,
    spanFindMatches = props.spanFindMatches,
    focusedSpanIdForSearch = props.focusedSpanIdForSearch,
    setSearchBarSuffix = props.setSearchBarSuffix,
    setFocusedSpanIdForSearch = props.setFocusedSpanIdForSearch,
    datasourceType = props.datasourceType;
  var styles = useStyles2(getStyles);
  var suffix = searchValue ? /*#__PURE__*/_jsx("span", {
    className: styles.TracePageSearchBarSuffix,
    "aria-label": "Search bar suffix",
    children: searchBarSuffix
  }) : null;
  var btnClass = cx(styles.TracePageSearchBarBtn, (_cx = {}, _cx[styles.TracePageSearchBarBtnDisabled] = !searchValue, _cx));
  var uiFindInputInputProps = {
    className: cx(styles.TracePageSearchBarBar, ubFlexAuto),
    name: 'search',
    suffix: suffix
  };
  var setTraceSearch = function setTraceSearch(value) {
    setFocusedSpanIdForSearch('');
    setSearchBarSuffix('');
    setSearch(value);
  };
  var nextResult = function nextResult() {
    reportInteraction('grafana_traces_trace_view_find_next_prev_clicked', {
      datasourceType: datasourceType,
      grafana_version: config.buildInfo.version,
      direction: 'next'
    });
    var spanMatches = Array.from(spanFindMatches);
    var prevMatchedIndex = spanMatches.indexOf(focusedSpanIdForSearch) ? spanMatches.indexOf(focusedSpanIdForSearch) : 0;

    // new query || at end, go to start
    if (prevMatchedIndex === -1 || prevMatchedIndex === spanMatches.length - 1) {
      setFocusedSpanIdForSearch(spanMatches[0]);
      setSearchBarSuffix(getSearchBarSuffix(1));
      return;
    }

    // get next
    setFocusedSpanIdForSearch(spanMatches[prevMatchedIndex + 1]);
    setSearchBarSuffix(getSearchBarSuffix(prevMatchedIndex + 2));
  };
  var prevResult = function prevResult() {
    reportInteraction('grafana_traces_trace_view_find_next_prev_clicked', {
      datasourceType: datasourceType,
      grafana_version: config.buildInfo.version,
      direction: 'prev'
    });
    var spanMatches = Array.from(spanFindMatches);
    var prevMatchedIndex = spanMatches.indexOf(focusedSpanIdForSearch) ? spanMatches.indexOf(focusedSpanIdForSearch) : 0;

    // new query || at start, go to end
    if (prevMatchedIndex === -1 || prevMatchedIndex === 0) {
      setFocusedSpanIdForSearch(spanMatches[spanMatches.length - 1]);
      setSearchBarSuffix(getSearchBarSuffix(spanMatches.length));
      return;
    }

    // get prev
    setFocusedSpanIdForSearch(spanMatches[prevMatchedIndex - 1]);
    setSearchBarSuffix(getSearchBarSuffix(prevMatchedIndex));
  };
  var getSearchBarSuffix = function getSearchBarSuffix(index) {
    if (spanFindMatches != null && spanFindMatches.size && (spanFindMatches == null ? void 0 : spanFindMatches.size) > 0) {
      return index + ' of ' + (spanFindMatches == null ? void 0 : spanFindMatches.size);
    }
    return '';
  };
  return /*#__PURE__*/_jsx("div", {
    className: styles.TracePageSearchBar,
    children: /*#__PURE__*/_jsxs("span", {
      className: ubJustifyEnd,
      style: {
        display: 'flex'
      },
      children: [/*#__PURE__*/_jsx(UiFindInput, {
        onChange: setTraceSearch,
        value: searchValue,
        inputProps: uiFindInputInputProps,
        allowClear: true
      }), /*#__PURE__*/_jsx(_Fragment, {
        children: navigable && /*#__PURE__*/_jsxs(_Fragment, {
          children: [/*#__PURE__*/_jsx(Button, {
            className: btnClass,
            variant: "secondary",
            disabled: !searchValue,
            type: "button",
            icon: "arrow-down",
            "aria-label": "Next results button",
            onClick: nextResult
          }), /*#__PURE__*/_jsx(Button, {
            className: btnClass,
            variant: "secondary",
            disabled: !searchValue,
            type: "button",
            icon: "arrow-up",
            "aria-label": "Prev results button",
            onClick: prevResult
          })]
        })
      })]
    })
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjc3MiLCJjeCIsIlJlYWN0IiwibWVtbyIsImNvbmZpZyIsInJlcG9ydEludGVyYWN0aW9uIiwiQnV0dG9uIiwidXNlU3R5bGVzMiIsIlVpRmluZElucHV0IiwidWJGbGV4QXV0byIsInViSnVzdGlmeUVuZCIsImpzeCIsIl9qc3giLCJGcmFnbWVudCIsIl9GcmFnbWVudCIsImpzeHMiLCJfanN4cyIsImdldFN0eWxlcyIsInRoZW1lIiwiVHJhY2VQYWdlU2VhcmNoQmFyIiwiX3RlbXBsYXRlT2JqZWN0IiwiX3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbExvb3NlIiwiekluZGV4IiwibmF2YmFyRml4ZWQiLCJjb2xvcnMiLCJiYWNrZ3JvdW5kIiwicHJpbWFyeSIsInNoYWRvd3MiLCJ6MiIsIlRyYWNlUGFnZVNlYXJjaEJhckJhciIsIl90ZW1wbGF0ZU9iamVjdDIiLCJUcmFjZVBhZ2VTZWFyY2hCYXJTdWZmaXgiLCJfdGVtcGxhdGVPYmplY3QzIiwiVHJhY2VQYWdlU2VhcmNoQmFyQnRuIiwiX3RlbXBsYXRlT2JqZWN0NCIsIlRyYWNlUGFnZVNlYXJjaEJhckJ0bkRpc2FibGVkIiwiX3RlbXBsYXRlT2JqZWN0NSIsIlRyYWNlUGFnZVNlYXJjaEJhckxvY2F0ZUJ0biIsIl90ZW1wbGF0ZU9iamVjdDYiLCJwcm9wcyIsIl9jeCIsIm5hdmlnYWJsZSIsInNldFNlYXJjaCIsInNlYXJjaFZhbHVlIiwic2VhcmNoQmFyU3VmZml4Iiwic3BhbkZpbmRNYXRjaGVzIiwiZm9jdXNlZFNwYW5JZEZvclNlYXJjaCIsInNldFNlYXJjaEJhclN1ZmZpeCIsInNldEZvY3VzZWRTcGFuSWRGb3JTZWFyY2giLCJkYXRhc291cmNlVHlwZSIsInN0eWxlcyIsInN1ZmZpeCIsImNsYXNzTmFtZSIsImNoaWxkcmVuIiwiYnRuQ2xhc3MiLCJ1aUZpbmRJbnB1dElucHV0UHJvcHMiLCJuYW1lIiwic2V0VHJhY2VTZWFyY2giLCJ2YWx1ZSIsIm5leHRSZXN1bHQiLCJncmFmYW5hX3ZlcnNpb24iLCJidWlsZEluZm8iLCJ2ZXJzaW9uIiwiZGlyZWN0aW9uIiwic3Bhbk1hdGNoZXMiLCJBcnJheSIsImZyb20iLCJwcmV2TWF0Y2hlZEluZGV4IiwiaW5kZXhPZiIsImxlbmd0aCIsImdldFNlYXJjaEJhclN1ZmZpeCIsInByZXZSZXN1bHQiLCJpbmRleCIsInNpemUiLCJzdHlsZSIsImRpc3BsYXkiLCJvbkNoYW5nZSIsImlucHV0UHJvcHMiLCJhbGxvd0NsZWFyIiwidmFyaWFudCIsImRpc2FibGVkIiwidHlwZSIsImljb24iLCJvbkNsaWNrIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9UcmFjZVBhZ2VIZWFkZXIvVHJhY2VQYWdlU2VhcmNoQmFyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMTggVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4vLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgY3NzIH0gZnJvbSAnQGVtb3Rpb24vY3NzJztcbmltcG9ydCBjeCBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBSZWFjdCwgeyBtZW1vLCBEaXNwYXRjaCwgU2V0U3RhdGVBY3Rpb24gfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7IEdyYWZhbmFUaGVtZTIgfSBmcm9tICdAZ3JhZmFuYS9kYXRhJztcbmltcG9ydCB7IGNvbmZpZywgcmVwb3J0SW50ZXJhY3Rpb24gfSBmcm9tICdAZ3JhZmFuYS9ydW50aW1lJztcbmltcG9ydCB7IEJ1dHRvbiwgdXNlU3R5bGVzMiB9IGZyb20gJ0BncmFmYW5hL3VpJztcblxuaW1wb3J0IFVpRmluZElucHV0IGZyb20gJy4uL2NvbW1vbi9VaUZpbmRJbnB1dCc7XG5pbXBvcnQgeyB1YkZsZXhBdXRvLCB1Ykp1c3RpZnlFbmQgfSBmcm9tICcuLi91YmVyVXRpbGl0eVN0eWxlcyc7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1kdXBsaWNhdGUtaW1wb3J0c1xuXG5leHBvcnQgY29uc3QgZ2V0U3R5bGVzID0gKHRoZW1lOiBHcmFmYW5hVGhlbWUyKSA9PiB7XG4gIHJldHVybiB7XG4gICAgVHJhY2VQYWdlU2VhcmNoQmFyOiBjc3NgXG4gICAgICBsYWJlbDogVHJhY2VQYWdlU2VhcmNoQmFyO1xuICAgICAgZmxvYXQ6IHJpZ2h0O1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgdG9wOiAwO1xuICAgICAgcmlnaHQ6IDA7XG4gICAgICB6LWluZGV4OiAke3RoZW1lLnpJbmRleC5uYXZiYXJGaXhlZH07XG4gICAgICBiYWNrZ3JvdW5kOiAke3RoZW1lLmNvbG9ycy5iYWNrZ3JvdW5kLnByaW1hcnl9O1xuICAgICAgbWFyZ2luLWJvdHRvbTogLTQ4cHg7XG4gICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICBtYXJnaW4tcmlnaHQ6IDJweDtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgIGJveC1zaGFkb3c6ICR7dGhlbWUuc2hhZG93cy56Mn07XG4gICAgYCxcbiAgICBUcmFjZVBhZ2VTZWFyY2hCYXJCYXI6IGNzc2BcbiAgICAgIGxhYmVsOiBUcmFjZVBhZ2VTZWFyY2hCYXJCYXI7XG4gICAgICBtYXgtd2lkdGg6IDIwcmVtO1xuICAgICAgdHJhbnNpdGlvbjogbWF4LXdpZHRoIDAuNXM7XG4gICAgICAmOmZvY3VzLXdpdGhpbiB7XG4gICAgICAgIG1heC13aWR0aDogMTAwJTtcbiAgICAgIH1cbiAgICBgLFxuICAgIFRyYWNlUGFnZVNlYXJjaEJhclN1ZmZpeDogY3NzYFxuICAgICAgbGFiZWw6IFRyYWNlUGFnZVNlYXJjaEJhclN1ZmZpeDtcbiAgICAgIG9wYWNpdHk6IDAuNjtcbiAgICBgLFxuICAgIFRyYWNlUGFnZVNlYXJjaEJhckJ0bjogY3NzYFxuICAgICAgbGFiZWw6IFRyYWNlUGFnZVNlYXJjaEJhckJ0bjtcbiAgICAgIHRyYW5zaXRpb246IDAuMnM7XG4gICAgICBtYXJnaW4tbGVmdDogOHB4O1xuICAgIGAsXG4gICAgVHJhY2VQYWdlU2VhcmNoQmFyQnRuRGlzYWJsZWQ6IGNzc2BcbiAgICAgIGxhYmVsOiBUcmFjZVBhZ2VTZWFyY2hCYXJCdG5EaXNhYmxlZDtcbiAgICAgIG9wYWNpdHk6IDAuNTtcbiAgICBgLFxuICAgIFRyYWNlUGFnZVNlYXJjaEJhckxvY2F0ZUJ0bjogY3NzYFxuICAgICAgbGFiZWw6IFRyYWNlUGFnZVNlYXJjaEJhckxvY2F0ZUJ0bjtcbiAgICAgIHBhZGRpbmc6IDFweCA4cHggNHB4O1xuICAgIGAsXG4gIH07XG59O1xuXG5leHBvcnQgdHlwZSBUcmFjZVBhZ2VTZWFyY2hCYXJQcm9wcyA9IHtcbiAgbmF2aWdhYmxlOiBib29sZWFuO1xuICBzZWFyY2hWYWx1ZTogc3RyaW5nO1xuICBzZXRTZWFyY2g6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkO1xuICBzZWFyY2hCYXJTdWZmaXg6IHN0cmluZztcbiAgc3BhbkZpbmRNYXRjaGVzOiBTZXQ8c3RyaW5nPiB8IHVuZGVmaW5lZDtcbiAgZm9jdXNlZFNwYW5JZEZvclNlYXJjaDogc3RyaW5nO1xuICBzZXRTZWFyY2hCYXJTdWZmaXg6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPHN0cmluZz4+O1xuICBzZXRGb2N1c2VkU3BhbklkRm9yU2VhcmNoOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxzdHJpbmc+PjtcbiAgZGF0YXNvdXJjZVR5cGU6IHN0cmluZztcbn07XG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oZnVuY3Rpb24gVHJhY2VQYWdlU2VhcmNoQmFyKHByb3BzOiBUcmFjZVBhZ2VTZWFyY2hCYXJQcm9wcykge1xuICBjb25zdCB7XG4gICAgbmF2aWdhYmxlLFxuICAgIHNldFNlYXJjaCxcbiAgICBzZWFyY2hWYWx1ZSxcbiAgICBzZWFyY2hCYXJTdWZmaXgsXG4gICAgc3BhbkZpbmRNYXRjaGVzLFxuICAgIGZvY3VzZWRTcGFuSWRGb3JTZWFyY2gsXG4gICAgc2V0U2VhcmNoQmFyU3VmZml4LFxuICAgIHNldEZvY3VzZWRTcGFuSWRGb3JTZWFyY2gsXG4gICAgZGF0YXNvdXJjZVR5cGUsXG4gIH0gPSBwcm9wcztcbiAgY29uc3Qgc3R5bGVzID0gdXNlU3R5bGVzMihnZXRTdHlsZXMpO1xuXG4gIGNvbnN0IHN1ZmZpeCA9IHNlYXJjaFZhbHVlID8gKFxuICAgIDxzcGFuIGNsYXNzTmFtZT17c3R5bGVzLlRyYWNlUGFnZVNlYXJjaEJhclN1ZmZpeH0gYXJpYS1sYWJlbD1cIlNlYXJjaCBiYXIgc3VmZml4XCI+XG4gICAgICB7c2VhcmNoQmFyU3VmZml4fVxuICAgIDwvc3Bhbj5cbiAgKSA6IG51bGw7XG5cbiAgY29uc3QgYnRuQ2xhc3MgPSBjeChzdHlsZXMuVHJhY2VQYWdlU2VhcmNoQmFyQnRuLCB7IFtzdHlsZXMuVHJhY2VQYWdlU2VhcmNoQmFyQnRuRGlzYWJsZWRdOiAhc2VhcmNoVmFsdWUgfSk7XG4gIGNvbnN0IHVpRmluZElucHV0SW5wdXRQcm9wcyA9IHtcbiAgICBjbGFzc05hbWU6IGN4KHN0eWxlcy5UcmFjZVBhZ2VTZWFyY2hCYXJCYXIsIHViRmxleEF1dG8pLFxuICAgIG5hbWU6ICdzZWFyY2gnLFxuICAgIHN1ZmZpeCxcbiAgfTtcblxuICBjb25zdCBzZXRUcmFjZVNlYXJjaCA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgc2V0Rm9jdXNlZFNwYW5JZEZvclNlYXJjaCgnJyk7XG4gICAgc2V0U2VhcmNoQmFyU3VmZml4KCcnKTtcbiAgICBzZXRTZWFyY2godmFsdWUpO1xuICB9O1xuXG4gIGNvbnN0IG5leHRSZXN1bHQgPSAoKSA9PiB7XG4gICAgcmVwb3J0SW50ZXJhY3Rpb24oJ2dyYWZhbmFfdHJhY2VzX3RyYWNlX3ZpZXdfZmluZF9uZXh0X3ByZXZfY2xpY2tlZCcsIHtcbiAgICAgIGRhdGFzb3VyY2VUeXBlOiBkYXRhc291cmNlVHlwZSxcbiAgICAgIGdyYWZhbmFfdmVyc2lvbjogY29uZmlnLmJ1aWxkSW5mby52ZXJzaW9uLFxuICAgICAgZGlyZWN0aW9uOiAnbmV4dCcsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzcGFuTWF0Y2hlcyA9IEFycmF5LmZyb20oc3BhbkZpbmRNYXRjaGVzISk7XG4gICAgY29uc3QgcHJldk1hdGNoZWRJbmRleCA9IHNwYW5NYXRjaGVzLmluZGV4T2YoZm9jdXNlZFNwYW5JZEZvclNlYXJjaClcbiAgICAgID8gc3Bhbk1hdGNoZXMuaW5kZXhPZihmb2N1c2VkU3BhbklkRm9yU2VhcmNoKVxuICAgICAgOiAwO1xuXG4gICAgLy8gbmV3IHF1ZXJ5IHx8IGF0IGVuZCwgZ28gdG8gc3RhcnRcbiAgICBpZiAocHJldk1hdGNoZWRJbmRleCA9PT0gLTEgfHwgcHJldk1hdGNoZWRJbmRleCA9PT0gc3Bhbk1hdGNoZXMubGVuZ3RoIC0gMSkge1xuICAgICAgc2V0Rm9jdXNlZFNwYW5JZEZvclNlYXJjaChzcGFuTWF0Y2hlc1swXSk7XG4gICAgICBzZXRTZWFyY2hCYXJTdWZmaXgoZ2V0U2VhcmNoQmFyU3VmZml4KDEpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBnZXQgbmV4dFxuICAgIHNldEZvY3VzZWRTcGFuSWRGb3JTZWFyY2goc3Bhbk1hdGNoZXNbcHJldk1hdGNoZWRJbmRleCArIDFdKTtcbiAgICBzZXRTZWFyY2hCYXJTdWZmaXgoZ2V0U2VhcmNoQmFyU3VmZml4KHByZXZNYXRjaGVkSW5kZXggKyAyKSk7XG4gIH07XG5cbiAgY29uc3QgcHJldlJlc3VsdCA9ICgpID0+IHtcbiAgICByZXBvcnRJbnRlcmFjdGlvbignZ3JhZmFuYV90cmFjZXNfdHJhY2Vfdmlld19maW5kX25leHRfcHJldl9jbGlja2VkJywge1xuICAgICAgZGF0YXNvdXJjZVR5cGU6IGRhdGFzb3VyY2VUeXBlLFxuICAgICAgZ3JhZmFuYV92ZXJzaW9uOiBjb25maWcuYnVpbGRJbmZvLnZlcnNpb24sXG4gICAgICBkaXJlY3Rpb246ICdwcmV2JyxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNwYW5NYXRjaGVzID0gQXJyYXkuZnJvbShzcGFuRmluZE1hdGNoZXMhKTtcbiAgICBjb25zdCBwcmV2TWF0Y2hlZEluZGV4ID0gc3Bhbk1hdGNoZXMuaW5kZXhPZihmb2N1c2VkU3BhbklkRm9yU2VhcmNoKVxuICAgICAgPyBzcGFuTWF0Y2hlcy5pbmRleE9mKGZvY3VzZWRTcGFuSWRGb3JTZWFyY2gpXG4gICAgICA6IDA7XG5cbiAgICAvLyBuZXcgcXVlcnkgfHwgYXQgc3RhcnQsIGdvIHRvIGVuZFxuICAgIGlmIChwcmV2TWF0Y2hlZEluZGV4ID09PSAtMSB8fCBwcmV2TWF0Y2hlZEluZGV4ID09PSAwKSB7XG4gICAgICBzZXRGb2N1c2VkU3BhbklkRm9yU2VhcmNoKHNwYW5NYXRjaGVzW3NwYW5NYXRjaGVzLmxlbmd0aCAtIDFdKTtcbiAgICAgIHNldFNlYXJjaEJhclN1ZmZpeChnZXRTZWFyY2hCYXJTdWZmaXgoc3Bhbk1hdGNoZXMubGVuZ3RoKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gZ2V0IHByZXZcbiAgICBzZXRGb2N1c2VkU3BhbklkRm9yU2VhcmNoKHNwYW5NYXRjaGVzW3ByZXZNYXRjaGVkSW5kZXggLSAxXSk7XG4gICAgc2V0U2VhcmNoQmFyU3VmZml4KGdldFNlYXJjaEJhclN1ZmZpeChwcmV2TWF0Y2hlZEluZGV4KSk7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2VhcmNoQmFyU3VmZml4ID0gKGluZGV4OiBudW1iZXIpOiBzdHJpbmcgPT4ge1xuICAgIGlmIChzcGFuRmluZE1hdGNoZXM/LnNpemUgJiYgc3BhbkZpbmRNYXRjaGVzPy5zaXplID4gMCkge1xuICAgICAgcmV0dXJuIGluZGV4ICsgJyBvZiAnICsgc3BhbkZpbmRNYXRjaGVzPy5zaXplO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH07XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLlRyYWNlUGFnZVNlYXJjaEJhcn0+XG4gICAgICA8c3BhbiBjbGFzc05hbWU9e3ViSnVzdGlmeUVuZH0gc3R5bGU9e3sgZGlzcGxheTogJ2ZsZXgnIH19PlxuICAgICAgICA8VWlGaW5kSW5wdXRcbiAgICAgICAgICBvbkNoYW5nZT17c2V0VHJhY2VTZWFyY2h9XG4gICAgICAgICAgdmFsdWU9e3NlYXJjaFZhbHVlfVxuICAgICAgICAgIGlucHV0UHJvcHM9e3VpRmluZElucHV0SW5wdXRQcm9wc31cbiAgICAgICAgICBhbGxvd0NsZWFyPXt0cnVlfVxuICAgICAgICAvPlxuICAgICAgICA8PlxuICAgICAgICAgIHtuYXZpZ2FibGUgJiYgKFxuICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YnRuQ2xhc3N9XG4gICAgICAgICAgICAgICAgdmFyaWFudD1cInNlY29uZGFyeVwiXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9eyFzZWFyY2hWYWx1ZX1cbiAgICAgICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBpY29uPVwiYXJyb3ctZG93blwiXG4gICAgICAgICAgICAgICAgYXJpYS1sYWJlbD1cIk5leHQgcmVzdWx0cyBidXR0b25cIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e25leHRSZXN1bHR9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2J0bkNsYXNzfVxuICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJzZWNvbmRhcnlcIlxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXshc2VhcmNoVmFsdWV9XG4gICAgICAgICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgICAgICAgaWNvbj1cImFycm93LXVwXCJcbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPVwiUHJldiByZXN1bHRzIGJ1dHRvblwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17cHJldlJlc3VsdH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvPlxuICAgICAgPC9zcGFuPlxuICAgIDwvZGl2PlxuICApO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsR0FBRyxRQUFRLGNBQWM7QUFDbEMsT0FBT0MsRUFBRSxNQUFNLFlBQVk7QUFDM0IsT0FBT0MsS0FBSyxJQUFJQyxJQUFJLFFBQWtDLE9BQU87QUFHN0QsU0FBU0MsTUFBTSxFQUFFQyxpQkFBaUIsUUFBUSxrQkFBa0I7QUFDNUQsU0FBU0MsTUFBTSxFQUFFQyxVQUFVLFFBQVEsYUFBYTtBQUVoRCxPQUFPQyxXQUFXLE1BQU0sdUJBQXVCO0FBQy9DLFNBQVNDLFVBQVUsRUFBRUMsWUFBWSxRQUFRLHNCQUFzQjs7QUFFL0Q7QUFBQSxTQUFBQyxHQUFBLElBQUFDLElB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