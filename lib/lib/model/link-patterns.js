// Copyright (c) 2017 The Jaeger Authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import { uniq as _uniq } from 'lodash';
import memoize from 'lru-memoize';
import { getConfigValue } from '../utils/config/get-config';
import { getParent } from './span';
var parameterRegExp = /#\{([^{}]*)\}/g;
function getParamNames(str) {
  var names = new Set();
  str.replace(parameterRegExp, function (match, name) {
    names.add(name);
    return match;
  });
  return Array.from(names);
}
function stringSupplant(str, encodeFn, map) {
  return str.replace(parameterRegExp, function (_, name) {
    var value = map[name];
    return value == null ? '' : encodeFn(value);
  });
}
export function processTemplate(template, encodeFn) {
  if (typeof template !== 'string') {
    /*
     // kept on ice until #123 is implemented:
    if (template && Array.isArray(template.parameters) && (typeof template.template === 'function')) {
      return template;
    }
     */
    throw new Error('Invalid template');
  }
  return {
    parameters: getParamNames(template),
    template: stringSupplant.bind(null, template, encodeFn)
  };
}
export function createTestFunction(entry) {
  if (typeof entry === 'string') {
    return function (arg) {
      return arg === entry;
    };
  }
  if (Array.isArray(entry)) {
    return function (arg) {
      return entry.indexOf(arg) > -1;
    };
  }
  /*
   // kept on ice until #123 is implemented:
  if (entry instanceof RegExp) {
    return (arg: any) => entry.test(arg);
  }
  if (typeof entry === 'function') {
    return entry;
  }
   */
  if (entry == null) {
    return function () {
      return true;
    };
  }
  throw new Error("Invalid value: " + entry);
}
var identity = function identity(a) {
  return a;
};
export function processLinkPattern(pattern) {
  try {
    var url = processTemplate(pattern.url, encodeURIComponent);
    var text = processTemplate(pattern.text, identity);
    return {
      object: pattern,
      type: createTestFunction(pattern.type),
      key: createTestFunction(pattern.key),
      value: createTestFunction(pattern.value),
      url: url,
      text: text,
      parameters: _uniq(url.parameters.concat(text.parameters))
    };
  } catch (error) {
    // eslint-disable-next-line no-console
    console.error("Ignoring invalid link pattern: " + error, pattern);
    return null;
  }
}
export function getParameterInArray(name, array) {
  if (array) {
    return array.find(function (entry) {
      return entry.key === name;
    });
  }
  return undefined;
}
export function getParameterInAncestor(name, span) {
  var currentSpan = span;
  while (currentSpan) {
    var result = getParameterInArray(name, currentSpan.tags) || getParameterInArray(name, currentSpan.process.tags);
    if (result) {
      return result;
    }
    currentSpan = getParent(currentSpan);
  }
  return undefined;
}
function callTemplate(template, data) {
  return template.template(data);
}
export function computeTraceLink(linkPatterns, trace) {
  var result = [];
  var validKeys = Object.keys(trace).filter(function (key) {
    return typeof trace[key] === 'string' || trace[key] === 'number';
  });
  linkPatterns == null || linkPatterns.filter(function (pattern) {
    return pattern == null ? void 0 : pattern.type('traces');
  }).forEach(function (pattern) {
    var parameterValues = {};
    var allParameters = pattern == null ? void 0 : pattern.parameters.every(function (parameter) {
      var key = parameter;
      if (validKeys.includes(key)) {
        // At this point is safe to access to trace object using parameter variable because
        // we validated parameter against validKeys, this implies that parameter a keyof Trace.
        parameterValues[parameter] = trace[key];
        return true;
      }
      return false;
    });
    if (allParameters) {
      result.push({
        url: callTemplate(pattern.url, parameterValues),
        text: callTemplate(pattern.text, parameterValues)
      });
    }
  });
  return result;
}
export function computeLinks(linkPatterns, span, items, itemIndex) {
  var item = items[itemIndex];
  var type = 'logs';
  var processTags = span.process.tags === items;
  if (processTags) {
    type = 'process';
  }
  var spanTags = span.tags === items;
  if (spanTags) {
    type = 'tags';
  }
  var result = [];
  linkPatterns.forEach(function (pattern) {
    if (pattern.type(type) && pattern.key(item.key) && pattern.value(item.value)) {
      var parameterValues = {};
      var allParameters = pattern.parameters.every(function (parameter) {
        var entry = getParameterInArray(parameter, items);
        if (!entry && !processTags) {
          // do not look in ancestors for process tags because the same object may appear in different places in the hierarchy
          // and the cache in getLinks uses that object as a key
          entry = getParameterInAncestor(parameter, span);
        }
        if (entry) {
          parameterValues[parameter] = entry.value;
          return true;
        }
        // eslint-disable-next-line no-console
        console.warn("Skipping link pattern, missing parameter " + parameter + " for key " + item.key + " in " + type + ".", pattern.object);
        return false;
      });
      if (allParameters) {
        result.push({
          url: callTemplate(pattern.url, parameterValues),
          text: callTemplate(pattern.text, parameterValues)
        });
      }
    }
  });
  return result;
}
export function createGetLinks(linkPatterns, cache) {
  return function (span, items, itemIndex) {
    if (linkPatterns.length === 0) {
      return [];
    }
    var item = items[itemIndex];
    var result = cache.get(item);
    if (!result) {
      result = computeLinks(linkPatterns, span, items, itemIndex);
      cache.set(item, result);
    }
    return result;
  };
}
var processedLinks = (getConfigValue('linkPatterns') || []).map(processLinkPattern).filter(function (link) {
  return Boolean(link);
});
export var getTraceLinks = memoize(10)(function (trace) {
  var result = [];
  if (!trace) {
    return result;
  }
  return computeTraceLink(processedLinks, trace);
});
export default createGetLinks(processedLinks, new WeakMap());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1bmlxIiwiX3VuaXEiLCJtZW1vaXplIiwiZ2V0Q29uZmlnVmFsdWUiLCJnZXRQYXJlbnQiLCJwYXJhbWV0ZXJSZWdFeHAiLCJnZXRQYXJhbU5hbWVzIiwic3RyIiwibmFtZXMiLCJTZXQiLCJyZXBsYWNlIiwibWF0Y2giLCJuYW1lIiwiYWRkIiwiQXJyYXkiLCJmcm9tIiwic3RyaW5nU3VwcGxhbnQiLCJlbmNvZGVGbiIsIm1hcCIsIl8iLCJ2YWx1ZSIsInByb2Nlc3NUZW1wbGF0ZSIsInRlbXBsYXRlIiwiRXJyb3IiLCJwYXJhbWV0ZXJzIiwiYmluZCIsImNyZWF0ZVRlc3RGdW5jdGlvbiIsImVudHJ5IiwiYXJnIiwiaXNBcnJheSIsImluZGV4T2YiLCJpZGVudGl0eSIsImEiLCJwcm9jZXNzTGlua1BhdHRlcm4iLCJwYXR0ZXJuIiwidXJsIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwidGV4dCIsIm9iamVjdCIsInR5cGUiLCJrZXkiLCJjb25jYXQiLCJlcnJvciIsImNvbnNvbGUiLCJnZXRQYXJhbWV0ZXJJbkFycmF5IiwiYXJyYXkiLCJmaW5kIiwidW5kZWZpbmVkIiwiZ2V0UGFyYW1ldGVySW5BbmNlc3RvciIsInNwYW4iLCJjdXJyZW50U3BhbiIsInJlc3VsdCIsInRhZ3MiLCJwcm9jZXNzIiwiY2FsbFRlbXBsYXRlIiwiZGF0YSIsImNvbXB1dGVUcmFjZUxpbmsiLCJsaW5rUGF0dGVybnMiLCJ0cmFjZSIsInZhbGlkS2V5cyIsIk9iamVjdCIsImtleXMiLCJmaWx0ZXIiLCJmb3JFYWNoIiwicGFyYW1ldGVyVmFsdWVzIiwiYWxsUGFyYW1ldGVycyIsImV2ZXJ5IiwicGFyYW1ldGVyIiwiaW5jbHVkZXMiLCJwdXNoIiwiY29tcHV0ZUxpbmtzIiwiaXRlbXMiLCJpdGVtSW5kZXgiLCJpdGVtIiwicHJvY2Vzc1RhZ3MiLCJzcGFuVGFncyIsIndhcm4iLCJjcmVhdGVHZXRMaW5rcyIsImNhY2hlIiwibGVuZ3RoIiwiZ2V0Iiwic2V0IiwicHJvY2Vzc2VkTGlua3MiLCJsaW5rIiwiQm9vbGVhbiIsImdldFRyYWNlTGlua3MiLCJXZWFrTWFwIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9tb2RlbC9saW5rLXBhdHRlcm5zLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMTcgVGhlIEphZWdlciBBdXRob3JzLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyB1bmlxIGFzIF91bmlxIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBtZW1vaXplIGZyb20gJ2xydS1tZW1vaXplJztcblxuaW1wb3J0IHsgVE5pbCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IFRyYWNlU3BhbiwgVHJhY2VMaW5rLCBUcmFjZUtleVZhbHVlUGFpciwgVHJhY2UgfSBmcm9tICcuLi90eXBlcy90cmFjZSc7XG5pbXBvcnQgeyBnZXRDb25maWdWYWx1ZSB9IGZyb20gJy4uL3V0aWxzL2NvbmZpZy9nZXQtY29uZmlnJztcblxuaW1wb3J0IHsgZ2V0UGFyZW50IH0gZnJvbSAnLi9zcGFuJztcblxuY29uc3QgcGFyYW1ldGVyUmVnRXhwID0gLyNcXHsoW157fV0qKVxcfS9nO1xuXG50eXBlIFByb2Nlc3NlZFRlbXBsYXRlID0ge1xuICBwYXJhbWV0ZXJzOiBzdHJpbmdbXTtcbiAgdGVtcGxhdGU6ICh0ZW1wbGF0ZTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSkgPT4gc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgUHJvY2Vzc2VkTGlua1BhdHRlcm4gPSB7XG4gIG9iamVjdDogYW55O1xuICB0eXBlOiAobGluazogc3RyaW5nKSA9PiBib29sZWFuO1xuICBrZXk6IChsaW5rOiBzdHJpbmcpID0+IGJvb2xlYW47XG4gIHZhbHVlOiAodmFsdWU6IGFueSkgPT4gYm9vbGVhbjtcbiAgdXJsOiBQcm9jZXNzZWRUZW1wbGF0ZTtcbiAgdGV4dDogUHJvY2Vzc2VkVGVtcGxhdGU7XG4gIHBhcmFtZXRlcnM6IHN0cmluZ1tdO1xufTtcblxudHlwZSBUTGlua3NSViA9IEFycmF5PHsgdXJsOiBzdHJpbmc7IHRleHQ6IHN0cmluZyB9PjtcblxuZnVuY3Rpb24gZ2V0UGFyYW1OYW1lcyhzdHI6IHN0cmluZykge1xuICBjb25zdCBuYW1lcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICBzdHIucmVwbGFjZShwYXJhbWV0ZXJSZWdFeHAsIChtYXRjaCwgbmFtZSkgPT4ge1xuICAgIG5hbWVzLmFkZChuYW1lKTtcbiAgICByZXR1cm4gbWF0Y2g7XG4gIH0pO1xuICByZXR1cm4gQXJyYXkuZnJvbShuYW1lcyk7XG59XG5cbmZ1bmN0aW9uIHN0cmluZ1N1cHBsYW50KHN0cjogc3RyaW5nLCBlbmNvZGVGbjogKHVuZW5jb2RlZDogYW55KSA9PiBzdHJpbmcsIG1hcDogUmVjb3JkPHN0cmluZywgYW55Pikge1xuICByZXR1cm4gc3RyLnJlcGxhY2UocGFyYW1ldGVyUmVnRXhwLCAoXywgbmFtZSkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gbWFwW25hbWVdO1xuICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gJycgOiBlbmNvZGVGbih2YWx1ZSk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvY2Vzc1RlbXBsYXRlKHRlbXBsYXRlOiB1bmtub3duLCBlbmNvZGVGbjogKHVuZW5jb2RlZDogYW55KSA9PiBzdHJpbmcpOiBQcm9jZXNzZWRUZW1wbGF0ZSB7XG4gIGlmICh0eXBlb2YgdGVtcGxhdGUgIT09ICdzdHJpbmcnKSB7XG4gICAgLypcblxuICAgIC8vIGtlcHQgb24gaWNlIHVudGlsICMxMjMgaXMgaW1wbGVtZW50ZWQ6XG4gICAgaWYgKHRlbXBsYXRlICYmIEFycmF5LmlzQXJyYXkodGVtcGxhdGUucGFyYW1ldGVycykgJiYgKHR5cGVvZiB0ZW1wbGF0ZS50ZW1wbGF0ZSA9PT0gJ2Z1bmN0aW9uJykpIHtcbiAgICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgICB9XG5cbiAgICAqL1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0ZW1wbGF0ZScpO1xuICB9XG4gIHJldHVybiB7XG4gICAgcGFyYW1ldGVyczogZ2V0UGFyYW1OYW1lcyh0ZW1wbGF0ZSksXG4gICAgdGVtcGxhdGU6IHN0cmluZ1N1cHBsYW50LmJpbmQobnVsbCwgdGVtcGxhdGUsIGVuY29kZUZuKSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRlc3RGdW5jdGlvbihlbnRyeT86IGFueSkge1xuICBpZiAodHlwZW9mIGVudHJ5ID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiAoYXJnOiB1bmtub3duKSA9PiBhcmcgPT09IGVudHJ5O1xuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KGVudHJ5KSkge1xuICAgIHJldHVybiAoYXJnOiB1bmtub3duKSA9PiBlbnRyeS5pbmRleE9mKGFyZykgPiAtMTtcbiAgfVxuICAvKlxuXG4gIC8vIGtlcHQgb24gaWNlIHVudGlsICMxMjMgaXMgaW1wbGVtZW50ZWQ6XG4gIGlmIChlbnRyeSBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgIHJldHVybiAoYXJnOiBhbnkpID0+IGVudHJ5LnRlc3QoYXJnKTtcbiAgfVxuICBpZiAodHlwZW9mIGVudHJ5ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGVudHJ5O1xuICB9XG5cbiAgKi9cbiAgaWYgKGVudHJ5ID09IG51bGwpIHtcbiAgICByZXR1cm4gKCkgPT4gdHJ1ZTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdmFsdWU6ICR7ZW50cnl9YCk7XG59XG5cbmNvbnN0IGlkZW50aXR5ID0gKGE6IGFueSk6IHR5cGVvZiBhID0+IGE7XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzTGlua1BhdHRlcm4ocGF0dGVybjogYW55KTogUHJvY2Vzc2VkTGlua1BhdHRlcm4gfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1cmwgPSBwcm9jZXNzVGVtcGxhdGUocGF0dGVybi51cmwsIGVuY29kZVVSSUNvbXBvbmVudCk7XG4gICAgY29uc3QgdGV4dCA9IHByb2Nlc3NUZW1wbGF0ZShwYXR0ZXJuLnRleHQsIGlkZW50aXR5KTtcbiAgICByZXR1cm4ge1xuICAgICAgb2JqZWN0OiBwYXR0ZXJuLFxuICAgICAgdHlwZTogY3JlYXRlVGVzdEZ1bmN0aW9uKHBhdHRlcm4udHlwZSksXG4gICAgICBrZXk6IGNyZWF0ZVRlc3RGdW5jdGlvbihwYXR0ZXJuLmtleSksXG4gICAgICB2YWx1ZTogY3JlYXRlVGVzdEZ1bmN0aW9uKHBhdHRlcm4udmFsdWUpLFxuICAgICAgdXJsLFxuICAgICAgdGV4dCxcbiAgICAgIHBhcmFtZXRlcnM6IF91bmlxKHVybC5wYXJhbWV0ZXJzLmNvbmNhdCh0ZXh0LnBhcmFtZXRlcnMpKSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgY29uc29sZS5lcnJvcihgSWdub3JpbmcgaW52YWxpZCBsaW5rIHBhdHRlcm46ICR7ZXJyb3J9YCwgcGF0dGVybik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFBhcmFtZXRlckluQXJyYXkobmFtZTogc3RyaW5nLCBhcnJheT86IFRyYWNlS2V5VmFsdWVQYWlyW10gfCBUTmlsKSB7XG4gIGlmIChhcnJheSkge1xuICAgIHJldHVybiBhcnJheS5maW5kKChlbnRyeSkgPT4gZW50cnkua2V5ID09PSBuYW1lKTtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFyYW1ldGVySW5BbmNlc3RvcihuYW1lOiBzdHJpbmcsIHNwYW46IFRyYWNlU3Bhbikge1xuICBsZXQgY3VycmVudFNwYW46IFRyYWNlU3BhbiB8IFROaWwgPSBzcGFuO1xuICB3aGlsZSAoY3VycmVudFNwYW4pIHtcbiAgICBjb25zdCByZXN1bHQgPSBnZXRQYXJhbWV0ZXJJbkFycmF5KG5hbWUsIGN1cnJlbnRTcGFuLnRhZ3MpIHx8IGdldFBhcmFtZXRlckluQXJyYXkobmFtZSwgY3VycmVudFNwYW4ucHJvY2Vzcy50YWdzKTtcbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBjdXJyZW50U3BhbiA9IGdldFBhcmVudChjdXJyZW50U3Bhbik7XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gY2FsbFRlbXBsYXRlKHRlbXBsYXRlOiBQcm9jZXNzZWRUZW1wbGF0ZSwgZGF0YTogYW55KSB7XG4gIHJldHVybiB0ZW1wbGF0ZS50ZW1wbGF0ZShkYXRhKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGVUcmFjZUxpbmsobGlua1BhdHRlcm5zOiBQcm9jZXNzZWRMaW5rUGF0dGVybltdLCB0cmFjZTogVHJhY2UpIHtcbiAgY29uc3QgcmVzdWx0OiBUTGlua3NSViA9IFtdO1xuICBjb25zdCB2YWxpZEtleXMgPSAoT2JqZWN0LmtleXModHJhY2UpIGFzIEFycmF5PGtleW9mIFRyYWNlPikuZmlsdGVyKFxuICAgIChrZXkpID0+IHR5cGVvZiB0cmFjZVtrZXldID09PSAnc3RyaW5nJyB8fCB0cmFjZVtrZXldID09PSAnbnVtYmVyJ1xuICApO1xuXG4gIGxpbmtQYXR0ZXJuc1xuICAgID8uZmlsdGVyKChwYXR0ZXJuKSA9PiBwYXR0ZXJuPy50eXBlKCd0cmFjZXMnKSlcbiAgICAuZm9yRWFjaCgocGF0dGVybikgPT4ge1xuICAgICAgY29uc3QgcGFyYW1ldGVyVmFsdWVzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gICAgICBjb25zdCBhbGxQYXJhbWV0ZXJzID0gcGF0dGVybj8ucGFyYW1ldGVycy5ldmVyeSgocGFyYW1ldGVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGtleSA9IHBhcmFtZXRlciBhcyBrZXlvZiBUcmFjZTtcbiAgICAgICAgaWYgKHZhbGlkS2V5cy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgLy8gQXQgdGhpcyBwb2ludCBpcyBzYWZlIHRvIGFjY2VzcyB0byB0cmFjZSBvYmplY3QgdXNpbmcgcGFyYW1ldGVyIHZhcmlhYmxlIGJlY2F1c2VcbiAgICAgICAgICAvLyB3ZSB2YWxpZGF0ZWQgcGFyYW1ldGVyIGFnYWluc3QgdmFsaWRLZXlzLCB0aGlzIGltcGxpZXMgdGhhdCBwYXJhbWV0ZXIgYSBrZXlvZiBUcmFjZS5cbiAgICAgICAgICBwYXJhbWV0ZXJWYWx1ZXNbcGFyYW1ldGVyXSA9IHRyYWNlW2tleV07XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgICBpZiAoYWxsUGFyYW1ldGVycykge1xuICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgdXJsOiBjYWxsVGVtcGxhdGUocGF0dGVybi51cmwsIHBhcmFtZXRlclZhbHVlcyksXG4gICAgICAgICAgdGV4dDogY2FsbFRlbXBsYXRlKHBhdHRlcm4udGV4dCwgcGFyYW1ldGVyVmFsdWVzKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGVMaW5rcyhcbiAgbGlua1BhdHRlcm5zOiBQcm9jZXNzZWRMaW5rUGF0dGVybltdLFxuICBzcGFuOiBUcmFjZVNwYW4sXG4gIGl0ZW1zOiBUcmFjZUtleVZhbHVlUGFpcltdLFxuICBpdGVtSW5kZXg6IG51bWJlclxuKSB7XG4gIGNvbnN0IGl0ZW0gPSBpdGVtc1tpdGVtSW5kZXhdO1xuICBsZXQgdHlwZSA9ICdsb2dzJztcbiAgY29uc3QgcHJvY2Vzc1RhZ3MgPSBzcGFuLnByb2Nlc3MudGFncyA9PT0gaXRlbXM7XG4gIGlmIChwcm9jZXNzVGFncykge1xuICAgIHR5cGUgPSAncHJvY2Vzcyc7XG4gIH1cbiAgY29uc3Qgc3BhblRhZ3MgPSBzcGFuLnRhZ3MgPT09IGl0ZW1zO1xuICBpZiAoc3BhblRhZ3MpIHtcbiAgICB0eXBlID0gJ3RhZ3MnO1xuICB9XG4gIGNvbnN0IHJlc3VsdDogQXJyYXk8eyB1cmw6IHN0cmluZzsgdGV4dDogc3RyaW5nIH0+ID0gW107XG4gIGxpbmtQYXR0ZXJucy5mb3JFYWNoKChwYXR0ZXJuKSA9PiB7XG4gICAgaWYgKHBhdHRlcm4udHlwZSh0eXBlKSAmJiBwYXR0ZXJuLmtleShpdGVtLmtleSkgJiYgcGF0dGVybi52YWx1ZShpdGVtLnZhbHVlKSkge1xuICAgICAgY29uc3QgcGFyYW1ldGVyVmFsdWVzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gICAgICBjb25zdCBhbGxQYXJhbWV0ZXJzID0gcGF0dGVybi5wYXJhbWV0ZXJzLmV2ZXJ5KChwYXJhbWV0ZXIpID0+IHtcbiAgICAgICAgbGV0IGVudHJ5ID0gZ2V0UGFyYW1ldGVySW5BcnJheShwYXJhbWV0ZXIsIGl0ZW1zKTtcbiAgICAgICAgaWYgKCFlbnRyeSAmJiAhcHJvY2Vzc1RhZ3MpIHtcbiAgICAgICAgICAvLyBkbyBub3QgbG9vayBpbiBhbmNlc3RvcnMgZm9yIHByb2Nlc3MgdGFncyBiZWNhdXNlIHRoZSBzYW1lIG9iamVjdCBtYXkgYXBwZWFyIGluIGRpZmZlcmVudCBwbGFjZXMgaW4gdGhlIGhpZXJhcmNoeVxuICAgICAgICAgIC8vIGFuZCB0aGUgY2FjaGUgaW4gZ2V0TGlua3MgdXNlcyB0aGF0IG9iamVjdCBhcyBhIGtleVxuICAgICAgICAgIGVudHJ5ID0gZ2V0UGFyYW1ldGVySW5BbmNlc3RvcihwYXJhbWV0ZXIsIHNwYW4pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICAgIHBhcmFtZXRlclZhbHVlc1twYXJhbWV0ZXJdID0gZW50cnkudmFsdWU7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgIGBTa2lwcGluZyBsaW5rIHBhdHRlcm4sIG1pc3NpbmcgcGFyYW1ldGVyICR7cGFyYW1ldGVyfSBmb3Iga2V5ICR7aXRlbS5rZXl9IGluICR7dHlwZX0uYCxcbiAgICAgICAgICBwYXR0ZXJuLm9iamVjdFxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIGlmIChhbGxQYXJhbWV0ZXJzKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICB1cmw6IGNhbGxUZW1wbGF0ZShwYXR0ZXJuLnVybCwgcGFyYW1ldGVyVmFsdWVzKSxcbiAgICAgICAgICB0ZXh0OiBjYWxsVGVtcGxhdGUocGF0dGVybi50ZXh0LCBwYXJhbWV0ZXJWYWx1ZXMpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlR2V0TGlua3MobGlua1BhdHRlcm5zOiBQcm9jZXNzZWRMaW5rUGF0dGVybltdLCBjYWNoZTogV2Vha01hcDxUcmFjZUtleVZhbHVlUGFpciwgVHJhY2VMaW5rW10+KSB7XG4gIHJldHVybiAoc3BhbjogVHJhY2VTcGFuLCBpdGVtczogVHJhY2VLZXlWYWx1ZVBhaXJbXSwgaXRlbUluZGV4OiBudW1iZXIpID0+IHtcbiAgICBpZiAobGlua1BhdHRlcm5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCBpdGVtID0gaXRlbXNbaXRlbUluZGV4XTtcbiAgICBsZXQgcmVzdWx0ID0gY2FjaGUuZ2V0KGl0ZW0pO1xuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICByZXN1bHQgPSBjb21wdXRlTGlua3MobGlua1BhdHRlcm5zLCBzcGFuLCBpdGVtcywgaXRlbUluZGV4KTtcbiAgICAgIGNhY2hlLnNldChpdGVtLCByZXN1bHQpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xufVxuXG5jb25zdCBwcm9jZXNzZWRMaW5rcyA9IChnZXRDb25maWdWYWx1ZSgnbGlua1BhdHRlcm5zJykgfHwgW10pXG4gIC5tYXAocHJvY2Vzc0xpbmtQYXR0ZXJuKVxuICAuZmlsdGVyKChsaW5rKTogbGluayBpcyBQcm9jZXNzZWRMaW5rUGF0dGVybiA9PiBCb29sZWFuKGxpbmspKTtcblxuZXhwb3J0IGNvbnN0IGdldFRyYWNlTGlua3M6ICh0cmFjZTogVHJhY2UgfCB1bmRlZmluZWQpID0+IFRMaW5rc1JWID0gbWVtb2l6ZSgxMCkoKHRyYWNlOiBUcmFjZSB8IHVuZGVmaW5lZCkgPT4ge1xuICBjb25zdCByZXN1bHQ6IFRMaW5rc1JWID0gW107XG4gIGlmICghdHJhY2UpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIHJldHVybiBjb21wdXRlVHJhY2VMaW5rKHByb2Nlc3NlZExpbmtzLCB0cmFjZSk7XG59KTtcblxuZXhwb3J0IGRlZmF1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