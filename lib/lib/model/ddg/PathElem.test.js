import _extends from "@babel/runtime/helpers/extends";
// Copyright (c) 2019 Uber Technologies, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import PathElem from './PathElem';
import { simplePath } from './sample-paths.test.resources';
describe('PathElem', function () {
  var getPath = function getPath() {
    var path = {
      focalIdx: 2
    };
    var members = simplePath.map(function (_ref, i) {
      var operation = _ref.operation,
        service = _ref.service;
      return new PathElem({
        memberIdx: i,
        operation: {
          name: operation,
          service: {
            name: service
          }
        },
        path: path
      });
    });
    members[2].visibilityIdx = 0;
    members[3].visibilityIdx = 1;
    members[1].visibilityIdx = 2;
    members[4].visibilityIdx = 3;
    members[0].visibilityIdx = 4;
    path.members = members;
    return path;
  };
  var testMemberIdx = 3;
  var testOperation = {};
  var testPath = {
    focalIdx: 4,
    members: ['member0', 'member1', 'member2', 'member3', 'member4', 'member5']
  };
  var testVisibilityIdx = 105;
  var pathElem;
  beforeEach(function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testMemberIdx
    });
  });
  it('initializes instance properties', function () {
    expect(pathElem.memberIdx).toBe(testMemberIdx);
    expect(pathElem.memberOf).toBe(testPath);
    expect(pathElem.operation).toBe(testOperation);
  });
  it('calculates distance', function () {
    expect(pathElem.distance).toBe(-1);
  });
  it('sets visibilityIdx', function () {
    pathElem.visibilityIdx = testVisibilityIdx;
    expect(pathElem.visibilityIdx).toBe(testVisibilityIdx);
  });
  it('errors when trying to access unset visibilityIdx', function () {
    expect(function () {
      return pathElem.visibilityIdx;
    }).toThrowError();
  });
  it('errors when trying to override visibilityIdx', function () {
    pathElem.visibilityIdx = testVisibilityIdx;
    expect(function () {
      pathElem.visibilityIdx = testVisibilityIdx;
    }).toThrowError();
  });
  it('has externalSideNeighbor if distance is not 0 and it is not external', function () {
    expect(pathElem.externalSideNeighbor).toBe(testPath.members[testMemberIdx - 1]);
  });
  it('has a null externalSideNeighbor if distance is 0', function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testPath.focalIdx
    });
    expect(pathElem.externalSideNeighbor).toBe(null);
  });
  it('has an undefined externalSideNeighbor if is external', function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: 0
    });
    expect(pathElem.externalSideNeighbor).toBe(undefined);
  });
  it('has focalSideNeighbor if distance is not 0', function () {
    expect(pathElem.focalSideNeighbor).toBe(testPath.members[testMemberIdx + 1]);
  });
  it('has a null focalSideNeighbor if distance is 0', function () {
    pathElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testPath.focalIdx
    });
    expect(pathElem.focalSideNeighbor).toBe(null);
  });
  it('is external if it is first or last PathElem in memberOf.path and not the focalElem', function () {
    expect(pathElem.isExternal).toBe(false);
    var firstElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: 0
    });
    expect(firstElem.isExternal).toBe(true);
    var lastElem = new PathElem({
      path: testPath,
      operation: testOperation,
      memberIdx: testPath.members.length - 1
    });
    expect(lastElem.isExternal).toBe(true);
    var path = _extends({}, testPath, {
      focalIdx: testPath.members.length - 1
    });
    var focalElem = new PathElem({
      path: path,
      operation: testOperation,
      memberIdx: path.members.length - 1
    });
    expect(focalElem.isExternal).toBe(false);
  });
  describe('externalPath', function () {
    var path = getPath();
    it('returns array of itself if it is focal elem', function () {
      var targetPathElem = path.members[path.focalIdx];
      expect(targetPathElem.externalPath).toEqual([targetPathElem]);
    });
    it('returns path away from focal elem in correct order for upstream elem', function () {
      var idx = path.focalIdx - 1;
      var targetPathElem = path.members[idx];
      expect(targetPathElem.externalPath).toEqual(path.members.slice(0, idx + 1));
    });
    it('returns path away from focal elem in correct order for downstream elem', function () {
      var idx = path.focalIdx + 1;
      var targetPathElem = path.members[idx];
      expect(targetPathElem.externalPath).toEqual(path.members.slice(idx));
    });
  });
  describe('focalPath', function () {
    var path = getPath();
    it('returns array of itself if it is focal elem', function () {
      var targetPathElem = path.members[path.focalIdx];
      expect(targetPathElem.focalPath).toEqual([targetPathElem]);
    });
    it('returns path to focal elem in correct order for upstream elem', function () {
      var targetPathElem = path.members[0];
      expect(targetPathElem.focalPath).toEqual(path.members.slice(0, path.focalIdx + 1));
    });
    it('returns path to focal elem in correct order for downstream elem', function () {
      var idx = path.members.length - 1;
      var targetPathElem = path.members[idx];
      expect(targetPathElem.focalPath).toEqual(path.members.slice(path.focalIdx, idx + 1));
    });
  });
  describe('legibility', function () {
    var path = getPath();
    var targetPathElem = path.members[1];
    it('creates consumable JSON', function () {
      expect(targetPathElem.toJSON()).toMatchSnapshot();
    });
    it('creates consumable string', function () {
      expect(targetPathElem.toString()).toBe(JSON.stringify(targetPathElem.toJSON(), null, 2));
    });
    it('creates informative string tag', function () {
      expect(Object.prototype.toString.call(targetPathElem)).toEqual("[object PathElem " + targetPathElem.visibilityIdx + "]");
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQYXRoRWxlbSIsInNpbXBsZVBhdGgiLCJkZXNjcmliZSIsImdldFBhdGgiLCJwYXRoIiwiZm9jYWxJZHgiLCJtZW1iZXJzIiwibWFwIiwiX3JlZiIsImkiLCJvcGVyYXRpb24iLCJzZXJ2aWNlIiwibWVtYmVySWR4IiwibmFtZSIsInZpc2liaWxpdHlJZHgiLCJ0ZXN0TWVtYmVySWR4IiwidGVzdE9wZXJhdGlvbiIsInRlc3RQYXRoIiwidGVzdFZpc2liaWxpdHlJZHgiLCJwYXRoRWxlbSIsImJlZm9yZUVhY2giLCJpdCIsImV4cGVjdCIsInRvQmUiLCJtZW1iZXJPZiIsImRpc3RhbmNlIiwidG9UaHJvd0Vycm9yIiwiZXh0ZXJuYWxTaWRlTmVpZ2hib3IiLCJ1bmRlZmluZWQiLCJmb2NhbFNpZGVOZWlnaGJvciIsImlzRXh0ZXJuYWwiLCJmaXJzdEVsZW0iLCJsYXN0RWxlbSIsImxlbmd0aCIsIl9leHRlbmRzIiwiZm9jYWxFbGVtIiwidGFyZ2V0UGF0aEVsZW0iLCJleHRlcm5hbFBhdGgiLCJ0b0VxdWFsIiwiaWR4Iiwic2xpY2UiLCJmb2NhbFBhdGgiLCJ0b0pTT04iLCJ0b01hdGNoU25hcHNob3QiLCJ0b1N0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJjYWxsIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi9tb2RlbC9kZGcvUGF0aEVsZW0udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMTkgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4vLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IFBhdGhFbGVtIGZyb20gJy4vUGF0aEVsZW0nO1xuaW1wb3J0IHsgc2ltcGxlUGF0aCB9IGZyb20gJy4vc2FtcGxlLXBhdGhzLnRlc3QucmVzb3VyY2VzJztcbmltcG9ydCB7IFREZGdPcGVyYXRpb24sIFREZGdQYXRoLCBURGRnU2VydmljZSB9IGZyb20gJy4vdHlwZXMnO1xuXG5kZXNjcmliZSgnUGF0aEVsZW0nLCAoKSA9PiB7XG4gIGNvbnN0IGdldFBhdGggPSAoKSA9PiB7XG4gICAgY29uc3QgcGF0aCA9IHtcbiAgICAgIGZvY2FsSWR4OiAyLFxuICAgIH0gYXMgVERkZ1BhdGg7XG4gICAgY29uc3QgbWVtYmVycyA9IHNpbXBsZVBhdGgubWFwKFxuICAgICAgKHsgb3BlcmF0aW9uLCBzZXJ2aWNlIH0sIGkpID0+XG4gICAgICAgIG5ldyBQYXRoRWxlbSh7XG4gICAgICAgICAgbWVtYmVySWR4OiBpLFxuICAgICAgICAgIG9wZXJhdGlvbjoge1xuICAgICAgICAgICAgbmFtZTogb3BlcmF0aW9uLFxuICAgICAgICAgICAgc2VydmljZToge1xuICAgICAgICAgICAgICBuYW1lOiBzZXJ2aWNlLFxuICAgICAgICAgICAgfSBhcyBURGRnU2VydmljZSxcbiAgICAgICAgICB9IGFzIFREZGdPcGVyYXRpb24sXG4gICAgICAgICAgcGF0aCxcbiAgICAgICAgfSlcbiAgICApO1xuICAgIG1lbWJlcnNbMl0udmlzaWJpbGl0eUlkeCA9IDA7XG4gICAgbWVtYmVyc1szXS52aXNpYmlsaXR5SWR4ID0gMTtcbiAgICBtZW1iZXJzWzFdLnZpc2liaWxpdHlJZHggPSAyO1xuICAgIG1lbWJlcnNbNF0udmlzaWJpbGl0eUlkeCA9IDM7XG4gICAgbWVtYmVyc1swXS52aXNpYmlsaXR5SWR4ID0gNDtcbiAgICBwYXRoLm1lbWJlcnMgPSBtZW1iZXJzO1xuICAgIHJldHVybiBwYXRoO1xuICB9O1xuICBjb25zdCB0ZXN0TWVtYmVySWR4ID0gMztcbiAgY29uc3QgdGVzdE9wZXJhdGlvbiA9IHt9IGFzIFREZGdPcGVyYXRpb247XG4gIGNvbnN0IHRlc3RQYXRoID0ge1xuICAgIGZvY2FsSWR4OiA0LFxuICAgIG1lbWJlcnM6IFsnbWVtYmVyMCcsICdtZW1iZXIxJywgJ21lbWJlcjInLCAnbWVtYmVyMycsICdtZW1iZXI0JywgJ21lbWJlcjUnXSxcbiAgfSBhcyB1bmtub3duIGFzIFREZGdQYXRoO1xuICBjb25zdCB0ZXN0VmlzaWJpbGl0eUlkeCA9IDEwNTtcbiAgbGV0IHBhdGhFbGVtOiBQYXRoRWxlbTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBwYXRoRWxlbSA9IG5ldyBQYXRoRWxlbSh7IHBhdGg6IHRlc3RQYXRoLCBvcGVyYXRpb246IHRlc3RPcGVyYXRpb24sIG1lbWJlcklkeDogdGVzdE1lbWJlcklkeCB9KTtcbiAgfSk7XG5cbiAgaXQoJ2luaXRpYWxpemVzIGluc3RhbmNlIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHBhdGhFbGVtLm1lbWJlcklkeCkudG9CZSh0ZXN0TWVtYmVySWR4KTtcbiAgICBleHBlY3QocGF0aEVsZW0ubWVtYmVyT2YpLnRvQmUodGVzdFBhdGgpO1xuICAgIGV4cGVjdChwYXRoRWxlbS5vcGVyYXRpb24pLnRvQmUodGVzdE9wZXJhdGlvbik7XG4gIH0pO1xuXG4gIGl0KCdjYWxjdWxhdGVzIGRpc3RhbmNlJywgKCkgPT4ge1xuICAgIGV4cGVjdChwYXRoRWxlbS5kaXN0YW5jZSkudG9CZSgtMSk7XG4gIH0pO1xuXG4gIGl0KCdzZXRzIHZpc2liaWxpdHlJZHgnLCAoKSA9PiB7XG4gICAgcGF0aEVsZW0udmlzaWJpbGl0eUlkeCA9IHRlc3RWaXNpYmlsaXR5SWR4O1xuICAgIGV4cGVjdChwYXRoRWxlbS52aXNpYmlsaXR5SWR4KS50b0JlKHRlc3RWaXNpYmlsaXR5SWR4KTtcbiAgfSk7XG5cbiAgaXQoJ2Vycm9ycyB3aGVuIHRyeWluZyB0byBhY2Nlc3MgdW5zZXQgdmlzaWJpbGl0eUlkeCcsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gcGF0aEVsZW0udmlzaWJpbGl0eUlkeCkudG9UaHJvd0Vycm9yKCk7XG4gIH0pO1xuXG4gIGl0KCdlcnJvcnMgd2hlbiB0cnlpbmcgdG8gb3ZlcnJpZGUgdmlzaWJpbGl0eUlkeCcsICgpID0+IHtcbiAgICBwYXRoRWxlbS52aXNpYmlsaXR5SWR4ID0gdGVzdFZpc2liaWxpdHlJZHg7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIHBhdGhFbGVtLnZpc2liaWxpdHlJZHggPSB0ZXN0VmlzaWJpbGl0eUlkeDtcbiAgICB9KS50b1Rocm93RXJyb3IoKTtcbiAgfSk7XG5cbiAgaXQoJ2hhcyBleHRlcm5hbFNpZGVOZWlnaGJvciBpZiBkaXN0YW5jZSBpcyBub3QgMCBhbmQgaXQgaXMgbm90IGV4dGVybmFsJywgKCkgPT4ge1xuICAgIGV4cGVjdChwYXRoRWxlbS5leHRlcm5hbFNpZGVOZWlnaGJvcikudG9CZSh0ZXN0UGF0aC5tZW1iZXJzW3Rlc3RNZW1iZXJJZHggLSAxXSk7XG4gIH0pO1xuXG4gIGl0KCdoYXMgYSBudWxsIGV4dGVybmFsU2lkZU5laWdoYm9yIGlmIGRpc3RhbmNlIGlzIDAnLCAoKSA9PiB7XG4gICAgcGF0aEVsZW0gPSBuZXcgUGF0aEVsZW0oeyBwYXRoOiB0ZXN0UGF0aCwgb3BlcmF0aW9uOiB0ZXN0T3BlcmF0aW9uLCBtZW1iZXJJZHg6IHRlc3RQYXRoLmZvY2FsSWR4IH0pO1xuICAgIGV4cGVjdChwYXRoRWxlbS5leHRlcm5hbFNpZGVOZWlnaGJvcikudG9CZShudWxsKTtcbiAgfSk7XG5cbiAgaXQoJ2hhcyBhbiB1bmRlZmluZWQgZXh0ZXJuYWxTaWRlTmVpZ2hib3IgaWYgaXMgZXh0ZXJuYWwnLCAoKSA9PiB7XG4gICAgcGF0aEVsZW0gPSBuZXcgUGF0aEVsZW0oeyBwYXRoOiB0ZXN0UGF0aCwgb3BlcmF0aW9uOiB0ZXN0T3BlcmF0aW9uLCBtZW1iZXJJZHg6IDAgfSk7XG4gICAgZXhwZWN0KHBhdGhFbGVtLmV4dGVybmFsU2lkZU5laWdoYm9yKS50b0JlKHVuZGVmaW5lZCk7XG4gIH0pO1xuXG4gIGl0KCdoYXMgZm9jYWxTaWRlTmVpZ2hib3IgaWYgZGlzdGFuY2UgaXMgbm90IDAnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHBhdGhFbGVtLmZvY2FsU2lkZU5laWdoYm9yKS50b0JlKHRlc3RQYXRoLm1lbWJlcnNbdGVzdE1lbWJlcklkeCArIDFdKTtcbiAgfSk7XG5cbiAgaXQoJ2hhcyBhIG51bGwgZm9jYWxTaWRlTmVpZ2hib3IgaWYgZGlzdGFuY2UgaXMgMCcsICgpID0+IHtcbiAgICBwYXRoRWxlbSA9IG5ldyBQYXRoRWxlbSh7IHBhdGg6IHRlc3RQYXRoLCBvcGVyYXRpb246IHRlc3RPcGVyYXRpb24sIG1lbWJlcklkeDogdGVzdFBhdGguZm9jYWxJZHggfSk7XG4gICAgZXhwZWN0KHBhdGhFbGVtLmZvY2FsU2lkZU5laWdoYm9yKS50b0JlKG51bGwpO1xuICB9KTtcblxuICBpdCgnaXMgZXh0ZXJuYWwgaWYgaXQgaXMgZmlyc3Qgb3IgbGFzdCBQYXRoRWxlbSBpbiBtZW1iZXJPZi5wYXRoIGFuZCBub3QgdGhlIGZvY2FsRWxlbScsICgpID0+IHtcbiAgICBleHBlY3QocGF0aEVsZW0uaXNFeHRlcm5hbCkudG9CZShmYWxzZSk7XG5cbiAgICBjb25zdCBmaXJzdEVsZW0gPSBuZXcgUGF0aEVsZW0oeyBwYXRoOiB0ZXN0UGF0aCwgb3BlcmF0aW9uOiB0ZXN0T3BlcmF0aW9uLCBtZW1iZXJJZHg6IDAgfSk7XG4gICAgZXhwZWN0KGZpcnN0RWxlbS5pc0V4dGVybmFsKS50b0JlKHRydWUpO1xuXG4gICAgY29uc3QgbGFzdEVsZW0gPSBuZXcgUGF0aEVsZW0oe1xuICAgICAgcGF0aDogdGVzdFBhdGgsXG4gICAgICBvcGVyYXRpb246IHRlc3RPcGVyYXRpb24sXG4gICAgICBtZW1iZXJJZHg6IHRlc3RQYXRoLm1lbWJlcnMubGVuZ3RoIC0gMSxcbiAgICB9KTtcbiAgICBleHBlY3QobGFzdEVsZW0uaXNFeHRlcm5hbCkudG9CZSh0cnVlKTtcblxuICAgIGNvbnN0IHBhdGggPSB7XG4gICAgICAuLi50ZXN0UGF0aCxcbiAgICAgIGZvY2FsSWR4OiB0ZXN0UGF0aC5tZW1iZXJzLmxlbmd0aCAtIDEsXG4gICAgfTtcbiAgICBjb25zdCBmb2NhbEVsZW0gPSBuZXcgUGF0aEVsZW0oeyBwYXRoLCBvcGVyYXRpb246IHRlc3RPcGVyYXRpb24sIG1lbWJlcklkeDogcGF0aC5tZW1iZXJzLmxlbmd0aCAtIDEgfSk7XG4gICAgZXhwZWN0KGZvY2FsRWxlbS5pc0V4dGVybmFsKS50b0JlKGZhbHNlKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4dGVybmFsUGF0aCcsICgpID0+IHtcbiAgICBjb25zdCBwYXRoID0gZ2V0UGF0aCgpO1xuXG4gICAgaXQoJ3JldHVybnMgYXJyYXkgb2YgaXRzZWxmIGlmIGl0IGlzIGZvY2FsIGVsZW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCB0YXJnZXRQYXRoRWxlbSA9IHBhdGgubWVtYmVyc1twYXRoLmZvY2FsSWR4XTtcbiAgICAgIGV4cGVjdCh0YXJnZXRQYXRoRWxlbS5leHRlcm5hbFBhdGgpLnRvRXF1YWwoW3RhcmdldFBhdGhFbGVtXSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBwYXRoIGF3YXkgZnJvbSBmb2NhbCBlbGVtIGluIGNvcnJlY3Qgb3JkZXIgZm9yIHVwc3RyZWFtIGVsZW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBpZHggPSBwYXRoLmZvY2FsSWR4IC0gMTtcbiAgICAgIGNvbnN0IHRhcmdldFBhdGhFbGVtID0gcGF0aC5tZW1iZXJzW2lkeF07XG4gICAgICBleHBlY3QodGFyZ2V0UGF0aEVsZW0uZXh0ZXJuYWxQYXRoKS50b0VxdWFsKHBhdGgubWVtYmVycy5zbGljZSgwLCBpZHggKyAxKSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBwYXRoIGF3YXkgZnJvbSBmb2NhbCBlbGVtIGluIGNvcnJlY3Qgb3JkZXIgZm9yIGRvd25zdHJlYW0gZWxlbScsICgpID0+IHtcbiAgICAgIGNvbnN0IGlkeCA9IHBhdGguZm9jYWxJZHggKyAxO1xuICAgICAgY29uc3QgdGFyZ2V0UGF0aEVsZW0gPSBwYXRoLm1lbWJlcnNbaWR4XTtcbiAgICAgIGV4cGVjdCh0YXJnZXRQYXRoRWxlbS5leHRlcm5hbFBhdGgpLnRvRXF1YWwocGF0aC5tZW1iZXJzLnNsaWNlKGlkeCkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZm9jYWxQYXRoJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhdGggPSBnZXRQYXRoKCk7XG5cbiAgICBpdCgncmV0dXJucyBhcnJheSBvZiBpdHNlbGYgaWYgaXQgaXMgZm9jYWwgZWxlbScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRhcmdldFBhdGhFbGVtID0gcGF0aC5tZW1iZXJzW3BhdGguZm9jYWxJZHhdO1xuICAgICAgZXhwZWN0KHRhcmdldFBhdGhFbGVtLmZvY2FsUGF0aCkudG9FcXVhbChbdGFyZ2V0UGF0aEVsZW1dKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIHBhdGggdG8gZm9jYWwgZWxlbSBpbiBjb3JyZWN0IG9yZGVyIGZvciB1cHN0cmVhbSBlbGVtJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGFyZ2V0UGF0aEVsZW0gPSBwYXRoLm1lbWJlcnNbMF07XG4gICAgICBleHBlY3QodGFyZ2V0UGF0aEVsZW0uZm9jYWxQYXRoKS50b0VxdWFsKHBhdGgubWVtYmVycy5zbGljZSgwLCBwYXRoLmZvY2FsSWR4ICsgMSkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgcGF0aCB0byBmb2NhbCBlbGVtIGluIGNvcnJlY3Qgb3JkZXIgZm9yIGRvd25zdHJlYW0gZWxlbScsICgpID0+IHtcbiAgICAgIGNvbnN0IGlkeCA9IHBhdGgubWVtYmVycy5sZW5ndGggLSAxO1xuICAgICAgY29uc3QgdGFyZ2V0UGF0aEVsZW0gPSBwYXRoLm1lbWJlcnNbaWR4XTtcbiAgICAgIGV4cGVjdCh0YXJnZXRQYXRoRWxlbS5mb2NhbFBhdGgpLnRvRXF1YWwocGF0aC5tZW1iZXJzLnNsaWNlKHBhdGguZm9jYWxJZHgsIGlkeCArIDEpKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xlZ2liaWxpdHknLCAoKSA9PiB7XG4gICAgY29uc3QgcGF0aCA9IGdldFBhdGgoKTtcbiAgICBjb25zdCB0YXJnZXRQYXRoRWxlbSA9IHBhdGgubWVtYmVyc1sxXTtcblxuICAgIGl0KCdjcmVhdGVzIGNvbnN1bWFibGUgSlNPTicsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0YXJnZXRQYXRoRWxlbS50b0pTT04oKSkudG9NYXRjaFNuYXBzaG90KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnY3JlYXRlcyBjb25zdW1hYmxlIHN0cmluZycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0YXJnZXRQYXRoRWxlbS50b1N0cmluZygpKS50b0JlKEpTT04uc3RyaW5naWZ5KHRhcmdldFBhdGhFbGVtLnRvSlNPTigpLCBudWxsLCAyKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnY3JlYXRlcyBpbmZvcm1hdGl2ZSBzdHJpbmcgdGFnJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0YXJnZXRQYXRoRWxlbSkpLnRvRXF1YWwoXG4gICAgICAgIGBbb2JqZWN0IFBhdGhFbGVtICR7dGFyZ2V0UGF0aEVsZW0udmlzaWJpbGl0eUlkeH1dYFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFFBQVEsTUFBTSxZQUFZO0FBQ2pDLFNBQVNDLFVBQVUsUUFBUSwrQkFBK0I7QUFHMURDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsWUFBTTtFQUN6QixJQUFNQyxPQUFPLEdBQUcsU0FBVkEsT0FBT0EsQ0FBQSxFQUFTO0lBQ3BCLElBQU1DLElBQUksR0FBRztNQUNYQyxRQUFRLEVBQUU7SUFDWixDQUFhO0lBQ2IsSUFBTUMsT0FBTyxHQUFHTCxVQUFVLENBQUNNLEdBQUcsQ0FDNUIsVUFBQUMsSUFBQSxFQUF5QkMsQ0FBQztNQUFBLElBQXZCQyxTQUFTLEdBQUFGLElBQUEsQ0FBVEUsU0FBUztRQUFFQyxPQUFPLEdBQUFILElBQUEsQ0FBUEcsT0FBTztNQUFBLE9BQ25CLElBQUlYLFFBQVEsQ0FBQztRQUNYWSxTQUFTLEVBQUVILENBQUM7UUFDWkMsU0FBUyxFQUFFO1VBQ1RHLElBQUksRUFBRUgsU0FBUztVQUNmQyxPQUFPLEVBQUU7WUFDUEUsSUFBSSxFQUFFRjtVQUNSO1FBQ0YsQ0FBa0I7UUFDbEJQLElBQUksRUFBSkE7TUFDRixDQUFDLENBQUM7SUFBQSxDQUNOLENBQUM7SUFDREUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDUSxhQUFhLEdBQUcsQ0FBQztJQUM1QlIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDUSxhQUFhLEdBQUcsQ0FBQztJQUM1QlIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDUSxhQUFhLEdBQUcsQ0FBQztJQUM1QlIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDUSxhQUFhLEdBQUcsQ0FBQztJQUM1QlIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDUSxhQUFhLEdBQUcsQ0FBQztJQUM1QlYsSUFBSSxDQUFDRSxPQUFPLEdBQUdBLE9BQU87SUFDdEIsT0FBT0YsSUFBSTtFQUNiLENBQUM7RUFDRCxJQUFNVyxhQUFhLEdBQUcsQ0FBQztFQUN2QixJQUFNQyxhQUFhLEdBQUcsQ0FBQyxDQUFrQjtFQUN6QyxJQUFNQyxRQUFRLEdBQUc7SUFDZlosUUFBUSxFQUFFLENBQUM7SUFDWEMsT0FBTyxFQUFFLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTO0VBQzVFLENBQXdCO0VBQ3hCLElBQU1ZLGlCQUFpQixHQUFHLEdBQUc7RUFDN0IsSUFBSUMsUUFBa0I7RUFFdEJDLFVBQVUsQ0FBQyxZQUFNO0lBQ2ZELFFBQVEsR0FBRyxJQUFJbkIsUUFBUSxDQUFDO01BQUVJLElBQUksRUFBRWEsUUFBUTtNQUFFUCxTQUFTLEVBQUVNLGFBQWE7TUFBRUosU0FBUyxFQUFFRztJQUFjLENBQUMsQ0FBQztFQUNqRyxDQUFDLENBQUM7RUFFRk0sRUFBRSxDQUFDLGlDQUFpQyxFQUFFLFlBQU07SUFDMUNDLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDUCxTQUFTLENBQUMsQ0FBQ1csSUFBSSxDQUFDUixhQUFhLENBQUM7SUFDOUNPLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDSyxRQUFRLENBQUMsQ0FBQ0QsSUFBSSxDQUFDTixRQUFRLENBQUM7SUFDeENLLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDVCxTQUFTLENBQUMsQ0FBQ2EsSUFBSSxDQUFDUCxhQUFhLENBQUM7RUFDaEQsQ0FBQyxDQUFDO0VBRUZLLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxZQUFNO0lBQzlCQyxNQUFNLENBQUNILFFBQVEsQ0FBQ00sUUFBUSxDQUFDLENBQUNGLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNwQyxDQUFDLENBQUM7RUFFRkYsRUFBRSxDQUFDLG9CQUFvQixFQUFFLFlBQU07SUFDN0JGLFFBQVEsQ0FBQ0wsYUFBYSxHQUFHSSxpQkFBaUI7SUFDMUNJLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDTCxhQUFhLENBQUMsQ0FBQ1MsSUFBSSxDQUFDTCxpQkFBaUIsQ0FBQztFQUN4RCxDQUFDLENBQUM7RUFFRkcsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLFlBQU07SUFDM0RDLE1BQU0sQ0FBQztNQUFBLE9BQU1ILFFBQVEsQ0FBQ0wsYUFBYTtJQUFBLEVBQUMsQ0FBQ1ksWUFBWSxDQUFDLENBQUM7RUFDckQsQ0FBQyxDQUFDO0VBRUZMLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxZQUFNO0lBQ3ZERixRQUFRLENBQUNMLGFBQWEsR0FBR0ksaUJBQWlCO0lBQzFDSSxNQUFNLENBQUMsWUFBTTtNQUNYSCxRQUFRLENBQUNMLGFBQWEsR0FBR0ksaUJBQWlCO0lBQzVDLENBQUMsQ0FBQyxDQUFDUSxZQUFZLENBQUMsQ0FBQztFQUNuQixDQUFDLENBQUM7RUFFRkwsRUFBRSxDQUFDLHNFQUFzRSxFQUFFLFlBQU07SUFDL0VDLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDUSxvQkFBb0IsQ0FBQyxDQUFDSixJQUFJLENBQUNOLFFBQVEsQ0FBQ1gsT0FBTyxDQUFDUyxhQUFhLEdBQUcsQ0FBQyxDQUFDLENBQUM7RUFDakYsQ0FBQyxDQUFDO0VBRUZNLEVBQUUsQ0FBQyxrREFBa0QsRUFBRSxZQUFNO0lBQzNERixRQUFRLEdBQUcsSUFBSW5CLFFBQVEsQ0FBQztNQUFFSSxJQUFJLEVBQUVhLFFBQVE7TUFBRVAsU0FBUyxFQUFFTSxhQUFhO01BQUVKLFNBQVMsRUFBRUssUUFBUSxDQUFDWjtJQUFTLENBQUMsQ0FBQztJQUNuR2lCLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDUSxvQkFBb0IsQ0FBQyxDQUFDSixJQUFJLENBQUMsSUFBSSxDQUFDO0VBQ2xELENBQUMsQ0FBQztFQUVGRixFQUFFLENBQUMsc0RBQXNELEVBQUUsWUFBTTtJQUMvREYsUUFBUSxHQUFHLElBQUluQixRQUFRLENBQUM7TUFBRUksSUFBSSxFQUFFYSxRQUFRO01BQUVQLFNBQVMsRUFBRU0sYUFBYTtNQUFFSixTQUFTLEVBQUU7SUFBRSxDQUFDLENBQUM7SUFDbkZVLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDUSxvQkFBb0IsQ0FBQyxDQUFDSixJQUFJLENBQUNLLFNBQVMsQ0FBQztFQUN2RCxDQUFDLENBQUM7RUFFRlAsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLFlBQU07SUFDckRDLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUFDTixJQUFJLENBQUNOLFFBQVEsQ0FBQ1gsT0FBTyxDQUFDUyxhQUFhLEdBQUcsQ0FBQyxDQUFDLENBQUM7RUFDOUUsQ0FBQyxDQUFDO0VBRUZNLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxZQUFNO0lBQ3hERixRQUFRLEdBQUcsSUFBSW5CLFFBQVEsQ0FBQztNQUFFSSxJQUFJLEVBQUVhLFFBQVE7TUFBRVAsU0FBUyxFQUFFTSxhQUFhO01BQUVKLFNBQVMsRUFBRUssUUFBUSxDQUFDWjtJQUFTLENBQUMsQ0FBQztJQUNuR2lCLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUFDTixJQUFJLENBQUMsSUFBSSxDQUFDO0VBQy9DLENBQUMsQ0FBQztFQUVGRixFQUFFLENBQUMsb0ZBQW9GLEVBQUUsWUFBTTtJQUM3RkMsTUFBTSxDQUFDSCxRQUFRLENBQUNXLFVBQVUsQ0FBQyxDQUFDUCxJQUFJLENBQUMsS0FBSyxDQUFDO0lBRXZDLElBQU1RLFNBQVMsR0FBRyxJQUFJL0IsUUFBUSxDQUFDO01BQUVJLElBQUksRUFBRWEsUUFBUTtNQUFFUCxTQUFTLEVBQUVNLGFBQWE7TUFBRUosU0FBUyxFQUFFO0lBQUUsQ0FBQyxDQUFDO0lBQzFGVSxNQUFNLENBQUNTLFNBQVMsQ0FBQ0QsVUFBVSxDQUFDLENBQUNQLElBQUksQ0FBQyxJQUFJLENBQUM7SUFFdkMsSUFBTVMsUUFBUSxHQUFHLElBQUloQyxRQUFRLENBQUM7TUFDNUJJLElBQUksRUFBRWEsUUFBUTtNQUNkUCxTQUFTLEVBQUVNLGFBQWE7TUFDeEJKLFNBQVMsRUFBRUssUUFBUSxDQUFDWCxPQUFPLENBQUMyQixNQUFNLEdBQUc7SUFDdkMsQ0FBQyxDQUFDO0lBQ0ZYLE1BQU0sQ0FBQ1UsUUFBUSxDQUFDRixVQUFVLENBQUMsQ0FBQ1AsSUFBSSxDQUFDLElBQUksQ0FBQztJQUV0QyxJQUFNbkIsSUFBSSxHQUFBOEIsUUFBQSxLQUNMakIsUUFBUTtNQUNYWixRQUFRLEVBQUVZLFFBQVEsQ0FBQ1gsT0FBTyxDQUFDMkIsTUFBTSxHQUFHO0lBQUMsRUFDdEM7SUFDRCxJQUFNRSxTQUFTLEdBQUcsSUFBSW5DLFFBQVEsQ0FBQztNQUFFSSxJQUFJLEVBQUpBLElBQUk7TUFBRU0sU0FBUyxFQUFFTSxhQUFhO01BQUVKLFNBQVMsRUFBRVIsSUFBSSxDQUFDRSxPQUFPLENBQUMyQixNQUFNLEdBQUc7SUFBRSxDQUFDLENBQUM7SUFDdEdYLE1BQU0sQ0FBQ2EsU0FBUyxDQUFDTCxVQUFVLENBQUMsQ0FBQ1AsSUFBSSxDQUFDLEtBQUssQ0FBQztFQUMxQyxDQUFDLENBQUM7RUFFRnJCLFFBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBTTtJQUM3QixJQUFNRSxJQUFJLEdBQUdELE9BQU8sQ0FBQyxDQUFDO0lBRXRCa0IsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLFlBQU07TUFDdEQsSUFBTWUsY0FBYyxHQUFHaEMsSUFBSSxDQUFDRSxPQUFPLENBQUNGLElBQUksQ0FBQ0MsUUFBUSxDQUFDO01BQ2xEaUIsTUFBTSxDQUFDYyxjQUFjLENBQUNDLFlBQVksQ0FBQyxDQUFDQyxPQUFPLENBQUMsQ0FBQ0YsY0FBYyxDQUFDLENBQUM7SUFDL0QsQ0FBQyxDQUFDO0lBRUZmLEVBQUUsQ0FBQyxzRUFBc0UsRUFBRSxZQUFNO01BQy9FLElBQU1rQixHQUFHLEdBQUduQyxJQUFJLENBQUNDLFFBQVEsR0FBRyxDQUFDO01BQzdCLElBQU0rQixjQUFjLEdBQUdoQyxJQUFJLENBQUNFLE9BQU8sQ0FBQ2lDLEdBQUcsQ0FBQztNQUN4Q2pCLE1BQU0sQ0FBQ2MsY0FBYyxDQUFDQyxZQUFZLENBQUMsQ0FBQ0MsT0FBTyxDQUFDbEMsSUFBSSxDQUFDRSxPQUFPLENBQUNrQyxLQUFLLENBQUMsQ0FBQyxFQUFFRCxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDN0UsQ0FBQyxDQUFDO0lBRUZsQixFQUFFLENBQUMsd0VBQXdFLEVBQUUsWUFBTTtNQUNqRixJQUFNa0IsR0FBRyxHQUFHbkMsSUFBSSxDQUFDQyxRQUFRLEdBQUcsQ0FBQztNQUM3QixJQUFNK0IsY0FBYyxHQUFHaEMsSUFBSSxDQUFDRSxPQUFPLENBQUNpQyxHQUFHLENBQUM7TUFDeENqQixNQUFNLENBQUNjLGNBQWMsQ0FBQ0MsWUFBWSxDQUFDLENBQUNDLE9BQU8sQ0FBQ2xDLElBQUksQ0FBQ0UsT0FBTyxDQUFDa0MsS0FBSyxDQUFDRCxHQUFHLENBQUMsQ0FBQztJQUN0RSxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRnJDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsWUFBTTtJQUMxQixJQUFNRSxJQUFJLEdBQUdELE9BQU8sQ0FBQyxDQUFDO0lBRXRCa0IsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLFlBQU07TUFDdEQsSUFBTWUsY0FBYyxHQUFHaEMsSUFBSSxDQUFDRSxPQUFPLENBQUNGLElBQUksQ0FBQ0MsUUFBUSxDQUFDO01BQ2xEaUIsTUFBTSxDQUFDYyxjQUFjLENBQUNLLFNBQVMsQ0FBQyxDQUFDSCxPQUFPLENBQUMsQ0FBQ0YsY0FBYyxDQUFDLENBQUM7SUFDNUQsQ0FBQyxDQUFDO0lBRUZmLEVBQUUsQ0FBQywrREFBK0QsRUFBRSxZQUFNO01BQ3hFLElBQU1lLGNBQWMsR0FBR2hDLElBQUksQ0FBQ0UsT0FBTyxDQUFDLENBQUMsQ0FBQztNQUN0Q2dCLE1BQU0sQ0FBQ2MsY0FBYyxDQUFDSyxTQUFTLENBQUMsQ0FBQ0gsT0FBTyxDQUFDbEMsSUFBSSxDQUFDRSxPQUFPLENBQUNrQyxLQUFLLENBQUMsQ0FBQyxFQUFFcEMsSUFBSSxDQUFDQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDcEYsQ0FBQyxDQUFDO0lBRUZnQixFQUFFLENBQUMsaUVBQWlFLEVBQUUsWUFBTTtNQUMxRSxJQUFNa0IsR0FBRyxHQUFHbkMsSUFBSSxDQUFDRSxPQUFPLENBQUMyQixNQUFNLEdBQUcsQ0FBQztNQUNuQyxJQUFNRyxjQUFjLEdBQUdoQyxJQUFJLENBQUNFLE9BQU8sQ0FBQ2lDLEdBQUcsQ0FBQztNQUN4Q2pCLE1BQU0sQ0FBQ2MsY0FBYyxDQUFDSyxTQUFTLENBQUMsQ0FBQ0gsT0FBTyxDQUFDbEMsSUFBSSxDQUFDRSxPQUFPLENBQUNrQyxLQUFLLENBQUNwQyxJQUFJLENBQUNDLFFBQVEsRUFBRWtDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN0RixDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRnJDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBTTtJQUMzQixJQUFNRSxJQUFJLEdBQUdELE9BQU8sQ0FBQyxDQUFDO0lBQ3RCLElBQU1pQyxjQUFjLEdBQUdoQyxJQUFJLENBQUNFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFFdENlLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxZQUFNO01BQ2xDQyxNQUFNLENBQUNjLGNBQWMsQ0FBQ00sTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDQyxlQUFlLENBQUMsQ0FBQztJQUNuRCxDQUFDLENBQUM7SUFFRnRCLEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxZQUFNO01BQ3BDQyxNQUFNLENBQUNjLGNBQWMsQ0FBQ1EsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDckIsSUFBSSxDQUFDc0IsSUFBSSxDQUFDQyxTQUFTLENBQUNWLGNBQWMsQ0FBQ00sTUFBTSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDMUYsQ0FBQyxDQUFDO0lBRUZyQixFQUFFLENBQUMsZ0NBQWdDLEVBQUUsWUFBTTtNQUN6Q0MsTUFBTSxDQUFDeUIsTUFBTSxDQUFDQyxTQUFTLENBQUNKLFFBQVEsQ0FBQ0ssSUFBSSxDQUFDYixjQUFjLENBQUMsQ0FBQyxDQUFDRSxPQUFPLHVCQUN4Q0YsY0FBYyxDQUFDdEIsYUFBYSxNQUNsRCxDQUFDO0lBQ0gsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119